{"pageProps":{"title":"Creating a simple popup chatbot using OpenAI","tags":["JavaScript/JS","OpenAI","ChatGPT","WebSockets","Audio","TTS","STT","Tutorial"],"publishedOn":"2024-05-21T12:25:43.054Z","dirName":"post013_tutorial_chatbot","content":{"compiledSource":"/*@jsxRuntime automatic @jsxImportSource react*/\nconst {Fragment: _Fragment, jsx: _jsx, jsxs: _jsxs} = arguments[0];\nconst {useMDXComponents: _provideComponents} = arguments[0];\nfunction _createMdxContent(props) {\n  const _components = Object.assign({\n    p: \"p\",\n    a: \"a\",\n    h2: \"h2\",\n    table: \"table\",\n    thead: \"thead\",\n    tr: \"tr\",\n    th: \"th\",\n    tbody: \"tbody\",\n    td: \"td\",\n    code: \"code\",\n    blockquote: \"blockquote\",\n    div: \"div\",\n    pre: \"pre\",\n    span: \"span\",\n    strong: \"strong\",\n    ul: \"ul\",\n    li: \"li\"\n  }, _provideComponents(), props.components);\n  return _jsxs(_Fragment, {\n    children: [_jsx(_components.p, {\n      children: \"In this tutorial, I will present how to create a simple popup AI chat that can\\nbe added to any website. The client will be able to reply to the chat by typing\\nand speaking to the bot.\"\n    }), \"\\n\", _jsx(\"center\", {\n      children: _jsx(\"img\", {\n        src: \"/imgs/posts/post013/presentation.gif\",\n        style: {\n          width: '24rem'\n        }\n      })\n    }), \"\\n\", _jsx(_components.p, {\n      children: \"We will be using tools from OpenAI for the AI functionalities. For the chat, we\\nwill use ChatGPT, for the STT (speech-to-text), Whisper, and for the TTS\\n(text-to-speech).\"\n    }), \"\\n\", _jsx(_components.p, {\n      children: \"I will show multiple methods to implement the app, starting from a naive, or\\nbasic, method to a better, but also more complex, method.\"\n    }), \"\\n\", _jsx(_components.p, {\n      children: \"The application will be implemented in JavaScript (ECMAScript). However, read\\nthe final chapter if you are interested in implementations in other languages.\"\n    }), \"\\n\", _jsxs(_components.p, {\n      children: [\"All the code is available\\n\", _jsx(_components.a, {\n        href: \"https://github.com/Aykelith/alexprisacariu.dev/tree/master/posts/post013_tutorial_chatbot/code\",\n        children: \"in my GitHub repository\"\n      }), \".\"]\n    }), \"\\n\", _jsx(_components.h2, {\n      children: \"The basics\"\n    }), \"\\n\", _jsx(_components.p, {\n      children: \"In this chapter we will go to the basics of the application: the project\\nstructure and packages we used.\"\n    }), \"\\n\", _jsx(_components.p, {\n      children: \"The project will be using the following packages:\"\n    }), \"\\n\", _jsxs(_components.table, {\n      children: [_jsx(_components.thead, {\n        children: _jsxs(_components.tr, {\n          children: [_jsx(_components.th, {\n            children: \"Package name\"\n          }), _jsx(_components.th, {\n            children: \"Description\"\n          })]\n        })\n      }), _jsxs(_components.tbody, {\n        children: [_jsxs(_components.tr, {\n          children: [_jsx(_components.td, {\n            children: _jsx(_components.code, {\n              children: \"express\"\n            })\n          }), _jsx(_components.td, {\n            children: \"For the HTTP server and routing\"\n          })]\n        }), _jsxs(_components.tr, {\n          children: [_jsx(_components.td, {\n            children: _jsx(_components.code, {\n              children: \"openai\"\n            })\n          }), _jsx(_components.td, {\n            children: \"For all the OpenAI stuff\"\n          })]\n        }), _jsxs(_components.tr, {\n          children: [_jsx(_components.td, {\n            children: _jsx(_components.code, {\n              children: \"sass\"\n            })\n          }), _jsx(_components.td, {\n            children: \"To convert the SASS style files to CSS files\"\n          })]\n        }), _jsxs(_components.tr, {\n          children: [_jsx(_components.td, {\n            children: _jsx(_components.code, {\n              children: \"ws\"\n            })\n          }), _jsx(_components.td, {\n            children: \"For the WebSockets\"\n          })]\n        })]\n      })]\n    }), \"\\n\", _jsx(_components.p, {\n      children: \"The project structure is as follows:\"\n    }), \"\\n\", _jsxs(_components.table, {\n      children: [_jsx(_components.thead, {\n        children: _jsxs(_components.tr, {\n          children: [_jsx(_components.th, {\n            children: \"Path\"\n          }), _jsx(_components.th, {\n            children: \"Description\"\n          })]\n        })\n      }), _jsxs(_components.tbody, {\n        children: [_jsxs(_components.tr, {\n          children: [_jsx(_components.td, {\n            children: _jsx(_components.code, {\n              children: \"public\"\n            })\n          }), _jsxs(_components.td, {\n            children: [\"The exposed directory to internet under the \", _jsx(_components.code, {\n              children: \"static\"\n            }), \" name\"]\n          })]\n        }), _jsxs(_components.tr, {\n          children: [_jsx(_components.td, {\n            children: _jsx(_components.code, {\n              children: \"public/audio\"\n            })\n          }), _jsx(_components.td, {\n            children: \"The directory containing public audio files\"\n          })]\n        }), _jsxs(_components.tr, {\n          children: [_jsx(_components.td, {\n            children: _jsx(_components.code, {\n              children: \"public/img\"\n            })\n          }), _jsx(_components.td, {\n            children: \"The directory containing public images\"\n          })]\n        }), _jsxs(_components.tr, {\n          children: [_jsx(_components.td, {\n            children: _jsx(_components.code, {\n              children: \"public/index.html\"\n            })\n          }), _jsx(_components.td, {\n            children: \"The entrypoint\"\n          })]\n        }), _jsxs(_components.tr, {\n          children: [_jsx(_components.td, {\n            children: _jsx(_components.code, {\n              children: \"style\"\n            })\n          }), _jsx(_components.td, {\n            children: \"The directory containing the style of the page\"\n          })]\n        }), _jsxs(_components.tr, {\n          children: [_jsx(_components.td, {\n            children: _jsx(_components.code, {\n              children: \"version-1\"\n            })\n          }), _jsx(_components.td, {\n            children: \"The naive implementation source code directory\"\n          })]\n        }), _jsxs(_components.tr, {\n          children: [_jsx(_components.td, {\n            children: _jsx(_components.code, {\n              children: \"version-2\"\n            })\n          }), _jsx(_components.td, {\n            children: \"The better implementation source code directory\"\n          })]\n        })]\n      })]\n    }), \"\\n\", _jsxs(_components.p, {\n      children: [\"The project can be seen\\n\", _jsx(_components.a, {\n        href: \"https://github.com/Aykelith/alexprisacariu.dev/tree/master/posts/post013_tutorial_chatbot/code\",\n        children: \"here\"\n      }), \"\\nand where a code will be listed will also\\ncontain the relative path to where that code can be found.\"]\n    }), \"\\n\", _jsxs(_components.p, {\n      children: [\"Eun \", _jsx(_components.code, {\n        children: \"npm install\"\n      }), \" followed by a \", _jsx(_components.code, {\n        children: \"npm run build\"\n      }), \" to convert the SASS file to\\nCSS and you are ready to go.\"]\n    }), \"\\n\", _jsxs(_components.p, {\n      children: [\"To start the naive implementation run \", _jsx(_components.code, {\n        children: \"npm run start-v1\"\n      }), \" or to run the better\\nimplementation, run \", _jsx(_components.code, {\n        children: \"npm run start-v2\"\n      }), \". Don't forget to define the environment\\nvariable \", _jsx(_components.code, {\n        children: \"OPENAI_API_KEY\"\n      }), \".\"]\n    }), \"\\n\", _jsxs(_components.blockquote, {\n      children: [\"\\n\", _jsx(_components.p, {\n        children: \"On UNIX systems you can run:\"\n      }), \"\\n\", _jsx(_components.div, {\n        className: \"remark-highlight\",\n        children: _jsx(_components.pre, {\n          className: \"language-shell\",\n          children: _jsxs(_components.code, {\n            className: \"language-shell\",\n            children: [_jsx(_components.span, {\n              className: \"token assign-left variable\",\n              children: \"OPENAI_API_KEY\"\n            }), _jsx(_components.span, {\n              className: \"token operator\",\n              children: \"=\"\n            }), \"YOU_API_KEY \", _jsx(_components.span, {\n              className: \"token function\",\n              children: \"npm\"\n            }), \" run start-v1`\\n\"]\n          })\n        })\n      }), \"\\n\", _jsx(_components.p, {\n        children: \"And on Windows:\"\n      }), \"\\n\", _jsx(_components.div, {\n        className: \"remark-highlight\",\n        children: _jsx(_components.pre, {\n          className: \"language-powershell\",\n          children: _jsxs(_components.code, {\n            className: \"language-powershell\",\n            children: [_jsx(_components.span, {\n              className: \"token function\",\n              children: \"set\"\n            }), \" OPENAI_API_KEY=YOU_API_KEY\\nnpm run \", _jsx(_components.span, {\n              className: \"token function\",\n              children: \"start\"\n            }), _jsx(_components.span, {\n              className: \"token operator\",\n              children: \"-\"\n            }), \"v1\\n\"]\n          })\n        })\n      }), \"\\n\"]\n    }), \"\\n\", _jsx(_components.p, {\n      children: \"This is the page you should see when you access the page:\"\n    }), \"\\n\", _jsx(\"center\", {\n      children: _jsx(\"img\", {\n        src: \"/imgs/posts/post013/first-look.png\",\n        style: {\n          width: '31rem',\n          border: '1px solid #c9c9c9'\n        }\n      })\n    }), \"\\n\", _jsx(_components.h2, {\n      children: \"The naive/simple implementation\"\n    }), \"\\n\", _jsx(_components.p, {\n      children: \"The naive implementation uses HTTP requests and responses for sending and\\nreceiving data from the server.\"\n    }), \"\\n\", _jsx(_components.p, {\n      children: \"We will look over each important function. All the code can be found in the\\nabove mentioned link.\"\n    }), \"\\n\", _jsx(_components.p, {\n      children: \"Here is an activity diagram of how the app will work:\"\n    }), \"\\n\", _jsx(\"div\", {\n      style: {\n        overflowX: 'auto'\n      },\n      children: _jsx(\"center\", {\n        children: _jsx(\"img\", {\n          src: \"/imgs/posts/post013/naive_version_activity_diagram.drawio.svg\",\n          style: {\n            width: '44rem',\n            maxWidth: 'none'\n          }\n        })\n      })\n    }), \"\\n\", _jsx(_components.p, {\n      children: \"Let's look what happens when the user presses enter on the text input element:\"\n    }), \"\\n\", _jsx(_components.div, {\n      className: \"remark-highlight\",\n      children: _jsx(_components.pre, {\n        className: \"language-js  line-numbers\",\n        children: _jsxs(_components.code, {\n          className: \"language-js\",\n          children: [_jsx(_components.span, {\n            className: \"token comment\",\n            children: \"/* version-1/client.js */\"\n          }), \"\\ninputTextElement\", _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \".\"\n          }), _jsx(_components.span, {\n            className: \"token method function property-access\",\n            children: \"addEventListener\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \"(\"\n          }), _jsx(_components.span, {\n            className: \"token string\",\n            children: \"'keydown'\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \",\"\n          }), \" \", _jsx(_components.span, {\n            className: \"token keyword\",\n            children: \"async\"\n          }), \" \", _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \"(\"\n          }), _jsx(_components.span, {\n            className: \"token parameter\",\n            children: \"event\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \")\"\n          }), \" \", _jsx(_components.span, {\n            className: \"token arrow operator\",\n            children: \"=>\"\n          }), \" \", _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \"{\"\n          }), \"\\n    \", _jsx(_components.span, {\n            className: \"token keyword control-flow\",\n            children: \"if\"\n          }), \" \", _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \"(\"\n          }), \"event\", _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \".\"\n          }), _jsx(_components.span, {\n            className: \"token property-access\",\n            children: \"code\"\n          }), \" \", _jsx(_components.span, {\n            className: \"token operator\",\n            children: \"!==\"\n          }), \" \", _jsx(_components.span, {\n            className: \"token string\",\n            children: \"'Enter'\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \")\"\n          }), \" \", _jsx(_components.span, {\n            className: \"token keyword control-flow\",\n            children: \"return\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \";\"\n          }), \"\\n    \", _jsx(_components.span, {\n            className: \"token keyword control-flow\",\n            children: \"if\"\n          }), \" \", _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \"(\"\n          }), _jsx(_components.span, {\n            className: \"token operator\",\n            children: \"!\"\n          }), \"inputTextElement\", _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \".\"\n          }), _jsx(_components.span, {\n            className: \"token property-access\",\n            children: \"value\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \")\"\n          }), \" \", _jsx(_components.span, {\n            className: \"token keyword control-flow\",\n            children: \"return\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \";\"\n          }), \"\\n    \\n    \", _jsx(_components.span, {\n            className: \"token keyword\",\n            children: \"const\"\n          }), \" message \", _jsx(_components.span, {\n            className: \"token operator\",\n            children: \"=\"\n          }), \" inputTextElement\", _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \".\"\n          }), _jsx(_components.span, {\n            className: \"token property-access\",\n            children: \"value\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \";\"\n          }), \"\\n\\n    inputTextElement\", _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \".\"\n          }), _jsx(_components.span, {\n            className: \"token property-access\",\n            children: \"value\"\n          }), \" \", _jsx(_components.span, {\n            className: \"token operator\",\n            children: \"=\"\n          }), \" \", _jsx(_components.span, {\n            className: \"token string\",\n            children: \"\\\"\\\"\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \";\"\n          }), \"\\n    inputTextElement\", _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \".\"\n          }), _jsx(_components.span, {\n            className: \"token property-access\",\n            children: \"disabled\"\n          }), \" \", _jsx(_components.span, {\n            className: \"token operator\",\n            children: \"=\"\n          }), \" \", _jsx(_components.span, {\n            className: \"token boolean\",\n            children: \"true\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \";\"\n          }), \"\\n    inputSpeechElement\", _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \".\"\n          }), _jsx(_components.span, {\n            className: \"token property-access\",\n            children: \"disabled\"\n          }), \" \", _jsx(_components.span, {\n            className: \"token operator\",\n            children: \"=\"\n          }), \" \", _jsx(_components.span, {\n            className: \"token boolean\",\n            children: \"true\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \";\"\n          }), \"\\n\\n    \", _jsx(_components.span, {\n            className: \"token keyword control-flow\",\n            children: \"await\"\n          }), \" \", _jsx(_components.span, {\n            className: \"token function\",\n            children: \"addMessage\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \"(\"\n          }), _jsx(_components.span, {\n            className: \"token string\",\n            children: \"'user'\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \",\"\n          }), \" message\", _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \")\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \";\"\n          }), \"\\n\\n    inputTextElement\", _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \".\"\n          }), _jsx(_components.span, {\n            className: \"token property-access\",\n            children: \"disabled\"\n          }), \" \", _jsx(_components.span, {\n            className: \"token operator\",\n            children: \"=\"\n          }), \" \", _jsx(_components.span, {\n            className: \"token boolean\",\n            children: \"false\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \";\"\n          }), \"\\n    inputSpeechElement\", _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \".\"\n          }), _jsx(_components.span, {\n            className: \"token property-access\",\n            children: \"disabled\"\n          }), \" \", _jsx(_components.span, {\n            className: \"token operator\",\n            children: \"=\"\n          }), \" \", _jsx(_components.span, {\n            className: \"token boolean\",\n            children: \"false\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \";\"\n          }), \"\\n\", _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \"}\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \")\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \";\"\n          }), _jsxs(_components.span, {\n            \"aria-hidden\": \"true\",\n            className: \"line-numbers-rows\",\n            children: [_jsx(_components.span, {\n              className: \"\"\n            }), _jsx(_components.span, {\n              className: \"\"\n            }), _jsx(_components.span, {\n              className: \"\"\n            }), _jsx(_components.span, {\n              className: \"\"\n            }), _jsx(_components.span, {\n              className: \"\"\n            }), _jsx(_components.span, {\n              className: \"\"\n            }), _jsx(_components.span, {\n              className: \"\"\n            }), _jsx(_components.span, {\n              className: \"\"\n            }), _jsx(_components.span, {\n              className: \"\"\n            }), _jsx(_components.span, {\n              className: \"\"\n            }), _jsx(_components.span, {\n              className: \"\"\n            }), _jsx(_components.span, {\n              className: \"\"\n            }), _jsx(_components.span, {\n              className: \"\"\n            }), _jsx(_components.span, {\n              className: \"\"\n            }), _jsx(_components.span, {\n              className: \"\"\n            }), _jsx(_components.span, {\n              className: \"\"\n            })]\n          }), \"\\n\"]\n        })\n      })\n    }), \"\\n\", _jsx(_components.p, {\n      children: \"Once the user hits the enter key and the input is not empty, we will disable\\nboth the text input and the audio button so the user wouldn't send another\\nmessage while we getting a response to the previous message. Once we get the\\nanswer we restore the functionality.\"\n    }), \"\\n\", _jsxs(_components.p, {\n      children: [\"After we disable the input, we call the main function, \", _jsx(_components.code, {\n        children: \"addMessage\"\n      }), \", which does\\nthe magic. Let's look at it:\"]\n    }), \"\\n\", _jsx(_components.div, {\n      className: \"remark-highlight\",\n      children: _jsx(_components.pre, {\n        className: \"language-js  line-numbers\",\n        children: _jsxs(_components.code, {\n          className: \"language-js\",\n          children: [_jsx(_components.span, {\n            className: \"token comment\",\n            children: \"/* version-1/client.js */\"\n          }), \"\\n\", _jsxs(_components.span, {\n            className: \"token doc-comment comment\",\n            children: [\"/**\\n * Add a new message to the chat.\\n * \", _jsx(_components.span, {\n              className: \"token keyword\",\n              children: \"@async\"\n            }), \"\\n * \\n * \", _jsx(_components.span, {\n              className: \"token keyword\",\n              children: \"@param\"\n            }), \" \", _jsxs(_components.span, {\n              className: \"token class-name\",\n              children: [_jsx(_components.span, {\n                className: \"token punctuation\",\n                children: \"{\"\n              }), \"MessageType\", _jsx(_components.span, {\n                className: \"token punctuation\",\n                children: \"}\"\n              })]\n            }), \" \", _jsx(_components.span, {\n              className: \"token parameter\",\n              children: \"type\"\n            }), \" the type of message\\n * \", _jsx(_components.span, {\n              className: \"token keyword\",\n              children: \"@param\"\n            }), \" \", _jsxs(_components.span, {\n              className: \"token class-name\",\n              children: [_jsx(_components.span, {\n                className: \"token punctuation\",\n                children: \"{\"\n              }), \"String\", _jsx(_components.span, {\n                className: \"token operator\",\n                children: \"|\"\n              }), \"Audio\", _jsx(_components.span, {\n                className: \"token punctuation\",\n                children: \"}\"\n              })]\n            }), \" \", _jsx(_components.span, {\n              className: \"token parameter\",\n              children: \"message\"\n            }), \" the data of the message\\n * \", _jsx(_components.span, {\n              className: \"token keyword\",\n              children: \"@param\"\n            }), \" \", _jsxs(_components.span, {\n              className: \"token class-name\",\n              children: [_jsx(_components.span, {\n                className: \"token punctuation\",\n                children: \"{\"\n              }), \"Object\", _jsx(_components.span, {\n                className: \"token punctuation\",\n                children: \"}\"\n              })]\n            }), \" \", _jsxs(_components.span, {\n              className: \"token optional-parameter\",\n              children: [_jsx(_components.span, {\n                className: \"token punctuation\",\n                children: \"[\"\n              }), _jsx(_components.span, {\n                className: \"token parameter\",\n                children: \"settings\"\n              }), _jsx(_components.span, {\n                className: \"token punctuation\",\n                children: \"]\"\n              })]\n            }), \" additional settings\\n * \", _jsx(_components.span, {\n              className: \"token keyword\",\n              children: \"@param\"\n            }), \" \", _jsxs(_components.span, {\n              className: \"token class-name\",\n              children: [_jsx(_components.span, {\n                className: \"token punctuation\",\n                children: \"{\"\n              }), \"Number\", _jsx(_components.span, {\n                className: \"token punctuation\",\n                children: \"}\"\n              })]\n            }), \" \", _jsxs(_components.span, {\n              className: \"token optional-parameter\",\n              children: [_jsx(_components.span, {\n                className: \"token punctuation\",\n                children: \"[\"\n              }), _jsxs(_components.span, {\n                className: \"token parameter\",\n                children: [\"settings\", _jsx(_components.span, {\n                  className: \"token punctuation\",\n                  children: \".\"\n                }), \"audioLength\"]\n              }), _jsx(_components.span, {\n                className: \"token punctuation\",\n                children: \"]\"\n              })]\n            }), \" the length of the audio in seconds\\n * \", _jsx(_components.span, {\n              className: \"token keyword\",\n              children: \"@returns\"\n            }), \" \", _jsxs(_components.span, {\n              className: \"token class-name\",\n              children: [_jsx(_components.span, {\n                className: \"token punctuation\",\n                children: \"{\"\n              }), \"Promise\", _jsx(_components.span, {\n                className: \"token punctuation\",\n                children: \"}\"\n              })]\n            }), \" the promise resolved when all is done\\n */\"]\n          }), \"\\n\", _jsx(_components.span, {\n            className: \"token keyword\",\n            children: \"async\"\n          }), \" \", _jsx(_components.span, {\n            className: \"token keyword\",\n            children: \"function\"\n          }), \" \", _jsx(_components.span, {\n            className: \"token function\",\n            children: \"addMessage\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \"(\"\n          }), _jsxs(_components.span, {\n            className: \"token parameter\",\n            children: [\"type\", _jsx(_components.span, {\n              className: \"token punctuation\",\n              children: \",\"\n            }), \" message\", _jsx(_components.span, {\n              className: \"token punctuation\",\n              children: \",\"\n            }), \" settings \", _jsx(_components.span, {\n              className: \"token operator\",\n              children: \"=\"\n            }), \" \", _jsx(_components.span, {\n              className: \"token punctuation\",\n              children: \"{\"\n            }), _jsx(_components.span, {\n              className: \"token punctuation\",\n              children: \"}\"\n            })]\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \")\"\n          }), \" \", _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \"{\"\n          }), \"\\n    \", _jsx(_components.span, {\n            className: \"token keyword\",\n            children: \"const\"\n          }), \" newMsg \", _jsx(_components.span, {\n            className: \"token operator\",\n            children: \"=\"\n          }), \" \", _jsx(_components.span, {\n            className: \"token dom variable\",\n            children: \"document\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \".\"\n          }), _jsx(_components.span, {\n            className: \"token method function property-access\",\n            children: \"createElement\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \"(\"\n          }), _jsx(_components.span, {\n            className: \"token string\",\n            children: \"'div'\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \")\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \";\"\n          }), \"\\n    newMsg\", _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \".\"\n          }), _jsx(_components.span, {\n            className: \"token property-access\",\n            children: \"classList\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \".\"\n          }), _jsx(_components.span, {\n            className: \"token method function property-access\",\n            children: \"add\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \"(\"\n          }), _jsx(_components.span, {\n            className: \"token string\",\n            children: \"'message'\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \")\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \";\"\n          }), \"\\n\\n    \", _jsx(_components.span, {\n            className: \"token keyword control-flow\",\n            children: \"if\"\n          }), \" \", _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \"(\"\n          }), \"type \", _jsx(_components.span, {\n            className: \"token operator\",\n            children: \"===\"\n          }), \" \", _jsx(_components.span, {\n            className: \"token maybe-class-name\",\n            children: \"MessageType\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \".\"\n          }), _jsx(_components.span, {\n            className: \"token property-access\",\n            children: _jsx(_components.span, {\n              className: \"token maybe-class-name\",\n              children: \"User\"\n            })\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \")\"\n          }), \" \", _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \"{\"\n          }), \"\\n        newMsg\", _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \".\"\n          }), _jsx(_components.span, {\n            className: \"token property-access\",\n            children: \"classList\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \".\"\n          }), _jsx(_components.span, {\n            className: \"token method function property-access\",\n            children: \"add\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \"(\"\n          }), _jsx(_components.span, {\n            className: \"token string\",\n            children: \"'user'\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \")\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \";\"\n          }), \"\\n        newMsg\", _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \".\"\n          }), _jsx(_components.span, {\n            className: \"token property-access\",\n            children: \"innerHTML\"\n          }), \" \", _jsx(_components.span, {\n            className: \"token operator\",\n            children: \"=\"\n          }), \" message\", _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \";\"\n          }), \"\\n    \", _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \"}\"\n          }), \" \", _jsx(_components.span, {\n            className: \"token keyword control-flow\",\n            children: \"else\"\n          }), \" \", _jsx(_components.span, {\n            className: \"token keyword control-flow\",\n            children: \"if\"\n          }), \" \", _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \"(\"\n          }), \"type \", _jsx(_components.span, {\n            className: \"token operator\",\n            children: \"===\"\n          }), \" \", _jsx(_components.span, {\n            className: \"token maybe-class-name\",\n            children: \"MessageType\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \".\"\n          }), _jsx(_components.span, {\n            className: \"token property-access\",\n            children: _jsx(_components.span, {\n              className: \"token maybe-class-name\",\n              children: \"UserAudio\"\n            })\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \")\"\n          }), \" \", _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \"{\"\n          }), \"\\n        newMsg\", _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \".\"\n          }), _jsx(_components.span, {\n            className: \"token property-access\",\n            children: \"classList\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \".\"\n          }), _jsx(_components.span, {\n            className: \"token method function property-access\",\n            children: \"add\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \"(\"\n          }), _jsx(_components.span, {\n            className: \"token string\",\n            children: \"'user'\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \",\"\n          }), \" \", _jsx(_components.span, {\n            className: \"token string\",\n            children: \"'audio'\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \")\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \";\"\n          }), \"\\n        newMsg\", _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \".\"\n          }), _jsx(_components.span, {\n            className: \"token property-access\",\n            children: \"innerHTML\"\n          }), \" \", _jsx(_components.span, {\n            className: \"token operator\",\n            children: \"=\"\n          }), \" \", _jsx(_components.span, {\n            className: \"token string\",\n            children: \"'Audio message'\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \";\"\n          }), \"\\n    \", _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \"}\"\n          }), \" \", _jsx(_components.span, {\n            className: \"token keyword control-flow\",\n            children: \"else\"\n          }), \" \", _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \"{\"\n          }), \"\\n        newMsg\", _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \".\"\n          }), _jsx(_components.span, {\n            className: \"token property-access\",\n            children: \"classList\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \".\"\n          }), _jsx(_components.span, {\n            className: \"token method function property-access\",\n            children: \"add\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \"(\"\n          }), _jsx(_components.span, {\n            className: \"token maybe-class-name\",\n            children: \"MessageType\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \".\"\n          }), _jsx(_components.span, {\n            className: \"token property-access\",\n            children: _jsx(_components.span, {\n              className: \"token maybe-class-name\",\n              children: \"Bot\"\n            })\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \")\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \";\"\n          }), \"\\n    \", _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \"}\"\n          }), \"\\n\\n    \", _jsx(_components.span, {\n            className: \"token keyword\",\n            children: \"const\"\n          }), \" msgsCnt \", _jsx(_components.span, {\n            className: \"token operator\",\n            children: \"=\"\n          }), \" \", _jsx(_components.span, {\n            className: \"token dom variable\",\n            children: \"document\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \".\"\n          }), _jsx(_components.span, {\n            className: \"token method function property-access\",\n            children: \"getElementById\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \"(\"\n          }), _jsx(_components.span, {\n            className: \"token string\",\n            children: \"'friendly-bot-container-msgs'\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \")\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \";\"\n          }), \"\\n    msgsCnt\", _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \".\"\n          }), _jsx(_components.span, {\n            className: \"token method function property-access\",\n            children: \"appendChild\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \"(\"\n          }), \"newMsg\", _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \")\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \";\"\n          }), \"\\n\\n    \", _jsx(_components.span, {\n            className: \"token comment\",\n            children: \"// Keeping own history log\"\n          }), \"\\n    \", _jsx(_components.span, {\n            className: \"token keyword control-flow\",\n            children: \"if\"\n          }), \" \", _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \"(\"\n          }), \"type \", _jsx(_components.span, {\n            className: \"token operator\",\n            children: \"===\"\n          }), \" \", _jsx(_components.span, {\n            className: \"token maybe-class-name\",\n            children: \"MessageType\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \".\"\n          }), _jsx(_components.span, {\n            className: \"token property-access\",\n            children: _jsx(_components.span, {\n              className: \"token maybe-class-name\",\n              children: \"User\"\n            })\n          }), \" \", _jsx(_components.span, {\n            className: \"token operator\",\n            children: \"||\"\n          }), \" type \", _jsx(_components.span, {\n            className: \"token operator\",\n            children: \"===\"\n          }), \" \", _jsx(_components.span, {\n            className: \"token maybe-class-name\",\n            children: \"MessageType\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \".\"\n          }), _jsx(_components.span, {\n            className: \"token property-access\",\n            children: _jsx(_components.span, {\n              className: \"token maybe-class-name\",\n              children: \"Bot\"\n            })\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \")\"\n          }), \" \", _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \"{\"\n          }), \"\\n        messageHistory\", _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \".\"\n          }), _jsx(_components.span, {\n            className: \"token method function property-access\",\n            children: \"push\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \"(\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \"{\"\n          }), \" \", _jsx(_components.span, {\n            className: \"token literal-property property\",\n            children: \"role\"\n          }), _jsx(_components.span, {\n            className: \"token operator\",\n            children: \":\"\n          }), \" type \", _jsx(_components.span, {\n            className: \"token operator\",\n            children: \"===\"\n          }), \" \", _jsx(_components.span, {\n            className: \"token maybe-class-name\",\n            children: \"MessageType\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \".\"\n          }), _jsx(_components.span, {\n            className: \"token property-access\",\n            children: _jsx(_components.span, {\n              className: \"token maybe-class-name\",\n              children: \"User\"\n            })\n          }), \" \", _jsx(_components.span, {\n            className: \"token operator\",\n            children: \"?\"\n          }), \" \", _jsx(_components.span, {\n            className: \"token string\",\n            children: \"'user'\"\n          }), \" \", _jsx(_components.span, {\n            className: \"token operator\",\n            children: \":\"\n          }), \" \", _jsx(_components.span, {\n            className: \"token string\",\n            children: \"'assistant'\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \",\"\n          }), \" \", _jsx(_components.span, {\n            className: \"token literal-property property\",\n            children: \"content\"\n          }), _jsx(_components.span, {\n            className: \"token operator\",\n            children: \":\"\n          }), \" message \", _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \"}\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \")\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \";\"\n          }), \"\\n    \", _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \"}\"\n          }), \"\\n        \\n    \", _jsx(_components.span, {\n            className: \"token keyword control-flow\",\n            children: \"if\"\n          }), \" \", _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \"(\"\n          }), \"type \", _jsx(_components.span, {\n            className: \"token operator\",\n            children: \"===\"\n          }), \" \", _jsx(_components.span, {\n            className: \"token maybe-class-name\",\n            children: \"MessageType\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \".\"\n          }), _jsx(_components.span, {\n            className: \"token property-access\",\n            children: _jsx(_components.span, {\n              className: \"token maybe-class-name\",\n              children: \"Bot\"\n            })\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \")\"\n          }), \" \", _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \"{\"\n          }), \"\\n        \", _jsx(_components.span, {\n            className: \"token keyword control-flow\",\n            children: \"if\"\n          }), \" \", _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \"(\"\n          }), _jsx(_components.span, {\n            className: \"token maybe-class-name\",\n            children: \"Settings\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \".\"\n          }), _jsx(_components.span, {\n            className: \"token property-access\",\n            children: _jsx(_components.span, {\n              className: \"token maybe-class-name\",\n              children: \"UseWriteEffect\"\n            })\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \")\"\n          }), \" \", _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \"{\"\n          }), \"\\n            \", _jsx(_components.span, {\n            className: \"token comment\",\n            children: \"// Create a write effect when the bot responds\"\n          }), \"\\n            \", _jsx(_components.span, {\n            className: \"token keyword\",\n            children: \"let\"\n          }), \" speed \", _jsx(_components.span, {\n            className: \"token operator\",\n            children: \"=\"\n          }), \" \", _jsx(_components.span, {\n            className: \"token maybe-class-name\",\n            children: \"Settings\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \".\"\n          }), _jsx(_components.span, {\n            className: \"token property-access\",\n            children: _jsx(_components.span, {\n              className: \"token maybe-class-name\",\n              children: \"DefaultTypingSpeed\"\n            })\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \";\"\n          }), \"\\n\\n            \", _jsx(_components.span, {\n            className: \"token keyword control-flow\",\n            children: \"if\"\n          }), \" \", _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \"(\"\n          }), \"settings\", _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \".\"\n          }), _jsx(_components.span, {\n            className: \"token property-access\",\n            children: \"audioLength\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \")\"\n          }), \" \", _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \"{\"\n          }), \"\\n                \", _jsx(_components.span, {\n            className: \"token keyword\",\n            children: \"const\"\n          }), \" ms \", _jsx(_components.span, {\n            className: \"token operator\",\n            children: \"=\"\n          }), \" settings\", _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \".\"\n          }), _jsx(_components.span, {\n            className: \"token property-access\",\n            children: \"audioLength\"\n          }), \" \", _jsx(_components.span, {\n            className: \"token operator\",\n            children: \"*\"\n          }), \" \", _jsx(_components.span, {\n            className: \"token number\",\n            children: \"1000\"\n          }), \" \", _jsx(_components.span, {\n            className: \"token operator\",\n            children: \"+\"\n          }), \" \", _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \"(\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \"(\"\n          }), \"message\", _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \".\"\n          }), _jsx(_components.span, {\n            className: \"token method function property-access\",\n            children: \"match\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \"(\"\n          }), _jsxs(_components.span, {\n            className: \"token regex\",\n            children: [_jsx(_components.span, {\n              className: \"token regex-delimiter\",\n              children: \"/\"\n            }), _jsx(_components.span, {\n              className: \"token regex-source language-regex\",\n              children: \",\"\n            }), _jsx(_components.span, {\n              className: \"token regex-delimiter\",\n              children: \"/\"\n            }), _jsx(_components.span, {\n              className: \"token regex-flags\",\n              children: \"g\"\n            })]\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \")\"\n          }), \" \", _jsx(_components.span, {\n            className: \"token operator\",\n            children: \"||\"\n          }), \" \", _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \"[\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \"]\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \")\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \".\"\n          }), _jsx(_components.span, {\n            className: \"token property-access\",\n            children: \"length\"\n          }), \" \", _jsx(_components.span, {\n            className: \"token operator\",\n            children: \"*\"\n          }), \" \", _jsx(_components.span, {\n            className: \"token number\",\n            children: \"40\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \")\"\n          }), \" \", _jsx(_components.span, {\n            className: \"token operator\",\n            children: \"+\"\n          }), \" \", _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \"(\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \"(\"\n          }), \"message\", _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \".\"\n          }), _jsx(_components.span, {\n            className: \"token method function property-access\",\n            children: \"match\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \"(\"\n          }), _jsxs(_components.span, {\n            className: \"token regex\",\n            children: [_jsx(_components.span, {\n              className: \"token regex-delimiter\",\n              children: \"/\"\n            }), _jsx(_components.span, {\n              className: \"token regex-source language-regex\",\n              children: _jsx(_components.span, {\n                className: \"token special-escape escape\",\n                children: \"\\\\.\"\n              })\n            }), _jsx(_components.span, {\n              className: \"token regex-delimiter\",\n              children: \"/\"\n            }), _jsx(_components.span, {\n              className: \"token regex-flags\",\n              children: \"g\"\n            })]\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \")\"\n          }), \" \", _jsx(_components.span, {\n            className: \"token operator\",\n            children: \"||\"\n          }), \" \", _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \"[\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \"]\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \")\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \".\"\n          }), _jsx(_components.span, {\n            className: \"token property-access\",\n            children: \"length\"\n          }), \" \", _jsx(_components.span, {\n            className: \"token operator\",\n            children: \"*\"\n          }), \" \", _jsx(_components.span, {\n            className: \"token number\",\n            children: \"70\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \")\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \";\"\n          }), \"\\n                speed \", _jsx(_components.span, {\n            className: \"token operator\",\n            children: \"=\"\n          }), \" ms \", _jsx(_components.span, {\n            className: \"token operator\",\n            children: \"/\"\n          }), \" message\", _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \".\"\n          }), _jsx(_components.span, {\n            className: \"token property-access\",\n            children: \"length\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \";\"\n          }), \"\\n            \", _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \"}\"\n          }), \"\\n            \\n            \", _jsx(_components.span, {\n            className: \"token keyword control-flow\",\n            children: \"for\"\n          }), \" \", _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \"(\"\n          }), _jsx(_components.span, {\n            className: \"token keyword\",\n            children: \"let\"\n          }), \" i\", _jsx(_components.span, {\n            className: \"token operator\",\n            children: \"=\"\n          }), _jsx(_components.span, {\n            className: \"token number\",\n            children: \"0\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \",\"\n          }), \" length\", _jsx(_components.span, {\n            className: \"token operator\",\n            children: \"=\"\n          }), \"message\", _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \".\"\n          }), _jsx(_components.span, {\n            className: \"token property-access\",\n            children: \"length\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \";\"\n          }), \" i \", _jsx(_components.span, {\n            className: \"token operator\",\n            children: \"<\"\n          }), \" length\", _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \";\"\n          }), \" i \", _jsx(_components.span, {\n            className: \"token operator\",\n            children: \"+=\"\n          }), \" \", _jsx(_components.span, {\n            className: \"token number\",\n            children: \"1\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \")\"\n          }), \" \", _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \"{\"\n          }), \"\\n                newMsg\", _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \".\"\n          }), _jsx(_components.span, {\n            className: \"token property-access\",\n            children: \"innerHTML\"\n          }), \" \", _jsx(_components.span, {\n            className: \"token operator\",\n            children: \"+=\"\n          }), \" message\", _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \".\"\n          }), _jsx(_components.span, {\n            className: \"token method function property-access\",\n            children: \"charAt\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \"(\"\n          }), \"i\", _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \")\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \";\"\n          }), \"\\n                \", _jsx(_components.span, {\n            className: \"token keyword control-flow\",\n            children: \"await\"\n          }), \" \", _jsx(_components.span, {\n            className: \"token function\",\n            children: \"sleep\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \"(\"\n          }), \"speed\", _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \")\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \";\"\n          }), \"\\n            \", _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \"}\"\n          }), \"\\n        \", _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \"}\"\n          }), \" \", _jsx(_components.span, {\n            className: \"token keyword control-flow\",\n            children: \"else\"\n          }), \" \", _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \"{\"\n          }), \"\\n            newMsg\", _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \".\"\n          }), _jsx(_components.span, {\n            className: \"token property-access\",\n            children: \"innerHTML\"\n          }), \" \", _jsx(_components.span, {\n            className: \"token operator\",\n            children: \"=\"\n          }), \" message\", _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \";\"\n          }), \"\\n        \", _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \"}\"\n          }), \"\\n    \", _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \"}\"\n          }), \" \", _jsx(_components.span, {\n            className: \"token keyword control-flow\",\n            children: \"else\"\n          }), \" \", _jsx(_components.span, {\n            className: \"token keyword control-flow\",\n            children: \"if\"\n          }), \" \", _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \"(\"\n          }), \"type \", _jsx(_components.span, {\n            className: \"token operator\",\n            children: \"===\"\n          }), \" \", _jsx(_components.span, {\n            className: \"token maybe-class-name\",\n            children: \"MessageType\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \".\"\n          }), _jsx(_components.span, {\n            className: \"token property-access\",\n            children: _jsx(_components.span, {\n              className: \"token maybe-class-name\",\n              children: \"User\"\n            })\n          }), \" \", _jsx(_components.span, {\n            className: \"token operator\",\n            children: \"||\"\n          }), \" type \", _jsx(_components.span, {\n            className: \"token operator\",\n            children: \"===\"\n          }), \" \", _jsx(_components.span, {\n            className: \"token maybe-class-name\",\n            children: \"MessageType\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \".\"\n          }), _jsx(_components.span, {\n            className: \"token property-access\",\n            children: _jsx(_components.span, {\n              className: \"token maybe-class-name\",\n              children: \"UserAudio\"\n            })\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \")\"\n          }), \" \", _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \"{\"\n          }), \"\\n        \", _jsx(_components.span, {\n            className: \"token keyword\",\n            children: \"let\"\n          }), \" response\", _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \";\"\n          }), \"\\n        \", _jsx(_components.span, {\n            className: \"token keyword control-flow\",\n            children: \"if\"\n          }), \" \", _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \"(\"\n          }), \"type \", _jsx(_components.span, {\n            className: \"token operator\",\n            children: \"===\"\n          }), \" \", _jsx(_components.span, {\n            className: \"token maybe-class-name\",\n            children: \"MessageType\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \".\"\n          }), _jsx(_components.span, {\n            className: \"token property-access\",\n            children: _jsx(_components.span, {\n              className: \"token maybe-class-name\",\n              children: \"User\"\n            })\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \")\"\n          }), \" \", _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \"{\"\n          }), \"\\n            response \", _jsx(_components.span, {\n            className: \"token operator\",\n            children: \"=\"\n          }), \" \", _jsx(_components.span, {\n            className: \"token keyword control-flow\",\n            children: \"await\"\n          }), \" \", _jsx(_components.span, {\n            className: \"token function\",\n            children: \"sendMessage\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \"(\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \"{\"\n          }), \" message \", _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \"}\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \")\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \";\"\n          }), \"\\n        \", _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \"}\"\n          }), \" \", _jsx(_components.span, {\n            className: \"token keyword control-flow\",\n            children: \"else\"\n          }), \" \", _jsx(_components.span, {\n            className: \"token keyword control-flow\",\n            children: \"if\"\n          }), \" \", _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \"(\"\n          }), \"type \", _jsx(_components.span, {\n            className: \"token operator\",\n            children: \"===\"\n          }), \" \", _jsx(_components.span, {\n            className: \"token maybe-class-name\",\n            children: \"MessageType\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \".\"\n          }), _jsx(_components.span, {\n            className: \"token property-access\",\n            children: _jsx(_components.span, {\n              className: \"token maybe-class-name\",\n              children: \"UserAudio\"\n            })\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \")\"\n          }), \" \", _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \"{\"\n          }), \"\\n            response \", _jsx(_components.span, {\n            className: \"token operator\",\n            children: \"=\"\n          }), \" \", _jsx(_components.span, {\n            className: \"token keyword control-flow\",\n            children: \"await\"\n          }), \" \", _jsx(_components.span, {\n            className: \"token function\",\n            children: \"sendMessage\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \"(\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \"{\"\n          }), \" \", _jsx(_components.span, {\n            className: \"token literal-property property\",\n            children: \"audio\"\n          }), _jsx(_components.span, {\n            className: \"token operator\",\n            children: \":\"\n          }), \" message \", _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \"}\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \")\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \";\"\n          }), \"        \\n        \", _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \"}\"\n          }), \"\\n\\n        \", _jsx(_components.span, {\n            className: \"token keyword control-flow\",\n            children: \"if\"\n          }), \" \", _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \"(\"\n          }), \"response\", _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \".\"\n          }), _jsx(_components.span, {\n            className: \"token property-access\",\n            children: \"audio\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \")\"\n          }), \" \", _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \"{\"\n          }), \"\\n            \", _jsx(_components.span, {\n            className: \"token keyword\",\n            children: \"const\"\n          }), \" audio \", _jsx(_components.span, {\n            className: \"token operator\",\n            children: \"=\"\n          }), \" \", _jsx(_components.span, {\n            className: \"token function\",\n            children: \"convertBase64ToAudio\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \"(\"\n          }), \"response\", _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \".\"\n          }), _jsx(_components.span, {\n            className: \"token property-access\",\n            children: \"audio\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \")\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \";\"\n          }), \"\\n            \", _jsx(_components.span, {\n            className: \"token function\",\n            children: \"playAudio\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \"(\"\n          }), \"audio\", _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \")\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \";\"\n          }), \"\\n        \", _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \"}\"\n          }), \"\\n        \\n        \", _jsx(_components.span, {\n            className: \"token keyword control-flow\",\n            children: \"return\"\n          }), \" \", _jsx(_components.span, {\n            className: \"token function\",\n            children: \"addMessage\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \"(\"\n          }), _jsx(_components.span, {\n            className: \"token maybe-class-name\",\n            children: \"MessageType\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \".\"\n          }), _jsx(_components.span, {\n            className: \"token property-access\",\n            children: _jsx(_components.span, {\n              className: \"token maybe-class-name\",\n              children: \"Bot\"\n            })\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \",\"\n          }), \" response\", _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \".\"\n          }), _jsx(_components.span, {\n            className: \"token property-access\",\n            children: \"answer\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \")\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \";\"\n          }), \"\\n    \", _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \"}\"\n          }), \"\\n\", _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \"}\"\n          }), _jsxs(_components.span, {\n            \"aria-hidden\": \"true\",\n            className: \"line-numbers-rows\",\n            children: [_jsx(_components.span, {\n              className: \"\"\n            }), _jsx(_components.span, {\n              className: \"\"\n            }), _jsx(_components.span, {\n              className: \"\"\n            }), _jsx(_components.span, {\n              className: \"\"\n            }), _jsx(_components.span, {\n              className: \"\"\n            }), _jsx(_components.span, {\n              className: \"\"\n            }), _jsx(_components.span, {\n              className: \"\"\n            }), _jsx(_components.span, {\n              className: \"\"\n            }), _jsx(_components.span, {\n              className: \"\"\n            }), _jsx(_components.span, {\n              className: \"\"\n            }), _jsx(_components.span, {\n              className: \"\"\n            }), _jsx(_components.span, {\n              className: \"\"\n            }), _jsx(_components.span, {\n              className: \"\"\n            }), _jsx(_components.span, {\n              className: \"\"\n            }), _jsx(_components.span, {\n              className: \"\"\n            }), _jsx(_components.span, {\n              className: \"\"\n            }), _jsx(_components.span, {\n              className: \"\"\n            }), _jsx(_components.span, {\n              className: \"\"\n            }), _jsx(_components.span, {\n              className: \"\"\n            }), _jsx(_components.span, {\n              className: \"\"\n            }), _jsx(_components.span, {\n              className: \"\"\n            }), _jsx(_components.span, {\n              className: \"\"\n            }), _jsx(_components.span, {\n              className: \"\"\n            }), _jsx(_components.span, {\n              className: \"\"\n            }), _jsx(_components.span, {\n              className: \"\"\n            }), _jsx(_components.span, {\n              className: \"\"\n            }), _jsx(_components.span, {\n              className: \"\"\n            }), _jsx(_components.span, {\n              className: \"\"\n            }), _jsx(_components.span, {\n              className: \"\"\n            }), _jsx(_components.span, {\n              className: \"\"\n            }), _jsx(_components.span, {\n              className: \"\"\n            }), _jsx(_components.span, {\n              className: \"\"\n            }), _jsx(_components.span, {\n              className: \"\"\n            }), _jsx(_components.span, {\n              className: \"\"\n            }), _jsx(_components.span, {\n              className: \"\"\n            }), _jsx(_components.span, {\n              className: \"\"\n            }), _jsx(_components.span, {\n              className: \"\"\n            }), _jsx(_components.span, {\n              className: \"\"\n            }), _jsx(_components.span, {\n              className: \"\"\n            }), _jsx(_components.span, {\n              className: \"\"\n            }), _jsx(_components.span, {\n              className: \"\"\n            }), _jsx(_components.span, {\n              className: \"\"\n            }), _jsx(_components.span, {\n              className: \"\"\n            }), _jsx(_components.span, {\n              className: \"\"\n            }), _jsx(_components.span, {\n              className: \"\"\n            }), _jsx(_components.span, {\n              className: \"\"\n            }), _jsx(_components.span, {\n              className: \"\"\n            }), _jsx(_components.span, {\n              className: \"\"\n            }), _jsx(_components.span, {\n              className: \"\"\n            }), _jsx(_components.span, {\n              className: \"\"\n            }), _jsx(_components.span, {\n              className: \"\"\n            }), _jsx(_components.span, {\n              className: \"\"\n            }), _jsx(_components.span, {\n              className: \"\"\n            }), _jsx(_components.span, {\n              className: \"\"\n            }), _jsx(_components.span, {\n              className: \"\"\n            }), _jsx(_components.span, {\n              className: \"\"\n            }), _jsx(_components.span, {\n              className: \"\"\n            }), _jsx(_components.span, {\n              className: \"\"\n            }), _jsx(_components.span, {\n              className: \"\"\n            }), _jsx(_components.span, {\n              className: \"\"\n            }), _jsx(_components.span, {\n              className: \"\"\n            }), _jsx(_components.span, {\n              className: \"\"\n            }), _jsx(_components.span, {\n              className: \"\"\n            }), _jsx(_components.span, {\n              className: \"\"\n            }), _jsx(_components.span, {\n              className: \"\"\n            }), _jsx(_components.span, {\n              className: \"\"\n            })]\n          }), \"\\n\"]\n        })\n      })\n    }), \"\\n\", _jsxs(_components.p, {\n      children: [\"The function will create a new \", _jsx(_components.code, {\n        children: \"HTMLDivElement\"\n      }), \" for the new message and add the\\nCSS class based on the type of the message.\"]\n    }), \"\\n\", _jsx(_components.p, {\n      children: \"Once that is done we store the message in our client-side chat history.\"\n    }), \"\\n\", _jsx(_components.p, {\n      children: \"Next, if the message to be added is from the bot, we display it using a\\n\\\"writting effect\\\". We try to synchronize the audio, if it exists, to the typing\\nspeed by dividing the length of the audio to the number of characters in the\\nmessage.\"\n    }), \"\\n\", _jsxs(_components.p, {\n      children: [\"If the message added is from the user then, we send it to the server to get the\\nanswer from AI by calling the function \", _jsx(_components.code, {\n        children: \"sendMessage\"\n      }), \".\"]\n    }), \"\\n\", _jsxs(_components.p, {\n      children: [\"The function \", _jsx(_components.code, {\n        children: \"sendMessage\"\n      }), \" just makes an HTTP request using \", _jsx(_components.code, {\n        children: \"fetch\"\n      }), \" to our\\nserver.\"]\n    }), \"\\n\", _jsx(_components.p, {\n      children: \"One thing to mention: we generate a random ID for each client that we send with\\neach message so the server knows from where to get the chat history.\"\n    }), \"\\n\", _jsxs(_components.blockquote, {\n      children: [\"\\n\", _jsx(_components.p, {\n        children: \"The alternative to sending an identifying ID to the server would be to send\\nthe whole history each time, but with each message the data that needs to be\\nsent increase.\"\n      }), \"\\n\"]\n    }), \"\\n\", _jsx(_components.div, {\n      className: \"remark-highlight\",\n      children: _jsx(_components.pre, {\n        className: \"language-js  line-numbers\",\n        children: _jsxs(_components.code, {\n          className: \"language-js\",\n          children: [_jsx(_components.span, {\n            className: \"token comment\",\n            children: \"/* version-1/client.js */\"\n          }), \"\\n\", _jsxs(_components.span, {\n            className: \"token doc-comment comment\",\n            children: [\"/**\\n * Create a random ID of given length.\\n * Taken from https://stackoverflow.com/a/1349426\\n * \\n * \", _jsx(_components.span, {\n              className: \"token keyword\",\n              children: \"@param\"\n            }), \" \", _jsxs(_components.span, {\n              className: \"token class-name\",\n              children: [_jsx(_components.span, {\n                className: \"token punctuation\",\n                children: \"{\"\n              }), \"Number\", _jsx(_components.span, {\n                className: \"token punctuation\",\n                children: \"}\"\n              })]\n            }), \" \", _jsx(_components.span, {\n              className: \"token parameter\",\n              children: \"length\"\n            }), \" the length of the generated ID\\n * \", _jsx(_components.span, {\n              className: \"token keyword\",\n              children: \"@returns\"\n            }), \" \", _jsxs(_components.span, {\n              className: \"token class-name\",\n              children: [_jsx(_components.span, {\n                className: \"token punctuation\",\n                children: \"{\"\n              }), \"String\", _jsx(_components.span, {\n                className: \"token punctuation\",\n                children: \"}\"\n              })]\n            }), \" the generated ID\\n */\"]\n          }), \"\\n\", _jsx(_components.span, {\n            className: \"token keyword\",\n            children: \"function\"\n          }), \" \", _jsx(_components.span, {\n            className: \"token function\",\n            children: \"makeID\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \"(\"\n          }), _jsx(_components.span, {\n            className: \"token parameter\",\n            children: \"length\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \")\"\n          }), \" \", _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \"{\"\n          }), \"\\n    \", _jsx(_components.span, {\n            className: \"token keyword\",\n            children: \"let\"\n          }), \" result \", _jsx(_components.span, {\n            className: \"token operator\",\n            children: \"=\"\n          }), \" \", _jsx(_components.span, {\n            className: \"token string\",\n            children: \"''\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \";\"\n          }), \"\\n    \", _jsx(_components.span, {\n            className: \"token keyword\",\n            children: \"const\"\n          }), \" characters \", _jsx(_components.span, {\n            className: \"token operator\",\n            children: \"=\"\n          }), \" \", _jsx(_components.span, {\n            className: \"token string\",\n            children: \"'ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789'\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \";\"\n          }), \"\\n    \", _jsx(_components.span, {\n            className: \"token keyword\",\n            children: \"const\"\n          }), \" charactersLength \", _jsx(_components.span, {\n            className: \"token operator\",\n            children: \"=\"\n          }), \" characters\", _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \".\"\n          }), _jsx(_components.span, {\n            className: \"token property-access\",\n            children: \"length\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \";\"\n          }), \"\\n    \", _jsx(_components.span, {\n            className: \"token keyword\",\n            children: \"let\"\n          }), \" counter \", _jsx(_components.span, {\n            className: \"token operator\",\n            children: \"=\"\n          }), \" \", _jsx(_components.span, {\n            className: \"token number\",\n            children: \"0\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \";\"\n          }), \"\\n    \", _jsx(_components.span, {\n            className: \"token keyword control-flow\",\n            children: \"while\"\n          }), \" \", _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \"(\"\n          }), \"counter \", _jsx(_components.span, {\n            className: \"token operator\",\n            children: \"<\"\n          }), \" length\", _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \")\"\n          }), \" \", _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \"{\"\n          }), \"\\n        result \", _jsx(_components.span, {\n            className: \"token operator\",\n            children: \"+=\"\n          }), \" characters\", _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \".\"\n          }), _jsx(_components.span, {\n            className: \"token method function property-access\",\n            children: \"charAt\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \"(\"\n          }), _jsx(_components.span, {\n            className: \"token known-class-name class-name\",\n            children: \"Math\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \".\"\n          }), _jsx(_components.span, {\n            className: \"token method function property-access\",\n            children: \"floor\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \"(\"\n          }), _jsx(_components.span, {\n            className: \"token known-class-name class-name\",\n            children: \"Math\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \".\"\n          }), _jsx(_components.span, {\n            className: \"token method function property-access\",\n            children: \"random\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \"(\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \")\"\n          }), \" \", _jsx(_components.span, {\n            className: \"token operator\",\n            children: \"*\"\n          }), \" charactersLength\", _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \")\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \")\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \";\"\n          }), \"\\n        counter \", _jsx(_components.span, {\n            className: \"token operator\",\n            children: \"+=\"\n          }), \" \", _jsx(_components.span, {\n            className: \"token number\",\n            children: \"1\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \";\"\n          }), \"\\n    \", _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \"}\"\n          }), \"\\n    \", _jsx(_components.span, {\n            className: \"token keyword control-flow\",\n            children: \"return\"\n          }), \" result\", _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \";\"\n          }), \"\\n\", _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \"}\"\n          }), \"\\n\\n\", _jsx(_components.span, {\n            className: \"token keyword\",\n            children: \"const\"\n          }), \" \", _jsx(_components.span, {\n            className: \"token maybe-class-name\",\n            children: \"ChatID\"\n          }), \" \", _jsx(_components.span, {\n            className: \"token operator\",\n            children: \"=\"\n          }), \" \", _jsx(_components.span, {\n            className: \"token function\",\n            children: \"makeID\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \"(\"\n          }), _jsx(_components.span, {\n            className: \"token number\",\n            children: \"10\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \")\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \";\"\n          }), \"\\n\\n\", _jsx(_components.span, {\n            className: \"token comment\",\n            children: \"// ...\"\n          }), \"\\n\\n\", _jsxs(_components.span, {\n            className: \"token doc-comment comment\",\n            children: [\"/**\\n * Send a message to the server and return the JSON back.\\n * \", _jsx(_components.span, {\n              className: \"token keyword\",\n              children: \"@async\"\n            }), \"\\n * \\n * \", _jsx(_components.span, {\n              className: \"token keyword\",\n              children: \"@param\"\n            }), \" \", _jsxs(_components.span, {\n              className: \"token class-name\",\n              children: [_jsx(_components.span, {\n                className: \"token punctuation\",\n                children: \"{\"\n              }), \"Object\", _jsx(_components.span, {\n                className: \"token punctuation\",\n                children: \"}\"\n              })]\n            }), \" \", _jsx(_components.span, {\n              className: \"token parameter\",\n              children: \"data\"\n            }), \" the data to send\\n * \", _jsx(_components.span, {\n              className: \"token keyword\",\n              children: \"@returns\"\n            }), \" \", _jsxs(_components.span, {\n              className: \"token class-name\",\n              children: [_jsx(_components.span, {\n                className: \"token punctuation\",\n                children: \"{\"\n              }), \"Promise\", _jsx(_components.span, {\n                className: \"token punctuation\",\n                children: \"<\"\n              }), \"Object\", _jsx(_components.span, {\n                className: \"token punctuation\",\n                children: \">\"\n              }), _jsx(_components.span, {\n                className: \"token punctuation\",\n                children: \"}\"\n              })]\n            }), \" the result from the server\\n */\"]\n          }), \"\\n\", _jsx(_components.span, {\n            className: \"token keyword\",\n            children: \"async\"\n          }), \" \", _jsx(_components.span, {\n            className: \"token keyword\",\n            children: \"function\"\n          }), \" \", _jsx(_components.span, {\n            className: \"token function\",\n            children: \"sendMessage\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \"(\"\n          }), _jsxs(_components.span, {\n            className: \"token parameter\",\n            children: [\"data \", _jsx(_components.span, {\n              className: \"token operator\",\n              children: \"=\"\n            }), \" \", _jsx(_components.span, {\n              className: \"token punctuation\",\n              children: \"{\"\n            }), _jsx(_components.span, {\n              className: \"token punctuation\",\n              children: \"}\"\n            })]\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \")\"\n          }), \" \", _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \"{\"\n          }), \"\\n    \", _jsx(_components.span, {\n            className: \"token keyword control-flow\",\n            children: \"try\"\n          }), \" \", _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \"{\"\n          }), \"\\n        \", _jsx(_components.span, {\n            className: \"token keyword\",\n            children: \"const\"\n          }), \" response \", _jsx(_components.span, {\n            className: \"token operator\",\n            children: \"=\"\n          }), \" \", _jsx(_components.span, {\n            className: \"token keyword control-flow\",\n            children: \"await\"\n          }), \" \", _jsx(_components.span, {\n            className: \"token function\",\n            children: \"fetch\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \"(\"\n          }), _jsx(_components.span, {\n            className: \"token maybe-class-name\",\n            children: \"Settings\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \".\"\n          }), _jsx(_components.span, {\n            className: \"token property-access\",\n            children: _jsx(_components.span, {\n              className: \"token maybe-class-name\",\n              children: \"APISendMessage\"\n            })\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \",\"\n          }), \" \", _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \"{\"\n          }), \"\\n            \", _jsx(_components.span, {\n            className: \"token literal-property property\",\n            children: \"method\"\n          }), _jsx(_components.span, {\n            className: \"token operator\",\n            children: \":\"\n          }), \" \", _jsx(_components.span, {\n            className: \"token string\",\n            children: \"\\\"POST\\\"\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \",\"\n          }), \"\\n            \", _jsx(_components.span, {\n            className: \"token literal-property property\",\n            children: \"headers\"\n          }), _jsx(_components.span, {\n            className: \"token operator\",\n            children: \":\"\n          }), \" \", _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \"{\"\n          }), \"\\n                \", _jsx(_components.span, {\n            className: \"token string-property property\",\n            children: \"\\\"Content-Type\\\"\"\n          }), _jsx(_components.span, {\n            className: \"token operator\",\n            children: \":\"\n          }), \" \", _jsx(_components.span, {\n            className: \"token string\",\n            children: \"\\\"application/json\\\"\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \",\"\n          }), \"\\n            \", _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \"}\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \",\"\n          }), \"\\n            \", _jsx(_components.span, {\n            className: \"token literal-property property\",\n            children: \"body\"\n          }), _jsx(_components.span, {\n            className: \"token operator\",\n            children: \":\"\n          }), \" \", _jsx(_components.span, {\n            className: \"token known-class-name class-name\",\n            children: \"JSON\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \".\"\n          }), _jsx(_components.span, {\n            className: \"token method function property-access\",\n            children: \"stringify\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \"(\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \"{\"\n          }), \" \", _jsx(_components.span, {\n            className: \"token literal-property property\",\n            children: \"id\"\n          }), _jsx(_components.span, {\n            className: \"token operator\",\n            children: \":\"\n          }), \" \", _jsx(_components.span, {\n            className: \"token maybe-class-name\",\n            children: \"ChatID\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \",\"\n          }), \" \", _jsx(_components.span, {\n            className: \"token spread operator\",\n            children: \"...\"\n          }), \"data \", _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \"}\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \")\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \",\"\n          }), \"\\n        \", _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \"}\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \")\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \";\"\n          }), \"\\n\\n        \", _jsx(_components.span, {\n            className: \"token keyword control-flow\",\n            children: \"return\"\n          }), \" response\", _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \".\"\n          }), _jsx(_components.span, {\n            className: \"token method function property-access\",\n            children: \"json\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \"(\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \")\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \";\"\n          }), \"        \\n    \", _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \"}\"\n          }), \" \", _jsx(_components.span, {\n            className: \"token keyword control-flow\",\n            children: \"catch\"\n          }), \" \", _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \"(\"\n          }), \"error\", _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \")\"\n          }), \" \", _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \"{\"\n          }), \"\\n        \", _jsx(_components.span, {\n            className: \"token console class-name\",\n            children: \"console\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \".\"\n          }), _jsx(_components.span, {\n            className: \"token method function property-access\",\n            children: \"error\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \"(\"\n          }), _jsx(_components.span, {\n            className: \"token string\",\n            children: \"\\\"Error:\\\"\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \",\"\n          }), \" error\", _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \")\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \";\"\n          }), \"\\n    \", _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \"}\"\n          }), \"\\n\", _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \"}\"\n          }), _jsxs(_components.span, {\n            \"aria-hidden\": \"true\",\n            className: \"line-numbers-rows\",\n            children: [_jsx(_components.span, {\n              className: \"\"\n            }), _jsx(_components.span, {\n              className: \"\"\n            }), _jsx(_components.span, {\n              className: \"\"\n            }), _jsx(_components.span, {\n              className: \"\"\n            }), _jsx(_components.span, {\n              className: \"\"\n            }), _jsx(_components.span, {\n              className: \"\"\n            }), _jsx(_components.span, {\n              className: \"\"\n            }), _jsx(_components.span, {\n              className: \"\"\n            }), _jsx(_components.span, {\n              className: \"\"\n            }), _jsx(_components.span, {\n              className: \"\"\n            }), _jsx(_components.span, {\n              className: \"\"\n            }), _jsx(_components.span, {\n              className: \"\"\n            }), _jsx(_components.span, {\n              className: \"\"\n            }), _jsx(_components.span, {\n              className: \"\"\n            }), _jsx(_components.span, {\n              className: \"\"\n            }), _jsx(_components.span, {\n              className: \"\"\n            }), _jsx(_components.span, {\n              className: \"\"\n            }), _jsx(_components.span, {\n              className: \"\"\n            }), _jsx(_components.span, {\n              className: \"\"\n            }), _jsx(_components.span, {\n              className: \"\"\n            }), _jsx(_components.span, {\n              className: \"\"\n            }), _jsx(_components.span, {\n              className: \"\"\n            }), _jsx(_components.span, {\n              className: \"\"\n            }), _jsx(_components.span, {\n              className: \"\"\n            }), _jsx(_components.span, {\n              className: \"\"\n            }), _jsx(_components.span, {\n              className: \"\"\n            }), _jsx(_components.span, {\n              className: \"\"\n            }), _jsx(_components.span, {\n              className: \"\"\n            }), _jsx(_components.span, {\n              className: \"\"\n            }), _jsx(_components.span, {\n              className: \"\"\n            }), _jsx(_components.span, {\n              className: \"\"\n            }), _jsx(_components.span, {\n              className: \"\"\n            }), _jsx(_components.span, {\n              className: \"\"\n            }), _jsx(_components.span, {\n              className: \"\"\n            }), _jsx(_components.span, {\n              className: \"\"\n            }), _jsx(_components.span, {\n              className: \"\"\n            }), _jsx(_components.span, {\n              className: \"\"\n            }), _jsx(_components.span, {\n              className: \"\"\n            }), _jsx(_components.span, {\n              className: \"\"\n            }), _jsx(_components.span, {\n              className: \"\"\n            }), _jsx(_components.span, {\n              className: \"\"\n            }), _jsx(_components.span, {\n              className: \"\"\n            }), _jsx(_components.span, {\n              className: \"\"\n            }), _jsx(_components.span, {\n              className: \"\"\n            }), _jsx(_components.span, {\n              className: \"\"\n            }), _jsx(_components.span, {\n              className: \"\"\n            })]\n          }), \"\\n\"]\n        })\n      })\n    }), \"\\n\", _jsx(_components.p, {\n      children: \"Before we go to the server side to see how it handles the request, let's see\\nwhat happens when the user clicks on the audio button:\"\n    }), \"\\n\", _jsx(_components.div, {\n      className: \"remark-highlight\",\n      children: _jsx(_components.pre, {\n        className: \"language-js  line-numbers\",\n        children: _jsxs(_components.code, {\n          className: \"language-js\",\n          children: [_jsx(_components.span, {\n            className: \"token comment\",\n            children: \"/* version-1/client.js */\"\n          }), \"\\ninputSpeechElement\", _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \".\"\n          }), _jsx(_components.span, {\n            className: \"token method function property-access\",\n            children: \"addEventListener\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \"(\"\n          }), _jsx(_components.span, {\n            className: \"token string\",\n            children: \"'click'\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \",\"\n          }), \" \", _jsx(_components.span, {\n            className: \"token keyword\",\n            children: \"async\"\n          }), \" \", _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \"(\"\n          }), _jsx(_components.span, {\n            className: \"token parameter\",\n            children: \"_event\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \")\"\n          }), \" \", _jsx(_components.span, {\n            className: \"token arrow operator\",\n            children: \"=>\"\n          }), \" \", _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \"{\"\n          }), \"\\n    inputTextElement\", _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \".\"\n          }), _jsx(_components.span, {\n            className: \"token property-access\",\n            children: \"value\"\n          }), \" \", _jsx(_components.span, {\n            className: \"token operator\",\n            children: \"=\"\n          }), \" \", _jsx(_components.span, {\n            className: \"token string\",\n            children: \"\\\"\\\"\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \";\"\n          }), \"\\n    inputTextElement\", _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \".\"\n          }), _jsx(_components.span, {\n            className: \"token property-access\",\n            children: \"disabled\"\n          }), \" \", _jsx(_components.span, {\n            className: \"token operator\",\n            children: \"=\"\n          }), \" \", _jsx(_components.span, {\n            className: \"token boolean\",\n            children: \"true\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \";\"\n          }), \"\\n    inputSpeechElement\", _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \".\"\n          }), _jsx(_components.span, {\n            className: \"token property-access\",\n            children: \"disabled\"\n          }), \" \", _jsx(_components.span, {\n            className: \"token operator\",\n            children: \"=\"\n          }), \" \", _jsx(_components.span, {\n            className: \"token boolean\",\n            children: \"true\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \";\"\n          }), \"\\n\\n    \", _jsx(_components.span, {\n            className: \"token keyword\",\n            children: \"const\"\n          }), \" stopRecordButtonElement \", _jsx(_components.span, {\n            className: \"token operator\",\n            children: \"=\"\n          }), \" \", _jsx(_components.span, {\n            className: \"token dom variable\",\n            children: \"document\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \".\"\n          }), _jsx(_components.span, {\n            className: \"token method function property-access\",\n            children: \"getElementById\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \"(\"\n          }), _jsx(_components.span, {\n            className: \"token string\",\n            children: \"'friendly-bot-container-stop-record'\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \")\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \";\"\n          }), \"\\n\\n    \", _jsx(_components.span, {\n            className: \"token keyword\",\n            children: \"const\"\n          }), \" base64Audio \", _jsx(_components.span, {\n            className: \"token operator\",\n            children: \"=\"\n          }), \" \", _jsx(_components.span, {\n            className: \"token keyword control-flow\",\n            children: \"await\"\n          }), \" \", _jsx(_components.span, {\n            className: \"token function\",\n            children: \"recordUserAudio\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \"(\"\n          }), \"stopRecordButtonElement\", _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \")\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \";\"\n          }), \"\\n    \", _jsx(_components.span, {\n            className: \"token keyword control-flow\",\n            children: \"await\"\n          }), \" \", _jsx(_components.span, {\n            className: \"token function\",\n            children: \"addMessage\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \"(\"\n          }), _jsx(_components.span, {\n            className: \"token maybe-class-name\",\n            children: \"MessageType\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \".\"\n          }), _jsx(_components.span, {\n            className: \"token property-access\",\n            children: _jsx(_components.span, {\n              className: \"token maybe-class-name\",\n              children: \"UserAudio\"\n            })\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \",\"\n          }), \" base64Audio\", _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \".\"\n          }), _jsx(_components.span, {\n            className: \"token method function property-access\",\n            children: \"substring\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \"(\"\n          }), _jsxs(_components.span, {\n            className: \"token template-string\",\n            children: [_jsx(_components.span, {\n              className: \"token template-punctuation string\",\n              children: \"`\"\n            }), _jsx(_components.span, {\n              className: \"token string\",\n              children: \"data:\"\n            }), _jsxs(_components.span, {\n              className: \"token interpolation\",\n              children: [_jsx(_components.span, {\n                className: \"token interpolation-punctuation punctuation\",\n                children: \"${\"\n              }), _jsx(_components.span, {\n                className: \"token maybe-class-name\",\n                children: \"Settings\"\n              }), _jsx(_components.span, {\n                className: \"token punctuation\",\n                children: \".\"\n              }), _jsx(_components.span, {\n                className: \"token property-access\",\n                children: _jsx(_components.span, {\n                  className: \"token maybe-class-name\",\n                  children: \"ClientAudioMimeType\"\n                })\n              }), _jsx(_components.span, {\n                className: \"token interpolation-punctuation punctuation\",\n                children: \"}\"\n              })]\n            }), _jsx(_components.span, {\n              className: \"token string\",\n              children: \";base64,\"\n            }), _jsx(_components.span, {\n              className: \"token template-punctuation string\",\n              children: \"`\"\n            })]\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \".\"\n          }), _jsx(_components.span, {\n            className: \"token property-access\",\n            children: \"length\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \")\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \")\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \";\"\n          }), \"\\n\\n    inputTextElement\", _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \".\"\n          }), _jsx(_components.span, {\n            className: \"token property-access\",\n            children: \"disabled\"\n          }), \" \", _jsx(_components.span, {\n            className: \"token operator\",\n            children: \"=\"\n          }), \" \", _jsx(_components.span, {\n            className: \"token boolean\",\n            children: \"false\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \";\"\n          }), \"\\n    inputSpeechElement\", _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \".\"\n          }), _jsx(_components.span, {\n            className: \"token property-access\",\n            children: \"disabled\"\n          }), \" \", _jsx(_components.span, {\n            className: \"token operator\",\n            children: \"=\"\n          }), \" \", _jsx(_components.span, {\n            className: \"token boolean\",\n            children: \"false\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \";\"\n          }), \"\\n\", _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \"}\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \")\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \";\"\n          }), _jsxs(_components.span, {\n            \"aria-hidden\": \"true\",\n            className: \"line-numbers-rows\",\n            children: [_jsx(_components.span, {\n              className: \"\"\n            }), _jsx(_components.span, {\n              className: \"\"\n            }), _jsx(_components.span, {\n              className: \"\"\n            }), _jsx(_components.span, {\n              className: \"\"\n            }), _jsx(_components.span, {\n              className: \"\"\n            }), _jsx(_components.span, {\n              className: \"\"\n            }), _jsx(_components.span, {\n              className: \"\"\n            }), _jsx(_components.span, {\n              className: \"\"\n            }), _jsx(_components.span, {\n              className: \"\"\n            }), _jsx(_components.span, {\n              className: \"\"\n            }), _jsx(_components.span, {\n              className: \"\"\n            }), _jsx(_components.span, {\n              className: \"\"\n            }), _jsx(_components.span, {\n              className: \"\"\n            }), _jsx(_components.span, {\n              className: \"\"\n            })]\n          }), \"\\n\"]\n        })\n      })\n    }), \"\\n\", _jsxs(_components.p, {\n      children: [\"It is very similar to the text input handling. The function \", _jsx(_components.code, {\n        children: \"recordUserAudio\"\n      }), \"\\nwill return a base64 encoded audio, and we just cut the header of it before\\nsending it to \", _jsx(_components.code, {\n        children: \"addMessage\"\n      }), \".\"]\n    }), \"\\n\", _jsxs(_components.p, {\n      children: [\"The \", _jsx(_components.code, {\n        children: \"recordUserAudio\"\n      }), \" function will try to get permissions from the user to\\nrecord audio and, if granted, will create a \", _jsx(_components.code, {\n        children: \"MediaRecorder\"\n      }), \" and start recording.\\nWe also will show some UI elements to let know the user we are  recording their\\nvoice and a button to stop the recording when done.\"]\n    }), \"\\n\", _jsxs(_components.p, {\n      children: [\"Once the stop button is hit, we convert the audio chunks to a \", _jsx(_components.code, {\n        children: \"Blob\"\n      }), \" object and\\nthe blob to a base64 encoded string and return it.\"]\n    }), \"\\n\", _jsxs(_components.p, {\n      children: [\"We also go through each audio track and stop them, then remove them. This is\\nnecesarry because, at least on Chrome, calling \", _jsx(_components.code, {\n        children: \"mediaRecorder.stop()\"\n      }), \" will not\\nstop the \\\"listening\\\" state of the microphone.\"]\n    }), \"\\n\", _jsxs(_components.blockquote, {\n      children: [\"\\n\", _jsxs(_components.p, {\n        children: [\"Encoding the audio to \", _jsx(_components.code, {\n          children: \"base64\"\n        }), \" is not a very efficient method of sending the\\naudio to the server, but is a very easy method.\\nWe will look on another method to send the audio to the server in\\n\", _jsx(_components.strong, {\n          children: _jsx(_components.a, {\n            href: \"#the-better-implementation\",\n            children: \"The better implementation\"\n          })\n        }), \" section.\"]\n      }), \"\\n\"]\n    }), \"\\n\", _jsx(_components.div, {\n      className: \"remark-highlight\",\n      children: _jsx(_components.pre, {\n        className: \"language-js  line-numbers\",\n        children: _jsxs(_components.code, {\n          className: \"language-js\",\n          children: [_jsx(_components.span, {\n            className: \"token comment\",\n            children: \"/* version-1/client.js */\"\n          }), \"\\n\", _jsxs(_components.span, {\n            className: \"token doc-comment comment\",\n            children: [\"/**\\n * Record the user and return it as an base64 encoded audio.\\n * \", _jsx(_components.span, {\n              className: \"token keyword\",\n              children: \"@async\"\n            }), \"\\n * \\n * \", _jsx(_components.span, {\n              className: \"token keyword\",\n              children: \"@param\"\n            }), \" \", _jsxs(_components.span, {\n              className: \"token class-name\",\n              children: [_jsx(_components.span, {\n                className: \"token punctuation\",\n                children: \"{\"\n              }), \"HTMLElement\", _jsx(_components.span, {\n                className: \"token punctuation\",\n                children: \"}\"\n              })]\n            }), \" \", _jsx(_components.span, {\n              className: \"token parameter\",\n              children: \"stopRecordButtonElement\"\n            }), \" the stop button element\\n * \", _jsx(_components.span, {\n              className: \"token keyword\",\n              children: \"@returns\"\n            }), \" \", _jsxs(_components.span, {\n              className: \"token class-name\",\n              children: [_jsx(_components.span, {\n                className: \"token punctuation\",\n                children: \"{\"\n              }), \"Promise\", _jsx(_components.span, {\n                className: \"token punctuation\",\n                children: \"<\"\n              }), \"String\", _jsx(_components.span, {\n                className: \"token punctuation\",\n                children: \">\"\n              }), _jsx(_components.span, {\n                className: \"token punctuation\",\n                children: \"}\"\n              })]\n            }), \" the base64 encoded audio\\n */\"]\n          }), \"\\n\", _jsx(_components.span, {\n            className: \"token keyword\",\n            children: \"async\"\n          }), \" \", _jsx(_components.span, {\n            className: \"token keyword\",\n            children: \"function\"\n          }), \" \", _jsx(_components.span, {\n            className: \"token function\",\n            children: \"recordUserAudio\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \"(\"\n          }), _jsx(_components.span, {\n            className: \"token parameter\",\n            children: \"stopRecordButtonElement\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \")\"\n          }), \" \", _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \"{\"\n          }), \"\\n    \", _jsx(_components.span, {\n            className: \"token keyword\",\n            children: \"let\"\n          }), \" stream\", _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \";\"\n          }), \"\\n    \", _jsx(_components.span, {\n            className: \"token keyword control-flow\",\n            children: \"try\"\n          }), \" \", _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \"{\"\n          }), \"\\n        stream \", _jsx(_components.span, {\n            className: \"token operator\",\n            children: \"=\"\n          }), \" \", _jsx(_components.span, {\n            className: \"token keyword control-flow\",\n            children: \"await\"\n          }), \" \", _jsx(_components.span, {\n            className: \"token dom variable\",\n            children: \"navigator\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \".\"\n          }), _jsx(_components.span, {\n            className: \"token property-access\",\n            children: \"mediaDevices\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \".\"\n          }), _jsx(_components.span, {\n            className: \"token method function property-access\",\n            children: \"getUserMedia\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \"(\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \"{\"\n          }), \" \", _jsx(_components.span, {\n            className: \"token literal-property property\",\n            children: \"audio\"\n          }), _jsx(_components.span, {\n            className: \"token operator\",\n            children: \":\"\n          }), \" \", _jsx(_components.span, {\n            className: \"token boolean\",\n            children: \"true\"\n          }), \" \", _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \"}\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \")\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \";\"\n          }), \"\\n    \", _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \"}\"\n          }), \" \", _jsx(_components.span, {\n            className: \"token keyword control-flow\",\n            children: \"catch\"\n          }), \" \", _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \"(\"\n          }), \"error\", _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \")\"\n          }), \" \", _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \"{\"\n          }), \"\\n        \", _jsx(_components.span, {\n            className: \"token console class-name\",\n            children: \"console\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \".\"\n          }), _jsx(_components.span, {\n            className: \"token method function property-access\",\n            children: \"error\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \"(\"\n          }), _jsxs(_components.span, {\n            className: \"token template-string\",\n            children: [_jsx(_components.span, {\n              className: \"token template-punctuation string\",\n              children: \"`\"\n            }), _jsx(_components.span, {\n              className: \"token string\",\n              children: \"The following getUserMedia error occurred: \"\n            }), _jsxs(_components.span, {\n              className: \"token interpolation\",\n              children: [_jsx(_components.span, {\n                className: \"token interpolation-punctuation punctuation\",\n                children: \"${\"\n              }), \"error\", _jsx(_components.span, {\n                className: \"token interpolation-punctuation punctuation\",\n                children: \"}\"\n              })]\n            }), _jsx(_components.span, {\n              className: \"token template-punctuation string\",\n              children: \"`\"\n            })]\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \")\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \";\"\n          }), \"\\n        \", _jsx(_components.span, {\n            className: \"token keyword control-flow\",\n            children: \"return\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \";\"\n          }), \"\\n    \", _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \"}\"\n          }), \"\\n\\n    \", _jsx(_components.span, {\n            className: \"token keyword\",\n            children: \"let\"\n          }), \" chunks \", _jsx(_components.span, {\n            className: \"token operator\",\n            children: \"=\"\n          }), \" \", _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \"[\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \"]\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \";\"\n          }), \"\\n\\n    \", _jsx(_components.span, {\n            className: \"token keyword\",\n            children: \"const\"\n          }), \" mediaRecorder \", _jsx(_components.span, {\n            className: \"token operator\",\n            children: \"=\"\n          }), \" \", _jsx(_components.span, {\n            className: \"token keyword\",\n            children: \"new\"\n          }), \" \", _jsx(_components.span, {\n            className: \"token class-name\",\n            children: \"MediaRecorder\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \"(\"\n          }), \"stream\", _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \",\"\n          }), \" \", _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \"{\"\n          }), \" \", _jsx(_components.span, {\n            className: \"token literal-property property\",\n            children: \"mimeType\"\n          }), _jsx(_components.span, {\n            className: \"token operator\",\n            children: \":\"\n          }), \" \", _jsx(_components.span, {\n            className: \"token maybe-class-name\",\n            children: \"Settings\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \".\"\n          }), _jsx(_components.span, {\n            className: \"token property-access\",\n            children: _jsx(_components.span, {\n              className: \"token maybe-class-name\",\n              children: \"ClientAudioMimeType\"\n            })\n          }), \" \", _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \"}\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \")\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \";\"\n          }), \"\\n\\n    \", _jsx(_components.span, {\n            className: \"token keyword control-flow\",\n            children: \"return\"\n          }), \" \", _jsx(_components.span, {\n            className: \"token keyword\",\n            children: \"new\"\n          }), \" \", _jsx(_components.span, {\n            className: \"token class-name\",\n            children: \"Promise\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \"(\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \"(\"\n          }), _jsxs(_components.span, {\n            className: \"token parameter\",\n            children: [\"resolve\", _jsx(_components.span, {\n              className: \"token punctuation\",\n              children: \",\"\n            }), \" reject\"]\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \")\"\n          }), \" \", _jsx(_components.span, {\n            className: \"token arrow operator\",\n            children: \"=>\"\n          }), \" \", _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \"{\"\n          }), \"\\n        \", _jsx(_components.span, {\n            className: \"token keyword\",\n            children: \"const\"\n          }), \" \", _jsx(_components.span, {\n            className: \"token function-variable function\",\n            children: \"onStopClick\"\n          }), \" \", _jsx(_components.span, {\n            className: \"token operator\",\n            children: \"=\"\n          }), \" \", _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \"(\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \")\"\n          }), \" \", _jsx(_components.span, {\n            className: \"token arrow operator\",\n            children: \"=>\"\n          }), \" \", _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \"{\"\n          }), \"\\n            mediaRecorder\", _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \".\"\n          }), _jsx(_components.span, {\n            className: \"token method function property-access\",\n            children: \"stop\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \"(\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \")\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \";\"\n          }), \"\\n            stopRecordButtonElement\", _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \".\"\n          }), _jsx(_components.span, {\n            className: \"token property-access\",\n            children: \"classList\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \".\"\n          }), _jsx(_components.span, {\n            className: \"token method function property-access\",\n            children: \"remove\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \"(\"\n          }), _jsx(_components.span, {\n            className: \"token string\",\n            children: \"'show'\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \")\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \";\"\n          }), \"\\n        \", _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \"}\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \";\"\n          }), \"\\n\\n        mediaRecorder\", _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \".\"\n          }), _jsx(_components.span, {\n            className: \"token method function property-access\",\n            children: \"addEventListener\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \"(\"\n          }), _jsx(_components.span, {\n            className: \"token string\",\n            children: \"'dataavailable'\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \",\"\n          }), \" \", _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \"(\"\n          }), _jsx(_components.span, {\n            className: \"token parameter\",\n            children: \"event\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \")\"\n          }), \" \", _jsx(_components.span, {\n            className: \"token arrow operator\",\n            children: \"=>\"\n          }), \" \", _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \"{\"\n          }), \"\\n            chunks\", _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \".\"\n          }), _jsx(_components.span, {\n            className: \"token method function property-access\",\n            children: \"push\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \"(\"\n          }), \"event\", _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \".\"\n          }), _jsx(_components.span, {\n            className: \"token property-access\",\n            children: \"data\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \")\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \";\"\n          }), \"\\n        \", _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \"}\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \")\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \";\"\n          }), \"\\n\\n        mediaRecorder\", _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \".\"\n          }), _jsx(_components.span, {\n            className: \"token method function property-access\",\n            children: \"addEventListener\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \"(\"\n          }), _jsx(_components.span, {\n            className: \"token string\",\n            children: \"'stop'\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \",\"\n          }), \" \", _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \"(\"\n          }), _jsx(_components.span, {\n            className: \"token parameter\",\n            children: \"_event\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \")\"\n          }), \" \", _jsx(_components.span, {\n            className: \"token arrow operator\",\n            children: \"=>\"\n          }), \" \", _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \"{\"\n          }), \"\\n            \", _jsx(_components.span, {\n            className: \"token keyword\",\n            children: \"const\"\n          }), \" blob \", _jsx(_components.span, {\n            className: \"token operator\",\n            children: \"=\"\n          }), \" \", _jsx(_components.span, {\n            className: \"token keyword\",\n            children: \"new\"\n          }), \" \", _jsx(_components.span, {\n            className: \"token class-name\",\n            children: \"Blob\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \"(\"\n          }), \"chunks\", _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \",\"\n          }), \" \", _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \"{\"\n          }), \" \", _jsx(_components.span, {\n            className: \"token literal-property property\",\n            children: \"type\"\n          }), _jsx(_components.span, {\n            className: \"token operator\",\n            children: \":\"\n          }), \" \", _jsx(_components.span, {\n            className: \"token maybe-class-name\",\n            children: \"Settings\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \".\"\n          }), _jsx(_components.span, {\n            className: \"token property-access\",\n            children: _jsx(_components.span, {\n              className: \"token maybe-class-name\",\n              children: \"ClientAudioMimeType\"\n            })\n          }), \" \", _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \"}\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \")\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \";\"\n          }), \"\\n            chunks \", _jsx(_components.span, {\n            className: \"token operator\",\n            children: \"=\"\n          }), \" \", _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \"[\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \"]\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \";\"\n          }), \"\\n\\n            \", _jsx(_components.span, {\n            className: \"token keyword\",\n            children: \"const\"\n          }), \" base64AudioPromise \", _jsx(_components.span, {\n            className: \"token operator\",\n            children: \"=\"\n          }), \" \", _jsx(_components.span, {\n            className: \"token function\",\n            children: \"blobToBase64\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \"(\"\n          }), \"blob\", _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \")\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \";\"\n          }), \"\\n\\n            stopRecordButtonElement\", _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \".\"\n          }), _jsx(_components.span, {\n            className: \"token method function property-access\",\n            children: \"removeEventListener\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \"(\"\n          }), _jsx(_components.span, {\n            className: \"token string\",\n            children: \"'click'\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \",\"\n          }), \" onStopClick\", _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \")\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \";\"\n          }), \"\\n\\n            \", _jsx(_components.span, {\n            className: \"token comment\",\n            children: \"// Stop the audio listening\"\n          }), \"\\n            stream\", _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \".\"\n          }), _jsx(_components.span, {\n            className: \"token method function property-access\",\n            children: \"getAudioTracks\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \"(\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \")\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \".\"\n          }), _jsx(_components.span, {\n            className: \"token method function property-access\",\n            children: \"forEach\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \"(\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \"(\"\n          }), _jsx(_components.span, {\n            className: \"token parameter\",\n            children: \"track\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \")\"\n          }), \" \", _jsx(_components.span, {\n            className: \"token arrow operator\",\n            children: \"=>\"\n          }), \" \", _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \"{\"\n          }), \"\\n                track\", _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \".\"\n          }), _jsx(_components.span, {\n            className: \"token method function property-access\",\n            children: \"stop\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \"(\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \")\"\n          }), \"\\n                stream\", _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \".\"\n          }), _jsx(_components.span, {\n            className: \"token method function property-access\",\n            children: \"removeTrack\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \"(\"\n          }), \"track\", _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \")\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \";\"\n          }), \"\\n            \", _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \"}\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \")\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \";\"\n          }), \"\\n\\n            base64AudioPromise\", _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \".\"\n          }), _jsx(_components.span, {\n            className: \"token method function property-access\",\n            children: \"then\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \"(\"\n          }), \"resolve\", _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \")\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \".\"\n          }), _jsx(_components.span, {\n            className: \"token keyword control-flow\",\n            children: \"catch\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \"(\"\n          }), \"reject\", _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \")\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \";\"\n          }), \"\\n        \", _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \"}\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \")\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \";\"\n          }), \"\\n\\n        stopRecordButtonElement\", _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \".\"\n          }), _jsx(_components.span, {\n            className: \"token property-access\",\n            children: \"classList\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \".\"\n          }), _jsx(_components.span, {\n            className: \"token method function property-access\",\n            children: \"add\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \"(\"\n          }), _jsx(_components.span, {\n            className: \"token string\",\n            children: \"'show'\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \")\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \";\"\n          }), \"\\n\\n        mediaRecorder\", _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \".\"\n          }), _jsx(_components.span, {\n            className: \"token method function property-access\",\n            children: \"start\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \"(\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \")\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \";\"\n          }), \"\\n\\n        stopRecordButtonElement\", _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \".\"\n          }), _jsx(_components.span, {\n            className: \"token method function property-access\",\n            children: \"addEventListener\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \"(\"\n          }), _jsx(_components.span, {\n            className: \"token string\",\n            children: \"'click'\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \",\"\n          }), \" onStopClick\", _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \")\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \";\"\n          }), \"\\n    \", _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \"}\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \")\"\n          }), \"\\n\", _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \"}\"\n          }), _jsxs(_components.span, {\n            \"aria-hidden\": \"true\",\n            className: \"line-numbers-rows\",\n            children: [_jsx(_components.span, {\n              className: \"\"\n            }), _jsx(_components.span, {\n              className: \"\"\n            }), _jsx(_components.span, {\n              className: \"\"\n            }), _jsx(_components.span, {\n              className: \"\"\n            }), _jsx(_components.span, {\n              className: \"\"\n            }), _jsx(_components.span, {\n              className: \"\"\n            }), _jsx(_components.span, {\n              className: \"\"\n            }), _jsx(_components.span, {\n              className: \"\"\n            }), _jsx(_components.span, {\n              className: \"\"\n            }), _jsx(_components.span, {\n              className: \"\"\n            }), _jsx(_components.span, {\n              className: \"\"\n            }), _jsx(_components.span, {\n              className: \"\"\n            }), _jsx(_components.span, {\n              className: \"\"\n            }), _jsx(_components.span, {\n              className: \"\"\n            }), _jsx(_components.span, {\n              className: \"\"\n            }), _jsx(_components.span, {\n              className: \"\"\n            }), _jsx(_components.span, {\n              className: \"\"\n            }), _jsx(_components.span, {\n              className: \"\"\n            }), _jsx(_components.span, {\n              className: \"\"\n            }), _jsx(_components.span, {\n              className: \"\"\n            }), _jsx(_components.span, {\n              className: \"\"\n            }), _jsx(_components.span, {\n              className: \"\"\n            }), _jsx(_components.span, {\n              className: \"\"\n            }), _jsx(_components.span, {\n              className: \"\"\n            }), _jsx(_components.span, {\n              className: \"\"\n            }), _jsx(_components.span, {\n              className: \"\"\n            }), _jsx(_components.span, {\n              className: \"\"\n            }), _jsx(_components.span, {\n              className: \"\"\n            }), _jsx(_components.span, {\n              className: \"\"\n            }), _jsx(_components.span, {\n              className: \"\"\n            }), _jsx(_components.span, {\n              className: \"\"\n            }), _jsx(_components.span, {\n              className: \"\"\n            }), _jsx(_components.span, {\n              className: \"\"\n            }), _jsx(_components.span, {\n              className: \"\"\n            }), _jsx(_components.span, {\n              className: \"\"\n            }), _jsx(_components.span, {\n              className: \"\"\n            }), _jsx(_components.span, {\n              className: \"\"\n            }), _jsx(_components.span, {\n              className: \"\"\n            }), _jsx(_components.span, {\n              className: \"\"\n            }), _jsx(_components.span, {\n              className: \"\"\n            }), _jsx(_components.span, {\n              className: \"\"\n            }), _jsx(_components.span, {\n              className: \"\"\n            }), _jsx(_components.span, {\n              className: \"\"\n            }), _jsx(_components.span, {\n              className: \"\"\n            }), _jsx(_components.span, {\n              className: \"\"\n            }), _jsx(_components.span, {\n              className: \"\"\n            }), _jsx(_components.span, {\n              className: \"\"\n            }), _jsx(_components.span, {\n              className: \"\"\n            }), _jsx(_components.span, {\n              className: \"\"\n            }), _jsx(_components.span, {\n              className: \"\"\n            }), _jsx(_components.span, {\n              className: \"\"\n            }), _jsx(_components.span, {\n              className: \"\"\n            }), _jsx(_components.span, {\n              className: \"\"\n            }), _jsx(_components.span, {\n              className: \"\"\n            }), _jsx(_components.span, {\n              className: \"\"\n            })]\n          }), \"\\n\"]\n        })\n      })\n    }), \"\\n\", _jsx(_components.p, {\n      children: \"Let's look now how the request is handled on the server:\"\n    }), \"\\n\", _jsx(_components.div, {\n      className: \"remark-highlight\",\n      children: _jsx(_components.pre, {\n        className: \"language-js  line-numbers\",\n        children: _jsxs(_components.code, {\n          className: \"language-js\",\n          children: [_jsx(_components.span, {\n            className: \"token comment\",\n            children: \"/* version-1/server.js */\"\n          }), \"\\napp\", _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \".\"\n          }), _jsx(_components.span, {\n            className: \"token method function property-access\",\n            children: \"post\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \"(\"\n          }), _jsx(_components.span, {\n            className: \"token string\",\n            children: \"'/api/message'\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \",\"\n          }), \" \", _jsx(_components.span, {\n            className: \"token keyword\",\n            children: \"async\"\n          }), \" \", _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \"(\"\n          }), _jsxs(_components.span, {\n            className: \"token parameter\",\n            children: [\"req\", _jsx(_components.span, {\n              className: \"token punctuation\",\n              children: \",\"\n            }), \" res\"]\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \")\"\n          }), \" \", _jsx(_components.span, {\n            className: \"token arrow operator\",\n            children: \"=>\"\n          }), \" \", _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \"{\"\n          }), \"\\n    \", _jsx(_components.span, {\n            className: \"token keyword control-flow\",\n            children: \"if\"\n          }), \" \", _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \"(\"\n          }), _jsx(_components.span, {\n            className: \"token operator\",\n            children: \"!\"\n          }), \"req\", _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \".\"\n          }), _jsx(_components.span, {\n            className: \"token property-access\",\n            children: \"body\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \".\"\n          }), _jsx(_components.span, {\n            className: \"token property-access\",\n            children: \"message\"\n          }), \" \", _jsx(_components.span, {\n            className: \"token operator\",\n            children: \"&&\"\n          }), \" \", _jsx(_components.span, {\n            className: \"token operator\",\n            children: \"!\"\n          }), \"req\", _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \".\"\n          }), _jsx(_components.span, {\n            className: \"token property-access\",\n            children: \"body\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \".\"\n          }), _jsx(_components.span, {\n            className: \"token property-access\",\n            children: \"audio\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \")\"\n          }), \" \", _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \"{\"\n          }), \"\\n        res\", _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \".\"\n          }), _jsx(_components.span, {\n            className: \"token method function property-access\",\n            children: \"status\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \"(\"\n          }), _jsx(_components.span, {\n            className: \"token number\",\n            children: \"400\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \")\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \".\"\n          }), _jsx(_components.span, {\n            className: \"token method function property-access\",\n            children: \"send\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \"(\"\n          }), _jsx(_components.span, {\n            className: \"token string\",\n            children: \"'Missing \\\"message\\\" or \\\"audio\\\"'\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \")\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \";\"\n          }), \"\\n    \", _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \"}\"\n          }), \"\\n\\n    \", _jsx(_components.span, {\n            className: \"token keyword control-flow\",\n            children: \"if\"\n          }), \" \", _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \"(\"\n          }), \"req\", _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \".\"\n          }), _jsx(_components.span, {\n            className: \"token property-access\",\n            children: \"body\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \".\"\n          }), _jsx(_components.span, {\n            className: \"token property-access\",\n            children: \"message\"\n          }), \" \", _jsx(_components.span, {\n            className: \"token operator\",\n            children: \"&&\"\n          }), \" req\", _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \".\"\n          }), _jsx(_components.span, {\n            className: \"token property-access\",\n            children: \"body\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \".\"\n          }), _jsx(_components.span, {\n            className: \"token property-access\",\n            children: \"audio\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \")\"\n          }), \" \", _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \"{\"\n          }), \"\\n        res\", _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \".\"\n          }), _jsx(_components.span, {\n            className: \"token method function property-access\",\n            children: \"status\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \"(\"\n          }), _jsx(_components.span, {\n            className: \"token number\",\n            children: \"400\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \")\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \".\"\n          }), _jsx(_components.span, {\n            className: \"token method function property-access\",\n            children: \"send\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \"(\"\n          }), _jsx(_components.span, {\n            className: \"token string\",\n            children: \"'Cannot be both \\\"message\\\" and \\\"audio\\\"'\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \")\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \";\"\n          }), \"\\n    \", _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \"}\"\n          }), \"\\n\\n    \", _jsx(_components.span, {\n            className: \"token keyword control-flow\",\n            children: \"if\"\n          }), \" \", _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \"(\"\n          }), _jsx(_components.span, {\n            className: \"token operator\",\n            children: \"!\"\n          }), \"req\", _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \".\"\n          }), _jsx(_components.span, {\n            className: \"token property-access\",\n            children: \"body\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \".\"\n          }), _jsx(_components.span, {\n            className: \"token property-access\",\n            children: \"id\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \")\"\n          }), \" \", _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \"{\"\n          }), \"\\n        res\", _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \".\"\n          }), _jsx(_components.span, {\n            className: \"token method function property-access\",\n            children: \"status\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \"(\"\n          }), _jsx(_components.span, {\n            className: \"token number\",\n            children: \"400\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \")\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \".\"\n          }), _jsx(_components.span, {\n            className: \"token method function property-access\",\n            children: \"send\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \"(\"\n          }), _jsx(_components.span, {\n            className: \"token string\",\n            children: \"'Missing \\\"id\\\"'\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \")\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \";\"\n          }), \"\\n    \", _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \"}\"\n          }), \"\\n\\n    \", _jsx(_components.span, {\n            className: \"token keyword\",\n            children: \"const\"\n          }), \" messages \", _jsx(_components.span, {\n            className: \"token operator\",\n            children: \"=\"\n          }), \" \", _jsx(_components.span, {\n            className: \"token function\",\n            children: \"getChatMessages\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \"(\"\n          }), \"chatHistory\", _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \",\"\n          }), \" req\", _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \".\"\n          }), _jsx(_components.span, {\n            className: \"token property-access\",\n            children: \"body\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \".\"\n          }), _jsx(_components.span, {\n            className: \"token property-access\",\n            children: \"id\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \")\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \";\"\n          }), \"\\n    \\n    \", _jsx(_components.span, {\n            className: \"token keyword control-flow\",\n            children: \"if\"\n          }), \" \", _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \"(\"\n          }), \"req\", _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \".\"\n          }), _jsx(_components.span, {\n            className: \"token property-access\",\n            children: \"body\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \".\"\n          }), _jsx(_components.span, {\n            className: \"token property-access\",\n            children: \"message\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \")\"\n          }), \" \", _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \"{\"\n          }), \"\\n        messages\", _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \".\"\n          }), _jsx(_components.span, {\n            className: \"token method function property-access\",\n            children: \"push\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \"(\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \"{\"\n          }), \" \", _jsx(_components.span, {\n            className: \"token literal-property property\",\n            children: \"role\"\n          }), _jsx(_components.span, {\n            className: \"token operator\",\n            children: \":\"\n          }), \" \", _jsx(_components.span, {\n            className: \"token string\",\n            children: \"\\\"user\\\"\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \",\"\n          }), \" \", _jsx(_components.span, {\n            className: \"token literal-property property\",\n            children: \"content\"\n          }), _jsx(_components.span, {\n            className: \"token operator\",\n            children: \":\"\n          }), \" req\", _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \".\"\n          }), _jsx(_components.span, {\n            className: \"token property-access\",\n            children: \"body\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \".\"\n          }), _jsx(_components.span, {\n            className: \"token property-access\",\n            children: \"message\"\n          }), \" \", _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \"}\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \")\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \";\"\n          }), \"\\n    \", _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \"}\"\n          }), \" \", _jsx(_components.span, {\n            className: \"token keyword control-flow\",\n            children: \"else\"\n          }), \" \", _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \"{\"\n          }), \"\\n        \", _jsx(_components.span, {\n            className: \"token keyword\",\n            children: \"let\"\n          }), \" content\", _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \";\"\n          }), \"\\n        \", _jsx(_components.span, {\n            className: \"token keyword control-flow\",\n            children: \"try\"\n          }), \" \", _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \"{\"\n          }), \"\\n            content \", _jsx(_components.span, {\n            className: \"token operator\",\n            children: \"=\"\n          }), \" \", _jsx(_components.span, {\n            className: \"token keyword control-flow\",\n            children: \"await\"\n          }), \" \", _jsx(_components.span, {\n            className: \"token function\",\n            children: \"stt\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \"(\"\n          }), \"openai\", _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \",\"\n          }), \" req\", _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \".\"\n          }), _jsx(_components.span, {\n            className: \"token property-access\",\n            children: \"body\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \".\"\n          }), _jsx(_components.span, {\n            className: \"token property-access\",\n            children: \"audio\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \")\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \";\"\n          }), \"\\n        \", _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \"}\"\n          }), \" \", _jsx(_components.span, {\n            className: \"token keyword control-flow\",\n            children: \"catch\"\n          }), \" \", _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \"(\"\n          }), \"error\", _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \")\"\n          }), \" \", _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \"{\"\n          }), \"\\n            \", _jsx(_components.span, {\n            className: \"token console class-name\",\n            children: \"console\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \".\"\n          }), _jsx(_components.span, {\n            className: \"token method function property-access\",\n            children: \"error\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \"(\"\n          }), _jsxs(_components.span, {\n            className: \"token template-string\",\n            children: [_jsx(_components.span, {\n              className: \"token template-punctuation string\",\n              children: \"`\"\n            }), _jsx(_components.span, {\n              className: \"token string\",\n              children: \"(ChatID: \"\n            }), _jsxs(_components.span, {\n              className: \"token interpolation\",\n              children: [_jsx(_components.span, {\n                className: \"token interpolation-punctuation punctuation\",\n                children: \"${\"\n              }), \"req\", _jsx(_components.span, {\n                className: \"token punctuation\",\n                children: \".\"\n              }), _jsx(_components.span, {\n                className: \"token property-access\",\n                children: \"body\"\n              }), _jsx(_components.span, {\n                className: \"token punctuation\",\n                children: \".\"\n              }), _jsx(_components.span, {\n                className: \"token property-access\",\n                children: \"id\"\n              }), _jsx(_components.span, {\n                className: \"token interpolation-punctuation punctuation\",\n                children: \"}\"\n              })]\n            }), _jsx(_components.span, {\n              className: \"token string\",\n              children: \") Error when trying to convert the user's audio to text:\"\n            }), _jsx(_components.span, {\n              className: \"token template-punctuation string\",\n              children: \"`\"\n            })]\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \")\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \";\"\n          }), \"\\n            \", _jsx(_components.span, {\n            className: \"token console class-name\",\n            children: \"console\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \".\"\n          }), _jsx(_components.span, {\n            className: \"token method function property-access\",\n            children: \"error\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \"(\"\n          }), \"error\", _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \")\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \";\"\n          }), \"\\n            res\", _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \".\"\n          }), _jsx(_components.span, {\n            className: \"token method function property-access\",\n            children: \"status\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \"(\"\n          }), _jsx(_components.span, {\n            className: \"token number\",\n            children: \"500\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \")\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \".\"\n          }), _jsx(_components.span, {\n            className: \"token method function property-access\",\n            children: \"end\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \"(\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \")\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \";\"\n          }), \"\\n            \", _jsx(_components.span, {\n            className: \"token keyword control-flow\",\n            children: \"return\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \";\"\n          }), \"\\n        \", _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \"}\"\n          }), \"\\n\\n        messages\", _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \".\"\n          }), _jsx(_components.span, {\n            className: \"token method function property-access\",\n            children: \"push\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \"(\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \"{\"\n          }), \" \", _jsx(_components.span, {\n            className: \"token literal-property property\",\n            children: \"role\"\n          }), _jsx(_components.span, {\n            className: \"token operator\",\n            children: \":\"\n          }), \" \", _jsx(_components.span, {\n            className: \"token string\",\n            children: \"\\\"user\\\"\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \",\"\n          }), \" content \", _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \"}\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \")\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \";\"\n          }), \"\\n    \", _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \"}\"\n          }), \"\\n\\n    \", _jsx(_components.span, {\n            className: \"token keyword\",\n            children: \"let\"\n          }), \" answer\", _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \";\"\n          }), \"\\n    \", _jsx(_components.span, {\n            className: \"token keyword control-flow\",\n            children: \"try\"\n          }), \" \", _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \"{\"\n          }), \"\\n        answer \", _jsx(_components.span, {\n            className: \"token operator\",\n            children: \"=\"\n          }), \" \", _jsx(_components.span, {\n            className: \"token keyword control-flow\",\n            children: \"await\"\n          }), \" \", _jsx(_components.span, {\n            className: \"token function\",\n            children: \"getAnswer\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \"(\"\n          }), \"openai\", _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \",\"\n          }), \" messages\", _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \")\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \";\"\n          }), \"\\n    \", _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \"}\"\n          }), \" \", _jsx(_components.span, {\n            className: \"token keyword control-flow\",\n            children: \"catch\"\n          }), \" \", _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \"(\"\n          }), \"error\", _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \")\"\n          }), \" \", _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \"{\"\n          }), \"\\n        \", _jsx(_components.span, {\n            className: \"token console class-name\",\n            children: \"console\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \".\"\n          }), _jsx(_components.span, {\n            className: \"token method function property-access\",\n            children: \"error\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \"(\"\n          }), _jsxs(_components.span, {\n            className: \"token template-string\",\n            children: [_jsx(_components.span, {\n              className: \"token template-punctuation string\",\n              children: \"`\"\n            }), _jsx(_components.span, {\n              className: \"token string\",\n              children: \"(ChatID: \"\n            }), _jsxs(_components.span, {\n              className: \"token interpolation\",\n              children: [_jsx(_components.span, {\n                className: \"token interpolation-punctuation punctuation\",\n                children: \"${\"\n              }), \"req\", _jsx(_components.span, {\n                className: \"token punctuation\",\n                children: \".\"\n              }), _jsx(_components.span, {\n                className: \"token property-access\",\n                children: \"body\"\n              }), _jsx(_components.span, {\n                className: \"token punctuation\",\n                children: \".\"\n              }), _jsx(_components.span, {\n                className: \"token property-access\",\n                children: \"id\"\n              }), _jsx(_components.span, {\n                className: \"token interpolation-punctuation punctuation\",\n                children: \"}\"\n              })]\n            }), _jsx(_components.span, {\n              className: \"token string\",\n              children: \") Error when trying to get an answer from ChatGPT:\"\n            }), _jsx(_components.span, {\n              className: \"token template-punctuation string\",\n              children: \"`\"\n            })]\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \")\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \";\"\n          }), \"\\n        \", _jsx(_components.span, {\n            className: \"token console class-name\",\n            children: \"console\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \".\"\n          }), _jsx(_components.span, {\n            className: \"token method function property-access\",\n            children: \"error\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \"(\"\n          }), \"error\", _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \")\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \";\"\n          }), \"\\n        res\", _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \".\"\n          }), _jsx(_components.span, {\n            className: \"token method function property-access\",\n            children: \"status\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \"(\"\n          }), _jsx(_components.span, {\n            className: \"token number\",\n            children: \"500\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \")\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \".\"\n          }), _jsx(_components.span, {\n            className: \"token method function property-access\",\n            children: \"end\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \"(\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \")\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \";\"\n          }), \"\\n        \", _jsx(_components.span, {\n            className: \"token keyword control-flow\",\n            children: \"return\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \";\"\n          }), \"\\n    \", _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \"}\"\n          }), \"\\n\\n    \", _jsx(_components.span, {\n            className: \"token keyword\",\n            children: \"let\"\n          }), \" audio\", _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \";\"\n          }), \"\\n    \", _jsx(_components.span, {\n            className: \"token keyword control-flow\",\n            children: \"if\"\n          }), \" \", _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \"(\"\n          }), _jsx(_components.span, {\n            className: \"token maybe-class-name\",\n            children: \"Settings\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \".\"\n          }), _jsx(_components.span, {\n            className: \"token property-access\",\n            children: _jsx(_components.span, {\n              className: \"token maybe-class-name\",\n              children: \"CreateAudioOfAnswer\"\n            })\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \")\"\n          }), \" \", _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \"{\"\n          }), \"\\n        \", _jsx(_components.span, {\n            className: \"token keyword control-flow\",\n            children: \"try\"\n          }), \" \", _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \"{\"\n          }), \"\\n            audio \", _jsx(_components.span, {\n            className: \"token operator\",\n            children: \"=\"\n          }), \" \", _jsx(_components.span, {\n            className: \"token keyword control-flow\",\n            children: \"await\"\n          }), \" \", _jsx(_components.span, {\n            className: \"token function\",\n            children: \"tts\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \"(\"\n          }), \"openai\", _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \",\"\n          }), \" answer\", _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \")\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \";\"\n          }), \"\\n        \", _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \"}\"\n          }), \" \", _jsx(_components.span, {\n            className: \"token keyword control-flow\",\n            children: \"catch\"\n          }), \" \", _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \"(\"\n          }), \"error\", _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \")\"\n          }), \" \", _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \"{\"\n          }), \"\\n            \", _jsx(_components.span, {\n            className: \"token console class-name\",\n            children: \"console\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \".\"\n          }), _jsx(_components.span, {\n            className: \"token method function property-access\",\n            children: \"error\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \"(\"\n          }), _jsxs(_components.span, {\n            className: \"token template-string\",\n            children: [_jsx(_components.span, {\n              className: \"token template-punctuation string\",\n              children: \"`\"\n            }), _jsx(_components.span, {\n              className: \"token string\",\n              children: \"(ChatID: \"\n            }), _jsxs(_components.span, {\n              className: \"token interpolation\",\n              children: [_jsx(_components.span, {\n                className: \"token interpolation-punctuation punctuation\",\n                children: \"${\"\n              }), \"req\", _jsx(_components.span, {\n                className: \"token punctuation\",\n                children: \".\"\n              }), _jsx(_components.span, {\n                className: \"token property-access\",\n                children: \"body\"\n              }), _jsx(_components.span, {\n                className: \"token punctuation\",\n                children: \".\"\n              }), _jsx(_components.span, {\n                className: \"token property-access\",\n                children: \"id\"\n              }), _jsx(_components.span, {\n                className: \"token interpolation-punctuation punctuation\",\n                children: \"}\"\n              })]\n            }), _jsx(_components.span, {\n              className: \"token string\",\n              children: \") Error when trying to convert the ChatGPT's answer to audio:\"\n            }), _jsx(_components.span, {\n              className: \"token template-punctuation string\",\n              children: \"`\"\n            })]\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \")\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \";\"\n          }), \"\\n            \", _jsx(_components.span, {\n            className: \"token console class-name\",\n            children: \"console\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \".\"\n          }), _jsx(_components.span, {\n            className: \"token method function property-access\",\n            children: \"error\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \"(\"\n          }), \"error\", _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \")\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \";\"\n          }), \"\\n            res\", _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \".\"\n          }), _jsx(_components.span, {\n            className: \"token method function property-access\",\n            children: \"status\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \"(\"\n          }), _jsx(_components.span, {\n            className: \"token number\",\n            children: \"500\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \")\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \".\"\n          }), _jsx(_components.span, {\n            className: \"token method function property-access\",\n            children: \"end\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \"(\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \")\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \";\"\n          }), \"\\n            \", _jsx(_components.span, {\n            className: \"token keyword control-flow\",\n            children: \"return\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \";\"\n          }), \"\\n        \", _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \"}\"\n          }), \"\\n    \", _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \"}\"\n          }), \"\\n\\n    messages\", _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \".\"\n          }), _jsx(_components.span, {\n            className: \"token method function property-access\",\n            children: \"push\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \"(\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \"{\"\n          }), \" \", _jsx(_components.span, {\n            className: \"token literal-property property\",\n            children: \"role\"\n          }), _jsx(_components.span, {\n            className: \"token operator\",\n            children: \":\"\n          }), \" \", _jsx(_components.span, {\n            className: \"token string\",\n            children: \"\\\"assistant\\\"\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \",\"\n          }), \" \", _jsx(_components.span, {\n            className: \"token literal-property property\",\n            children: \"content\"\n          }), _jsx(_components.span, {\n            className: \"token operator\",\n            children: \":\"\n          }), \" answer \", _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \"}\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \")\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \";\"\n          }), \"\\n\\n    res\", _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \".\"\n          }), _jsx(_components.span, {\n            className: \"token method function property-access\",\n            children: \"json\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \"(\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \"{\"\n          }), \" answer\", _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \",\"\n          }), \" audio \", _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \"}\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \")\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \";\"\n          }), \"\\n\", _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \"}\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \")\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \";\"\n          }), _jsxs(_components.span, {\n            \"aria-hidden\": \"true\",\n            className: \"line-numbers-rows\",\n            children: [_jsx(_components.span, {\n              className: \"\"\n            }), _jsx(_components.span, {\n              className: \"\"\n            }), _jsx(_components.span, {\n              className: \"\"\n            }), _jsx(_components.span, {\n              className: \"\"\n            }), _jsx(_components.span, {\n              className: \"\"\n            }), _jsx(_components.span, {\n              className: \"\"\n            }), _jsx(_components.span, {\n              className: \"\"\n            }), _jsx(_components.span, {\n              className: \"\"\n            }), _jsx(_components.span, {\n              className: \"\"\n            }), _jsx(_components.span, {\n              className: \"\"\n            }), _jsx(_components.span, {\n              className: \"\"\n            }), _jsx(_components.span, {\n              className: \"\"\n            }), _jsx(_components.span, {\n              className: \"\"\n            }), _jsx(_components.span, {\n              className: \"\"\n            }), _jsx(_components.span, {\n              className: \"\"\n            }), _jsx(_components.span, {\n              className: \"\"\n            }), _jsx(_components.span, {\n              className: \"\"\n            }), _jsx(_components.span, {\n              className: \"\"\n            }), _jsx(_components.span, {\n              className: \"\"\n            }), _jsx(_components.span, {\n              className: \"\"\n            }), _jsx(_components.span, {\n              className: \"\"\n            }), _jsx(_components.span, {\n              className: \"\"\n            }), _jsx(_components.span, {\n              className: \"\"\n            }), _jsx(_components.span, {\n              className: \"\"\n            }), _jsx(_components.span, {\n              className: \"\"\n            }), _jsx(_components.span, {\n              className: \"\"\n            }), _jsx(_components.span, {\n              className: \"\"\n            }), _jsx(_components.span, {\n              className: \"\"\n            }), _jsx(_components.span, {\n              className: \"\"\n            }), _jsx(_components.span, {\n              className: \"\"\n            }), _jsx(_components.span, {\n              className: \"\"\n            }), _jsx(_components.span, {\n              className: \"\"\n            }), _jsx(_components.span, {\n              className: \"\"\n            }), _jsx(_components.span, {\n              className: \"\"\n            }), _jsx(_components.span, {\n              className: \"\"\n            }), _jsx(_components.span, {\n              className: \"\"\n            }), _jsx(_components.span, {\n              className: \"\"\n            }), _jsx(_components.span, {\n              className: \"\"\n            }), _jsx(_components.span, {\n              className: \"\"\n            }), _jsx(_components.span, {\n              className: \"\"\n            }), _jsx(_components.span, {\n              className: \"\"\n            }), _jsx(_components.span, {\n              className: \"\"\n            }), _jsx(_components.span, {\n              className: \"\"\n            }), _jsx(_components.span, {\n              className: \"\"\n            }), _jsx(_components.span, {\n              className: \"\"\n            }), _jsx(_components.span, {\n              className: \"\"\n            }), _jsx(_components.span, {\n              className: \"\"\n            }), _jsx(_components.span, {\n              className: \"\"\n            }), _jsx(_components.span, {\n              className: \"\"\n            }), _jsx(_components.span, {\n              className: \"\"\n            }), _jsx(_components.span, {\n              className: \"\"\n            }), _jsx(_components.span, {\n              className: \"\"\n            }), _jsx(_components.span, {\n              className: \"\"\n            }), _jsx(_components.span, {\n              className: \"\"\n            }), _jsx(_components.span, {\n              className: \"\"\n            }), _jsx(_components.span, {\n              className: \"\"\n            }), _jsx(_components.span, {\n              className: \"\"\n            }), _jsx(_components.span, {\n              className: \"\"\n            })]\n          }), \"\\n\"]\n        })\n      })\n    }), \"\\n\", _jsx(_components.p, {\n      children: \"After we check that the client sent the required data, we get the chat history\\nfor the given ID (or create a new chat history):\"\n    }), \"\\n\", _jsx(_components.div, {\n      className: \"remark-highlight\",\n      children: _jsx(_components.pre, {\n        className: \"language-js  line-numbers\",\n        children: _jsxs(_components.code, {\n          className: \"language-js\",\n          children: [_jsx(_components.span, {\n            className: \"token comment\",\n            children: \"/* version-1/server.js */\"\n          }), \"\\n\", _jsxs(_components.span, {\n            className: \"token doc-comment comment\",\n            children: [\"/**\\n * Get the chat history, or create a new one or the given ID.\\n * \\n * \", _jsx(_components.span, {\n              className: \"token keyword\",\n              children: \"@param\"\n            }), \" \", _jsxs(_components.span, {\n              className: \"token class-name\",\n              children: [_jsx(_components.span, {\n                className: \"token punctuation\",\n                children: \"{\"\n              }), \"Object\", _jsx(_components.span, {\n                className: \"token punctuation\",\n                children: \"}\"\n              })]\n            }), \" \", _jsx(_components.span, {\n              className: \"token parameter\",\n              children: \"chatHistory\"\n            }), \" the global chat history object containing all the chats\\n * \", _jsx(_components.span, {\n              className: \"token keyword\",\n              children: \"@param\"\n            }), \" \", _jsxs(_components.span, {\n              className: \"token class-name\",\n              children: [_jsx(_components.span, {\n                className: \"token punctuation\",\n                children: \"{\"\n              }), \"String\", _jsx(_components.span, {\n                className: \"token punctuation\",\n                children: \"}\"\n              })]\n            }), \" \", _jsx(_components.span, {\n              className: \"token parameter\",\n              children: \"id\"\n            }), \" the ID of the chat to retrieve\\n * \", _jsx(_components.span, {\n              className: \"token keyword\",\n              children: \"@returns\"\n            }), \" \", _jsxs(_components.span, {\n              className: \"token class-name\",\n              children: [_jsx(_components.span, {\n                className: \"token punctuation\",\n                children: \"{\"\n              }), \"Object\", _jsx(_components.span, {\n                className: \"token punctuation\",\n                children: \"}\"\n              })]\n            }), \" the chat history for the given `id`\\n */\"]\n          }), \"\\n\", _jsx(_components.span, {\n            className: \"token keyword\",\n            children: \"function\"\n          }), \" \", _jsx(_components.span, {\n            className: \"token function\",\n            children: \"getChatMessages\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \"(\"\n          }), _jsxs(_components.span, {\n            className: \"token parameter\",\n            children: [\"chatHistory\", _jsx(_components.span, {\n              className: \"token punctuation\",\n              children: \",\"\n            }), \" id\"]\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \")\"\n          }), \" \", _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \"{\"\n          }), \"\\n    \", _jsx(_components.span, {\n            className: \"token keyword control-flow\",\n            children: \"if\"\n          }), \" \", _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \"(\"\n          }), _jsx(_components.span, {\n            className: \"token operator\",\n            children: \"!\"\n          }), \"chatHistory\", _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \"[\"\n          }), \"id\", _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \"]\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \")\"\n          }), \" \", _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \"{\"\n          }), \"\\n        chatHistory\", _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \"[\"\n          }), \"id\", _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \"]\"\n          }), \" \", _jsx(_components.span, {\n            className: \"token operator\",\n            children: \"=\"\n          }), \" \", _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \"[\"\n          }), \"\\n            \", _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \"{\"\n          }), \" \", _jsx(_components.span, {\n            className: \"token literal-property property\",\n            children: \"role\"\n          }), _jsx(_components.span, {\n            className: \"token operator\",\n            children: \":\"\n          }), \" \", _jsx(_components.span, {\n            className: \"token string\",\n            children: \"\\\"system\\\"\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \",\"\n          }), \" \", _jsx(_components.span, {\n            className: \"token literal-property property\",\n            children: \"content\"\n          }), _jsx(_components.span, {\n            className: \"token operator\",\n            children: \":\"\n          }), \" \", _jsx(_components.span, {\n            className: \"token maybe-class-name\",\n            children: \"Settings\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \".\"\n          }), _jsx(_components.span, {\n            className: \"token property-access\",\n            children: _jsx(_components.span, {\n              className: \"token maybe-class-name\",\n              children: \"AISystemContent\"\n            })\n          }), \" \", _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \"}\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \",\"\n          }), \"\\n            \", _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \"{\"\n          }), \" \", _jsx(_components.span, {\n            className: \"token literal-property property\",\n            children: \"role\"\n          }), _jsx(_components.span, {\n            className: \"token operator\",\n            children: \":\"\n          }), \" \", _jsx(_components.span, {\n            className: \"token string\",\n            children: \"\\\"assistant\\\"\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \",\"\n          }), \" \", _jsx(_components.span, {\n            className: \"token literal-property property\",\n            children: \"content\"\n          }), _jsx(_components.span, {\n            className: \"token operator\",\n            children: \":\"\n          }), \" \", _jsx(_components.span, {\n            className: \"token maybe-class-name\",\n            children: \"Settings\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \".\"\n          }), _jsx(_components.span, {\n            className: \"token property-access\",\n            children: _jsx(_components.span, {\n              className: \"token maybe-class-name\",\n              children: \"WelcomeMessage\"\n            })\n          }), \" \", _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \"}\"\n          }), \"\\n        \", _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \"]\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \";\"\n          }), \"\\n    \", _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \"}\"\n          }), \"\\n\\n    \", _jsx(_components.span, {\n            className: \"token keyword control-flow\",\n            children: \"return\"\n          }), \" chatHistory\", _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \"[\"\n          }), \"id\", _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \"]\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \";\"\n          }), \"\\n\", _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \"}\"\n          }), _jsxs(_components.span, {\n            \"aria-hidden\": \"true\",\n            className: \"line-numbers-rows\",\n            children: [_jsx(_components.span, {\n              className: \"\"\n            }), _jsx(_components.span, {\n              className: \"\"\n            }), _jsx(_components.span, {\n              className: \"\"\n            }), _jsx(_components.span, {\n              className: \"\"\n            }), _jsx(_components.span, {\n              className: \"\"\n            }), _jsx(_components.span, {\n              className: \"\"\n            }), _jsx(_components.span, {\n              className: \"\"\n            }), _jsx(_components.span, {\n              className: \"\"\n            }), _jsx(_components.span, {\n              className: \"\"\n            }), _jsx(_components.span, {\n              className: \"\"\n            }), _jsx(_components.span, {\n              className: \"\"\n            }), _jsx(_components.span, {\n              className: \"\"\n            }), _jsx(_components.span, {\n              className: \"\"\n            }), _jsx(_components.span, {\n              className: \"\"\n            }), _jsx(_components.span, {\n              className: \"\"\n            }), _jsx(_components.span, {\n              className: \"\"\n            }), _jsx(_components.span, {\n              className: \"\"\n            }), _jsx(_components.span, {\n              className: \"\"\n            })]\n          }), \"\\n\"]\n        })\n      })\n    }), \"\\n\", _jsxs(_components.p, {\n      children: [\"Then, if the received message is a text, not an audio, we add the message to the\\nchat history. If the received message is an audio, we call the function \", _jsx(_components.code, {\n        children: \"stt\"\n      }), \"\\nthat will perform the speech-to-text action using OpenAI's \", _jsx(_components.strong, {\n        children: \"Whisper\"\n      }), \".\"]\n    }), \"\\n\", _jsxs(_components.p, {\n      children: [\"The function will use the \", _jsx(_components.code, {\n        children: \"openai.audio.transcriptions.create\"\n      }), \" method. The main\\nparameter of this method is \", _jsx(_components.code, {\n        children: \"file\"\n      }), \", which must represent our audio data. We use\\nthe \", _jsx(_components.code, {\n        children: \"toFile\"\n      }), \" function from the package \", _jsx(_components.code, {\n        children: \"openai/uploads\"\n      }), \" to convert our base64\\nencoded audio file to a file that OpenAI can read. The function will return the\\ntranscription of the given audio.\"]\n    }), \"\\n\", _jsx(_components.div, {\n      className: \"remark-highlight\",\n      children: _jsx(_components.pre, {\n        className: \"language-js  line-numbers\",\n        children: _jsxs(_components.code, {\n          className: \"language-js\",\n          children: [_jsx(_components.span, {\n            className: \"token comment\",\n            children: \"/* version-1/server.js */\"\n          }), \"\\n\", _jsxs(_components.span, {\n            className: \"token doc-comment comment\",\n            children: [\"/**\\n * Convert speech to text using OpenAI.\\n * \", _jsx(_components.span, {\n              className: \"token keyword\",\n              children: \"@async\"\n            }), \"\\n * \\n * \", _jsx(_components.span, {\n              className: \"token keyword\",\n              children: \"@param\"\n            }), \" \", _jsxs(_components.span, {\n              className: \"token class-name\",\n              children: [_jsx(_components.span, {\n                className: \"token punctuation\",\n                children: \"{\"\n              }), \"OpenAI\", _jsx(_components.span, {\n                className: \"token punctuation\",\n                children: \"}\"\n              })]\n            }), \" \", _jsx(_components.span, {\n              className: \"token parameter\",\n              children: \"openai\"\n            }), \" the OpenAI instance\\n * \", _jsx(_components.span, {\n              className: \"token keyword\",\n              children: \"@param\"\n            }), \" \", _jsxs(_components.span, {\n              className: \"token class-name\",\n              children: [_jsx(_components.span, {\n                className: \"token punctuation\",\n                children: \"{\"\n              }), \"String\", _jsx(_components.span, {\n                className: \"token punctuation\",\n                children: \"}\"\n              })]\n            }), \" \", _jsx(_components.span, {\n              className: \"token parameter\",\n              children: \"audio\"\n            }), \" the base64 encoded audio\\n * \", _jsx(_components.span, {\n              className: \"token keyword\",\n              children: \"@returns\"\n            }), \" \", _jsxs(_components.span, {\n              className: \"token class-name\",\n              children: [_jsx(_components.span, {\n                className: \"token punctuation\",\n                children: \"{\"\n              }), \"Promise\", _jsx(_components.span, {\n                className: \"token punctuation\",\n                children: \"<\"\n              }), \"String\", _jsx(_components.span, {\n                className: \"token punctuation\",\n                children: \">\"\n              }), _jsx(_components.span, {\n                className: \"token punctuation\",\n                children: \"}\"\n              })]\n            }), \" the text\\n */\"]\n          }), \"\\n\", _jsx(_components.span, {\n            className: \"token keyword\",\n            children: \"async\"\n          }), \" \", _jsx(_components.span, {\n            className: \"token keyword\",\n            children: \"function\"\n          }), \" \", _jsx(_components.span, {\n            className: \"token function\",\n            children: \"stt\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \"(\"\n          }), _jsxs(_components.span, {\n            className: \"token parameter\",\n            children: [\"openai\", _jsx(_components.span, {\n              className: \"token punctuation\",\n              children: \",\"\n            }), \" audio\"]\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \")\"\n          }), \" \", _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \"{\"\n          }), \"\\n    \", _jsxs(_components.span, {\n            className: \"token comment\",\n            children: [\"// Documentation \", _jsx(_components.a, {\n              href: \"https://platform.openai.com/docs/api-reference/audio/createTranscription\",\n              className: \"token url-link\",\n              children: \"https://platform.openai.com/docs/api-reference/audio/createTranscription\"\n            })]\n          }), \"\\n    \", _jsx(_components.span, {\n            className: \"token keyword\",\n            children: \"const\"\n          }), \" transcription \", _jsx(_components.span, {\n            className: \"token operator\",\n            children: \"=\"\n          }), \" \", _jsx(_components.span, {\n            className: \"token keyword control-flow\",\n            children: \"await\"\n          }), \" openai\", _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \".\"\n          }), _jsx(_components.span, {\n            className: \"token property-access\",\n            children: \"audio\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \".\"\n          }), _jsx(_components.span, {\n            className: \"token property-access\",\n            children: \"transcriptions\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \".\"\n          }), _jsx(_components.span, {\n            className: \"token method function property-access\",\n            children: \"create\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \"(\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \"{\"\n          }), \"\\n        \", _jsx(_components.span, {\n            className: \"token literal-property property\",\n            children: \"file\"\n          }), _jsx(_components.span, {\n            className: \"token operator\",\n            children: \":\"\n          }), \" \", _jsx(_components.span, {\n            className: \"token keyword control-flow\",\n            children: \"await\"\n          }), \" \", _jsx(_components.span, {\n            className: \"token function\",\n            children: \"toFile\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \"(\"\n          }), _jsx(_components.span, {\n            className: \"token maybe-class-name\",\n            children: \"Buffer\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \".\"\n          }), _jsx(_components.span, {\n            className: \"token keyword module\",\n            children: \"from\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \"(\"\n          }), \"audio\", _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \",\"\n          }), \" \", _jsx(_components.span, {\n            className: \"token string\",\n            children: \"'base64'\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \")\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \",\"\n          }), \" \", _jsxs(_components.span, {\n            className: \"token template-string\",\n            children: [_jsx(_components.span, {\n              className: \"token template-punctuation string\",\n              children: \"`\"\n            }), _jsx(_components.span, {\n              className: \"token string\",\n              children: \"audio.\"\n            }), _jsxs(_components.span, {\n              className: \"token interpolation\",\n              children: [_jsx(_components.span, {\n                className: \"token interpolation-punctuation punctuation\",\n                children: \"${\"\n              }), _jsx(_components.span, {\n                className: \"token maybe-class-name\",\n                children: \"Settings\"\n              }), _jsx(_components.span, {\n                className: \"token punctuation\",\n                children: \".\"\n              }), _jsx(_components.span, {\n                className: \"token property-access\",\n                children: _jsx(_components.span, {\n                  className: \"token maybe-class-name\",\n                  children: \"ClientAudioExtension\"\n                })\n              }), _jsx(_components.span, {\n                className: \"token interpolation-punctuation punctuation\",\n                children: \"}\"\n              })]\n            }), _jsx(_components.span, {\n              className: \"token template-punctuation string\",\n              children: \"`\"\n            })]\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \")\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \",\"\n          }), \"\\n        \", _jsx(_components.span, {\n            className: \"token literal-property property\",\n            children: \"model\"\n          }), _jsx(_components.span, {\n            className: \"token operator\",\n            children: \":\"\n          }), \" \", _jsx(_components.span, {\n            className: \"token maybe-class-name\",\n            children: \"Settings\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \".\"\n          }), _jsx(_components.span, {\n            className: \"token property-access\",\n            children: _jsx(_components.span, {\n              className: \"token maybe-class-name\",\n              children: \"STTModel\"\n            })\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \",\"\n          }), \"\\n        \", _jsx(_components.span, {\n            className: \"token literal-property property\",\n            children: \"language\"\n          }), _jsx(_components.span, {\n            className: \"token operator\",\n            children: \":\"\n          }), \" \", _jsx(_components.span, {\n            className: \"token maybe-class-name\",\n            children: \"Settings\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \".\"\n          }), _jsx(_components.span, {\n            className: \"token property-access\",\n            children: _jsx(_components.span, {\n              className: \"token maybe-class-name\",\n              children: \"ClientAudioLanguage\"\n            })\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \",\"\n          }), \" \", _jsx(_components.span, {\n            className: \"token comment\",\n            children: \"// this is optional but helps the model\"\n          }), \"\\n    \", _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \"}\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \")\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \";\"\n          }), \"\\n\\n    \", _jsx(_components.span, {\n            className: \"token keyword control-flow\",\n            children: \"return\"\n          }), \" transcription\", _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \".\"\n          }), _jsx(_components.span, {\n            className: \"token property-access\",\n            children: \"text\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \";\"\n          }), \"\\n\", _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \"}\"\n          }), _jsxs(_components.span, {\n            \"aria-hidden\": \"true\",\n            className: \"line-numbers-rows\",\n            children: [_jsx(_components.span, {\n              className: \"\"\n            }), _jsx(_components.span, {\n              className: \"\"\n            }), _jsx(_components.span, {\n              className: \"\"\n            }), _jsx(_components.span, {\n              className: \"\"\n            }), _jsx(_components.span, {\n              className: \"\"\n            }), _jsx(_components.span, {\n              className: \"\"\n            }), _jsx(_components.span, {\n              className: \"\"\n            }), _jsx(_components.span, {\n              className: \"\"\n            }), _jsx(_components.span, {\n              className: \"\"\n            }), _jsx(_components.span, {\n              className: \"\"\n            }), _jsx(_components.span, {\n              className: \"\"\n            }), _jsx(_components.span, {\n              className: \"\"\n            }), _jsx(_components.span, {\n              className: \"\"\n            }), _jsx(_components.span, {\n              className: \"\"\n            }), _jsx(_components.span, {\n              className: \"\"\n            }), _jsx(_components.span, {\n              className: \"\"\n            }), _jsx(_components.span, {\n              className: \"\"\n            }), _jsx(_components.span, {\n              className: \"\"\n            }), _jsx(_components.span, {\n              className: \"\"\n            })]\n          }), \"\\n\"]\n        })\n      })\n    }), \"\\n\", _jsxs(_components.p, {\n      children: [\"Now that we have the message, we send the chat to ChatGPT and wait for a\\nresponse by calling the \", _jsx(_components.code, {\n        children: \"getAnswer\"\n      }), \" function.\"]\n    }), \"\\n\", _jsx(_components.div, {\n      className: \"remark-highlight\",\n      children: _jsx(_components.pre, {\n        className: \"language-js  line-numbers\",\n        children: _jsxs(_components.code, {\n          className: \"language-js\",\n          children: [_jsx(_components.span, {\n            className: \"token comment\",\n            children: \"/* version-1/server.js */\"\n          }), \"\\n\", _jsxs(_components.span, {\n            className: \"token doc-comment comment\",\n            children: [\"/**\\n * \\n * \", _jsx(_components.span, {\n              className: \"token keyword\",\n              children: \"@param\"\n            }), \" \", _jsxs(_components.span, {\n              className: \"token class-name\",\n              children: [_jsx(_components.span, {\n                className: \"token punctuation\",\n                children: \"{\"\n              }), _jsx(_components.span, {\n                className: \"token operator\",\n                children: \"*\"\n              }), _jsx(_components.span, {\n                className: \"token punctuation\",\n                children: \"}\"\n              })]\n            }), \" \", _jsx(_components.span, {\n              className: \"token parameter\",\n              children: \"openai\"\n            }), \" \\n * \", _jsx(_components.span, {\n              className: \"token keyword\",\n              children: \"@param\"\n            }), \" \", _jsxs(_components.span, {\n              className: \"token class-name\",\n              children: [_jsx(_components.span, {\n                className: \"token punctuation\",\n                children: \"{\"\n              }), _jsx(_components.span, {\n                className: \"token operator\",\n                children: \"*\"\n              }), _jsx(_components.span, {\n                className: \"token punctuation\",\n                children: \"}\"\n              })]\n            }), \" \", _jsx(_components.span, {\n              className: \"token parameter\",\n              children: \"messages\"\n            }), \" \\n * \", _jsx(_components.span, {\n              className: \"token keyword\",\n              children: \"@returns\"\n            }), \" \\n */\"]\n          }), \"\\n\", _jsx(_components.span, {\n            className: \"token keyword\",\n            children: \"async\"\n          }), \" \", _jsx(_components.span, {\n            className: \"token keyword\",\n            children: \"function\"\n          }), \" \", _jsx(_components.span, {\n            className: \"token function\",\n            children: \"getAnswer\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \"(\"\n          }), _jsxs(_components.span, {\n            className: \"token parameter\",\n            children: [\"openai\", _jsx(_components.span, {\n              className: \"token punctuation\",\n              children: \",\"\n            }), \" messages\"]\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \")\"\n          }), \" \", _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \"{\"\n          }), \"\\n    \", _jsxs(_components.span, {\n            className: \"token comment\",\n            children: [\"// Documentation \", _jsx(_components.a, {\n              href: \"https://platform.openai.com/docs/api-reference/chat/create\",\n              className: \"token url-link\",\n              children: \"https://platform.openai.com/docs/api-reference/chat/create\"\n            })]\n          }), \"\\n    \", _jsx(_components.span, {\n            className: \"token keyword\",\n            children: \"const\"\n          }), \" completion \", _jsx(_components.span, {\n            className: \"token operator\",\n            children: \"=\"\n          }), \" \", _jsx(_components.span, {\n            className: \"token keyword control-flow\",\n            children: \"await\"\n          }), \" openai\", _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \".\"\n          }), _jsx(_components.span, {\n            className: \"token property-access\",\n            children: \"chat\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \".\"\n          }), _jsx(_components.span, {\n            className: \"token property-access\",\n            children: \"completions\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \".\"\n          }), _jsx(_components.span, {\n            className: \"token method function property-access\",\n            children: \"create\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \"(\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \"{\"\n          }), \"\\n        messages\", _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \",\"\n          }), \"\\n        \", _jsx(_components.span, {\n            className: \"token literal-property property\",\n            children: \"model\"\n          }), _jsx(_components.span, {\n            className: \"token operator\",\n            children: \":\"\n          }), \" \", _jsx(_components.span, {\n            className: \"token maybe-class-name\",\n            children: \"Settings\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \".\"\n          }), _jsx(_components.span, {\n            className: \"token property-access\",\n            children: _jsx(_components.span, {\n              className: \"token maybe-class-name\",\n              children: \"ChatGPTModel\"\n            })\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \",\"\n          }), \"\\n    \", _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \"}\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \")\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \";\"\n          }), \"\\n\\n    \", _jsx(_components.span, {\n            className: \"token keyword control-flow\",\n            children: \"return\"\n          }), \" completion\", _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \".\"\n          }), _jsx(_components.span, {\n            className: \"token property-access\",\n            children: \"choices\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \"[\"\n          }), _jsx(_components.span, {\n            className: \"token number\",\n            children: \"0\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \"]\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \".\"\n          }), _jsx(_components.span, {\n            className: \"token property-access\",\n            children: \"message\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \".\"\n          }), _jsx(_components.span, {\n            className: \"token property-access\",\n            children: \"content\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \";\"\n          }), \"\\n\", _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \"}\"\n          }), _jsxs(_components.span, {\n            \"aria-hidden\": \"true\",\n            className: \"line-numbers-rows\",\n            children: [_jsx(_components.span, {\n              className: \"\"\n            }), _jsx(_components.span, {\n              className: \"\"\n            }), _jsx(_components.span, {\n              className: \"\"\n            }), _jsx(_components.span, {\n              className: \"\"\n            }), _jsx(_components.span, {\n              className: \"\"\n            }), _jsx(_components.span, {\n              className: \"\"\n            }), _jsx(_components.span, {\n              className: \"\"\n            }), _jsx(_components.span, {\n              className: \"\"\n            }), _jsx(_components.span, {\n              className: \"\"\n            }), _jsx(_components.span, {\n              className: \"\"\n            }), _jsx(_components.span, {\n              className: \"\"\n            }), _jsx(_components.span, {\n              className: \"\"\n            }), _jsx(_components.span, {\n              className: \"\"\n            }), _jsx(_components.span, {\n              className: \"\"\n            }), _jsx(_components.span, {\n              className: \"\"\n            }), _jsx(_components.span, {\n              className: \"\"\n            })]\n          }), \"\\n\"]\n        })\n      })\n    }), \"\\n\", _jsxs(_components.p, {\n      children: [\"Last part is about converting the response from the AI to an audio using the\\nfunction \", _jsx(_components.code, {\n        children: \"tts\"\n      }), \" that uses the method \", _jsx(_components.code, {\n        children: \"openai.audio.speech.create\"\n      }), \" to create\\nan audio file. The OpenAI's TTS support multiple formats but we've choosen \", _jsx(_components.code, {\n        children: \"mp3\"\n      }), \"\\nfor this tutorial.\"]\n    }), \"\\n\", _jsxs(_components.p, {\n      children: [\"Once the audio data is got we convert it into a \", _jsx(_components.code, {\n        children: \"Buffer\"\n      }), \" and from there to a\\nbase64 encoded audio string to send back to the client.\"]\n    }), \"\\n\", _jsx(_components.div, {\n      className: \"remark-highlight\",\n      children: _jsx(_components.pre, {\n        className: \"language-js  line-numbers\",\n        children: _jsxs(_components.code, {\n          className: \"language-js\",\n          children: [_jsx(_components.span, {\n            className: \"token comment\",\n            children: \"/* version-1/server.js */\"\n          }), \"\\n\", _jsxs(_components.span, {\n            className: \"token doc-comment comment\",\n            children: [\"/**\\n * Convert text to speech.\\n * \", _jsx(_components.span, {\n              className: \"token keyword\",\n              children: \"@async\"\n            }), \"\\n * \\n * \", _jsx(_components.span, {\n              className: \"token keyword\",\n              children: \"@param\"\n            }), \" \", _jsxs(_components.span, {\n              className: \"token class-name\",\n              children: [_jsx(_components.span, {\n                className: \"token punctuation\",\n                children: \"{\"\n              }), _jsx(_components.span, {\n                className: \"token operator\",\n                children: \"*\"\n              }), _jsx(_components.span, {\n                className: \"token punctuation\",\n                children: \"}\"\n              })]\n            }), \" \", _jsx(_components.span, {\n              className: \"token parameter\",\n              children: \"openai\"\n            }), \" \\n * \", _jsx(_components.span, {\n              className: \"token keyword\",\n              children: \"@param\"\n            }), \" \", _jsxs(_components.span, {\n              className: \"token class-name\",\n              children: [_jsx(_components.span, {\n                className: \"token punctuation\",\n                children: \"{\"\n              }), _jsx(_components.span, {\n                className: \"token operator\",\n                children: \"*\"\n              }), _jsx(_components.span, {\n                className: \"token punctuation\",\n                children: \"}\"\n              })]\n            }), \" \", _jsx(_components.span, {\n              className: \"token parameter\",\n              children: \"input\"\n            }), \" \\n * \", _jsx(_components.span, {\n              className: \"token keyword\",\n              children: \"@returns\"\n            }), \" \\n */\"]\n          }), \"\\n\", _jsx(_components.span, {\n            className: \"token keyword\",\n            children: \"async\"\n          }), \" \", _jsx(_components.span, {\n            className: \"token keyword\",\n            children: \"function\"\n          }), \" \", _jsx(_components.span, {\n            className: \"token function\",\n            children: \"tts\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \"(\"\n          }), _jsxs(_components.span, {\n            className: \"token parameter\",\n            children: [\"openai\", _jsx(_components.span, {\n              className: \"token punctuation\",\n              children: \",\"\n            }), \" input\"]\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \")\"\n          }), \" \", _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \"{\"\n          }), \"\\n    \", _jsxs(_components.span, {\n            className: \"token comment\",\n            children: [\"// Documentation \", _jsx(_components.a, {\n              href: \"https://platform.openai.com/docs/api-reference/audio/createSpeech\",\n              className: \"token url-link\",\n              children: \"https://platform.openai.com/docs/api-reference/audio/createSpeech\"\n            })]\n          }), \"\\n    \", _jsx(_components.span, {\n            className: \"token keyword\",\n            children: \"const\"\n          }), \" mp3 \", _jsx(_components.span, {\n            className: \"token operator\",\n            children: \"=\"\n          }), \" \", _jsx(_components.span, {\n            className: \"token keyword control-flow\",\n            children: \"await\"\n          }), \" openai\", _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \".\"\n          }), _jsx(_components.span, {\n            className: \"token property-access\",\n            children: \"audio\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \".\"\n          }), _jsx(_components.span, {\n            className: \"token property-access\",\n            children: \"speech\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \".\"\n          }), _jsx(_components.span, {\n            className: \"token method function property-access\",\n            children: \"create\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \"(\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \"{\"\n          }), \"\\n        \", _jsx(_components.span, {\n            className: \"token literal-property property\",\n            children: \"model\"\n          }), _jsx(_components.span, {\n            className: \"token operator\",\n            children: \":\"\n          }), \" \", _jsx(_components.span, {\n            className: \"token maybe-class-name\",\n            children: \"Settings\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \".\"\n          }), _jsx(_components.span, {\n            className: \"token property-access\",\n            children: _jsx(_components.span, {\n              className: \"token maybe-class-name\",\n              children: \"TTSModel\"\n            })\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \",\"\n          }), \"\\n        \", _jsx(_components.span, {\n            className: \"token literal-property property\",\n            children: \"voice\"\n          }), _jsx(_components.span, {\n            className: \"token operator\",\n            children: \":\"\n          }), \" \", _jsx(_components.span, {\n            className: \"token maybe-class-name\",\n            children: \"Settings\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \".\"\n          }), _jsx(_components.span, {\n            className: \"token property-access\",\n            children: _jsx(_components.span, {\n              className: \"token maybe-class-name\",\n              children: \"TTSVoice\"\n            })\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \",\"\n          }), \"\\n        input\", _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \",\"\n          }), \"\\n        \", _jsx(_components.span, {\n            className: \"token literal-property property\",\n            children: \"response_format\"\n          }), _jsx(_components.span, {\n            className: \"token operator\",\n            children: \":\"\n          }), \" \", _jsx(_components.span, {\n            className: \"token maybe-class-name\",\n            children: \"Settings\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \".\"\n          }), _jsx(_components.span, {\n            className: \"token property-access\",\n            children: _jsx(_components.span, {\n              className: \"token maybe-class-name\",\n              children: \"TTSFormat\"\n            })\n          }), \"\\n    \", _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \"}\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \")\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \";\"\n          }), \"\\n\\n    \", _jsx(_components.span, {\n            className: \"token keyword control-flow\",\n            children: \"return\"\n          }), \" \", _jsx(_components.span, {\n            className: \"token maybe-class-name\",\n            children: \"Buffer\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \".\"\n          }), _jsx(_components.span, {\n            className: \"token keyword module\",\n            children: \"from\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \"(\"\n          }), _jsx(_components.span, {\n            className: \"token keyword control-flow\",\n            children: \"await\"\n          }), \" mp3\", _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \".\"\n          }), _jsx(_components.span, {\n            className: \"token method function property-access\",\n            children: \"arrayBuffer\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \"(\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \")\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \")\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \".\"\n          }), _jsx(_components.span, {\n            className: \"token method function property-access\",\n            children: \"toString\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \"(\"\n          }), _jsx(_components.span, {\n            className: \"token string\",\n            children: \"'base64'\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \")\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \";\"\n          }), \"\\n\", _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \"}\"\n          }), _jsxs(_components.span, {\n            \"aria-hidden\": \"true\",\n            className: \"line-numbers-rows\",\n            children: [_jsx(_components.span, {\n              className: \"\"\n            }), _jsx(_components.span, {\n              className: \"\"\n            }), _jsx(_components.span, {\n              className: \"\"\n            }), _jsx(_components.span, {\n              className: \"\"\n            }), _jsx(_components.span, {\n              className: \"\"\n            }), _jsx(_components.span, {\n              className: \"\"\n            }), _jsx(_components.span, {\n              className: \"\"\n            }), _jsx(_components.span, {\n              className: \"\"\n            }), _jsx(_components.span, {\n              className: \"\"\n            }), _jsx(_components.span, {\n              className: \"\"\n            }), _jsx(_components.span, {\n              className: \"\"\n            }), _jsx(_components.span, {\n              className: \"\"\n            }), _jsx(_components.span, {\n              className: \"\"\n            }), _jsx(_components.span, {\n              className: \"\"\n            }), _jsx(_components.span, {\n              className: \"\"\n            }), _jsx(_components.span, {\n              className: \"\"\n            }), _jsx(_components.span, {\n              className: \"\"\n            }), _jsx(_components.span, {\n              className: \"\"\n            }), _jsx(_components.span, {\n              className: \"\"\n            }), _jsx(_components.span, {\n              className: \"\"\n            })]\n          }), \"\\n\"]\n        })\n      })\n    }), \"\\n\", _jsx(\"h2\", {\n      id: \"the-better-implementation\",\n      children: \"The better implementation\"\n    }), \"\\n\", _jsx(_components.p, {\n      children: \"But can we make it better? Well, yes. Instead of using HTTP requests, we can\\ninstead use WebSockets to communicate between the client and the server and\\ntell ChatGPT to return the results as a stream. In this way, we can create\\na real-time writting effect because we will stream the result from ChatGPT to\\nthe client in real time.\"\n    }), \"\\n\", _jsxs(_components.p, {\n      children: [\"This implementation has a drawback, but only because we are using OpenAI's TTS,\\nwhich accepts a maximum of 3 requests per minut. Therefore, for this\\nimplementation, we will drop the text-to-speech feature \", _jsx(_components.a, {\n        href: \"#tips-for-adding-the-tts-functionality-back\",\n        children: \"but I will give tips on\\nhow to reimplement it and what to look for when doing so\"\n      }), \".\"]\n    }), \"\\n\", _jsx(_components.p, {\n      children: \"So let's look at some code. We started from the previous implementation and\\nchanged what was needed to support WebSockets.\"\n    }), \"\\n\", _jsx(_components.div, {\n      className: \"remark-highlight\",\n      children: _jsx(_components.pre, {\n        className: \"language-js  line-numbers\",\n        children: _jsxs(_components.code, {\n          className: \"language-js\",\n          children: [_jsx(_components.span, {\n            className: \"token comment\",\n            children: \"/* version-2/client.js */\"\n          }), \"\\n\", _jsx(_components.span, {\n            className: \"token keyword\",\n            children: \"const\"\n          }), \" ws \", _jsx(_components.span, {\n            className: \"token operator\",\n            children: \"=\"\n          }), \" \", _jsx(_components.span, {\n            className: \"token keyword\",\n            children: \"new\"\n          }), \" \", _jsx(_components.span, {\n            className: \"token class-name\",\n            children: \"WebSocket\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \"(\"\n          }), _jsx(_components.span, {\n            className: \"token maybe-class-name\",\n            children: \"Settings\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \".\"\n          }), _jsx(_components.span, {\n            className: \"token property-access\",\n            children: _jsx(_components.span, {\n              className: \"token maybe-class-name\",\n              children: \"WSAddress\"\n            })\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \")\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \";\"\n          }), \"\\n\", _jsx(_components.span, {\n            className: \"token keyword\",\n            children: \"const\"\n          }), \" \", _jsx(_components.span, {\n            className: \"token maybe-class-name\",\n            children: \"ChatID\"\n          }), \" \", _jsx(_components.span, {\n            className: \"token operator\",\n            children: \"=\"\n          }), \" \", _jsx(_components.span, {\n            className: \"token function\",\n            children: \"makeID\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \"(\"\n          }), _jsx(_components.span, {\n            className: \"token number\",\n            children: \"10\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \")\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \";\"\n          }), \"\\n\\n\", _jsx(_components.span, {\n            className: \"token comment\",\n            children: \"// When the connection to the server is made send the chat ID\"\n          }), \"\\nws\", _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \".\"\n          }), _jsx(_components.span, {\n            className: \"token method function property-access\",\n            children: \"addEventListener\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \"(\"\n          }), _jsx(_components.span, {\n            className: \"token string\",\n            children: \"'open'\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \",\"\n          }), \" \", _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \"(\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \")\"\n          }), \" \", _jsx(_components.span, {\n            className: \"token arrow operator\",\n            children: \"=>\"\n          }), \" \", _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \"{\"\n          }), \"\\n    \", _jsx(_components.span, {\n            className: \"token keyword\",\n            children: \"const\"\n          }), \" idMessage \", _jsx(_components.span, {\n            className: \"token operator\",\n            children: \"=\"\n          }), \" \", _jsx(_components.span, {\n            className: \"token keyword\",\n            children: \"new\"\n          }), \" \", _jsx(_components.span, {\n            className: \"token class-name\",\n            children: \"Uint8Array\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \"(\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \"[\"\n          }), _jsx(_components.span, {\n            className: \"token maybe-class-name\",\n            children: \"ClientMessageID\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \".\"\n          }), _jsx(_components.span, {\n            className: \"token property-access\",\n            children: _jsx(_components.span, {\n              className: \"token maybe-class-name\",\n              children: \"SetClientID\"\n            })\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \",\"\n          }), \" \", _jsx(_components.span, {\n            className: \"token spread operator\",\n            children: \"...\"\n          }), _jsx(_components.span, {\n            className: \"token keyword\",\n            children: \"new\"\n          }), \" \", _jsx(_components.span, {\n            className: \"token class-name\",\n            children: \"TextEncoder\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \"(\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \")\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \".\"\n          }), _jsx(_components.span, {\n            className: \"token method function property-access\",\n            children: \"encode\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \"(\"\n          }), _jsx(_components.span, {\n            className: \"token maybe-class-name\",\n            children: \"ChatID\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \")\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \"]\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \")\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \";\"\n          }), \"\\n    ws\", _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \".\"\n          }), _jsx(_components.span, {\n            className: \"token method function property-access\",\n            children: \"send\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \"(\"\n          }), \"idMessage\", _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \")\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \";\"\n          }), \"\\n\", _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \"}\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \")\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \";\"\n          }), _jsxs(_components.span, {\n            \"aria-hidden\": \"true\",\n            className: \"line-numbers-rows\",\n            children: [_jsx(_components.span, {\n              className: \"\"\n            }), _jsx(_components.span, {\n              className: \"\"\n            }), _jsx(_components.span, {\n              className: \"\"\n            }), _jsx(_components.span, {\n              className: \"\"\n            }), _jsx(_components.span, {\n              className: \"\"\n            }), _jsx(_components.span, {\n              className: \"\"\n            }), _jsx(_components.span, {\n              className: \"\"\n            }), _jsx(_components.span, {\n              className: \"\"\n            }), _jsx(_components.span, {\n              className: \"\"\n            })]\n          }), \"\\n\"]\n        })\n      })\n    }), \"\\n\", _jsx(_components.p, {\n      children: \"In this section of the client code, we connect to the WebSocket server. When the\\nconnection is opened, we send the chat ID as the first message so the server\\nknows who we are.\"\n    }), \"\\n\", _jsx(_components.p, {\n      children: \"The structure of the data/messages sent between the client and the server\\nfollows this format:\"\n    }), \"\\n\", _jsx(\"center\", {\n      children: _jsx(\"img\", {\n        src: \"/imgs/posts/post013/websocket_message_structure.drawio.svg\",\n        style: {\n          width: '31rem'\n        }\n      })\n    }), \"\\n\", _jsx(_components.p, {\n      children: \"The first byte represents the type of the message we are sending, allowing the\\nserver to know how to handle the payload represented by the following bytes in\\nthe data sent.\"\n    }), \"\\n\", _jsxs(_components.blockquote, {\n      children: [\"\\n\", _jsxs(_components.p, {\n        children: [\"Note that we configured the WebSocket server to accept and send only\\nbinary data. This is why we will always send a \", _jsx(_components.code, {\n          children: \"Uint8Array\"\n        }), \" from the client\\nside and a \", _jsx(_components.code, {\n          children: \"Buffer\"\n        }), \" from the server side.\\nWe are sending only in binary because it is more efficient, converting to text\\nonly what we need and remaining to stay in binary (like the audio chunks, what\\nneed to remain in binary).\"]\n      }), \"\\n\"]\n    }), \"\\n\", _jsx(_components.p, {\n      children: \"In the following code, we handle the messages received from the server side:\"\n    }), \"\\n\", _jsx(_components.div, {\n      className: \"remark-highlight\",\n      children: _jsx(_components.pre, {\n        className: \"language-js  line-numbers\",\n        children: _jsxs(_components.code, {\n          className: \"language-js\",\n          children: [_jsx(_components.span, {\n            className: \"token comment\",\n            children: \"/* version-2/client.js */\"\n          }), \"\\n\", _jsx(_components.span, {\n            className: \"token keyword\",\n            children: \"const\"\n          }), \" subscriptionsToWSMessages \", _jsx(_components.span, {\n            className: \"token operator\",\n            children: \"=\"\n          }), \" \", _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \"[\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \"]\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \";\"\n          }), \"\\n\\nws\", _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \".\"\n          }), _jsx(_components.span, {\n            className: \"token method function property-access\",\n            children: \"addEventListener\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \"(\"\n          }), _jsx(_components.span, {\n            className: \"token string\",\n            children: \"'message'\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \",\"\n          }), \" \", _jsx(_components.span, {\n            className: \"token keyword\",\n            children: \"async\"\n          }), \" \", _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \"(\"\n          }), _jsx(_components.span, {\n            className: \"token parameter\",\n            children: \"event\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \")\"\n          }), \" \", _jsx(_components.span, {\n            className: \"token arrow operator\",\n            children: \"=>\"\n          }), \" \", _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \"{\"\n          }), \"\\n    \", _jsx(_components.span, {\n            className: \"token keyword\",\n            children: \"const\"\n          }), \" data \", _jsx(_components.span, {\n            className: \"token operator\",\n            children: \"=\"\n          }), \" \", _jsx(_components.span, {\n            className: \"token keyword\",\n            children: \"new\"\n          }), \" \", _jsx(_components.span, {\n            className: \"token class-name\",\n            children: \"Uint8Array\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \"(\"\n          }), _jsx(_components.span, {\n            className: \"token keyword control-flow\",\n            children: \"await\"\n          }), \" event\", _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \".\"\n          }), _jsx(_components.span, {\n            className: \"token property-access\",\n            children: \"data\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \".\"\n          }), _jsx(_components.span, {\n            className: \"token method function property-access\",\n            children: \"arrayBuffer\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \"(\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \")\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \")\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \";\"\n          }), \"\\n    \", _jsx(_components.span, {\n            className: \"token keyword\",\n            children: \"const\"\n          }), \" messageType \", _jsx(_components.span, {\n            className: \"token operator\",\n            children: \"=\"\n          }), \" data\", _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \"[\"\n          }), _jsx(_components.span, {\n            className: \"token number\",\n            children: \"0\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \"]\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \";\"\n          }), \"\\n\\n    \", _jsx(_components.span, {\n            className: \"token comment\",\n            children: \"// Because we know all the possible messages are all strings we can convert all the payloads to string\"\n          }), \"\\n    \", _jsx(_components.span, {\n            className: \"token keyword\",\n            children: \"const\"\n          }), \" content \", _jsx(_components.span, {\n            className: \"token operator\",\n            children: \"=\"\n          }), \" \", _jsx(_components.span, {\n            className: \"token keyword\",\n            children: \"new\"\n          }), \" \", _jsx(_components.span, {\n            className: \"token class-name\",\n            children: \"TextDecoder\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \"(\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \")\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \".\"\n          }), _jsx(_components.span, {\n            className: \"token method function property-access\",\n            children: \"decode\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \"(\"\n          }), \"data\", _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \".\"\n          }), _jsx(_components.span, {\n            className: \"token method function property-access\",\n            children: \"slice\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \"(\"\n          }), _jsx(_components.span, {\n            className: \"token number\",\n            children: \"1\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \")\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \")\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \";\"\n          }), \"\\n\\n    \", _jsx(_components.span, {\n            className: \"token keyword control-flow\",\n            children: \"if\"\n          }), \" \", _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \"(\"\n          }), _jsx(_components.span, {\n            className: \"token operator\",\n            children: \"!\"\n          }), \"ws\", _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \".\"\n          }), _jsx(_components.span, {\n            className: \"token property-access\",\n            children: \"allGood\"\n          }), \" \", _jsx(_components.span, {\n            className: \"token operator\",\n            children: \"&&\"\n          }), \" messageType \", _jsx(_components.span, {\n            className: \"token operator\",\n            children: \"!==\"\n          }), \" \", _jsx(_components.span, {\n            className: \"token maybe-class-name\",\n            children: \"ServerMessageID\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \".\"\n          }), _jsx(_components.span, {\n            className: \"token constant\",\n            children: \"OK\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \")\"\n          }), \" \", _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \"{\"\n          }), \"\\n        \", _jsx(_components.span, {\n            className: \"token keyword control-flow\",\n            children: \"if\"\n          }), \" \", _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \"(\"\n          }), \"messageType \", _jsx(_components.span, {\n            className: \"token operator\",\n            children: \"===\"\n          }), \" \", _jsx(_components.span, {\n            className: \"token maybe-class-name\",\n            children: \"ServerMessageID\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \".\"\n          }), _jsx(_components.span, {\n            className: \"token known-class-name class-name\",\n            children: \"Error\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \")\"\n          }), \" \", _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \"{\"\n          }), \"\\n            \", _jsx(_components.span, {\n            className: \"token console class-name\",\n            children: \"console\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \".\"\n          }), _jsx(_components.span, {\n            className: \"token method function property-access\",\n            children: \"error\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \"(\"\n          }), _jsx(_components.span, {\n            className: \"token string\",\n            children: \"'Something wrong sending the chat ID:'\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \",\"\n          }), \" content\", _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \")\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \";\"\n          }), \"\\n        \", _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \"}\"\n          }), \"\\n    \", _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \"}\"\n          }), \" \", _jsx(_components.span, {\n            className: \"token keyword control-flow\",\n            children: \"else\"\n          }), \" \", _jsx(_components.span, {\n            className: \"token keyword control-flow\",\n            children: \"if\"\n          }), \" \", _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \"(\"\n          }), \"messageType \", _jsx(_components.span, {\n            className: \"token operator\",\n            children: \"===\"\n          }), \" \", _jsx(_components.span, {\n            className: \"token maybe-class-name\",\n            children: \"ServerMessageID\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \".\"\n          }), _jsx(_components.span, {\n            className: \"token constant\",\n            children: \"OK\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \")\"\n          }), \" \", _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \"{\"\n          }), \"\\n        ws\", _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \".\"\n          }), _jsx(_components.span, {\n            className: \"token property-access\",\n            children: \"allGood\"\n          }), \" \", _jsx(_components.span, {\n            className: \"token operator\",\n            children: \"=\"\n          }), \" \", _jsx(_components.span, {\n            className: \"token boolean\",\n            children: \"true\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \";\"\n          }), \"\\n    \", _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \"}\"\n          }), \" \", _jsx(_components.span, {\n            className: \"token keyword control-flow\",\n            children: \"else\"\n          }), \" \", _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \"{\"\n          }), \"\\n        \", _jsx(_components.span, {\n            className: \"token keyword\",\n            children: \"let\"\n          }), \" done\", _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \";\"\n          }), \"\\n        \", _jsx(_components.span, {\n            className: \"token keyword control-flow\",\n            children: \"for\"\n          }), \" \", _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \"(\"\n          }), _jsx(_components.span, {\n            className: \"token keyword\",\n            children: \"let\"\n          }), \" i\", _jsx(_components.span, {\n            className: \"token operator\",\n            children: \"=\"\n          }), _jsx(_components.span, {\n            className: \"token number\",\n            children: \"0\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \",\"\n          }), \" length\", _jsx(_components.span, {\n            className: \"token operator\",\n            children: \"=\"\n          }), \"subscriptionsToWSMessages\", _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \".\"\n          }), _jsx(_components.span, {\n            className: \"token property-access\",\n            children: \"length\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \";\"\n          }), \" i \", _jsx(_components.span, {\n            className: \"token operator\",\n            children: \"<\"\n          }), \" length\", _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \";\"\n          }), \" i \", _jsx(_components.span, {\n            className: \"token operator\",\n            children: \"+=\"\n          }), \" \", _jsx(_components.span, {\n            className: \"token number\",\n            children: \"1\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \")\"\n          }), \" \", _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \"{\"\n          }), \"\\n            done \", _jsx(_components.span, {\n            className: \"token operator\",\n            children: \"=\"\n          }), \" \", _jsx(_components.span, {\n            className: \"token keyword control-flow\",\n            children: \"await\"\n          }), \" subscriptionsToWSMessages\", _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \"[\"\n          }), \"i\", _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \"]\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \"(\"\n          }), \"messageType\", _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \",\"\n          }), \" content\", _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \")\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \";\"\n          }), \"\\n            \", _jsx(_components.span, {\n            className: \"token keyword control-flow\",\n            children: \"if\"\n          }), \" \", _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \"(\"\n          }), \"done \", _jsx(_components.span, {\n            className: \"token operator\",\n            children: \"===\"\n          }), \" \", _jsx(_components.span, {\n            className: \"token boolean\",\n            children: \"true\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \")\"\n          }), \" \", _jsx(_components.span, {\n            className: \"token keyword control-flow\",\n            children: \"return\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \";\"\n          }), \"\\n        \", _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \"}\"\n          }), \"\\n\\n        \", _jsx(_components.span, {\n            className: \"token keyword control-flow\",\n            children: \"if\"\n          }), \" \", _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \"(\"\n          }), _jsx(_components.span, {\n            className: \"token operator\",\n            children: \"!\"\n          }), \"done\", _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \")\"\n          }), \" \", _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \"{\"\n          }), \"\\n            \", _jsx(_components.span, {\n            className: \"token keyword control-flow\",\n            children: \"if\"\n          }), \" \", _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \"(\"\n          }), \"messageType \", _jsx(_components.span, {\n            className: \"token operator\",\n            children: \"===\"\n          }), \" \", _jsx(_components.span, {\n            className: \"token maybe-class-name\",\n            children: \"ServerMessageID\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \".\"\n          }), _jsx(_components.span, {\n            className: \"token known-class-name class-name\",\n            children: \"Error\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \")\"\n          }), \" \", _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \"{\"\n          }), \"\\n                \", _jsx(_components.span, {\n            className: \"token console class-name\",\n            children: \"console\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \".\"\n          }), _jsx(_components.span, {\n            className: \"token method function property-access\",\n            children: \"error\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \"(\"\n          }), _jsx(_components.span, {\n            className: \"token string\",\n            children: \"'Unhandled error received from server:'\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \",\"\n          }), \" content\", _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \")\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \";\"\n          }), \"\\n            \", _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \"}\"\n          }), \" \", _jsx(_components.span, {\n            className: \"token keyword control-flow\",\n            children: \"else\"\n          }), \" \", _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \"{\"\n          }), \"\\n                \", _jsx(_components.span, {\n            className: \"token console class-name\",\n            children: \"console\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \".\"\n          }), _jsx(_components.span, {\n            className: \"token method function property-access\",\n            children: \"log\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \"(\"\n          }), _jsxs(_components.span, {\n            className: \"token template-string\",\n            children: [_jsx(_components.span, {\n              className: \"token template-punctuation string\",\n              children: \"`\"\n            }), _jsx(_components.span, {\n              className: \"token string\",\n              children: \"Unknown message type \\\"\"\n            }), _jsxs(_components.span, {\n              className: \"token interpolation\",\n              children: [_jsx(_components.span, {\n                className: \"token interpolation-punctuation punctuation\",\n                children: \"${\"\n              }), \"messageType\", _jsx(_components.span, {\n                className: \"token interpolation-punctuation punctuation\",\n                children: \"}\"\n              })]\n            }), _jsx(_components.span, {\n              className: \"token string\",\n              children: \"\\\" received.\"\n            }), _jsx(_components.span, {\n              className: \"token template-punctuation string\",\n              children: \"`\"\n            })]\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \")\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \";\"\n          }), \"\\n            \", _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \"}\"\n          }), \"\\n        \", _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \"}\"\n          }), \"\\n    \", _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \"}\"\n          }), \"\\n\", _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \"}\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \")\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \";\"\n          }), _jsxs(_components.span, {\n            \"aria-hidden\": \"true\",\n            className: \"line-numbers-rows\",\n            children: [_jsx(_components.span, {\n              className: \"\"\n            }), _jsx(_components.span, {\n              className: \"\"\n            }), _jsx(_components.span, {\n              className: \"\"\n            }), _jsx(_components.span, {\n              className: \"\"\n            }), _jsx(_components.span, {\n              className: \"\"\n            }), _jsx(_components.span, {\n              className: \"\"\n            }), _jsx(_components.span, {\n              className: \"\"\n            }), _jsx(_components.span, {\n              className: \"\"\n            }), _jsx(_components.span, {\n              className: \"\"\n            }), _jsx(_components.span, {\n              className: \"\"\n            }), _jsx(_components.span, {\n              className: \"\"\n            }), _jsx(_components.span, {\n              className: \"\"\n            }), _jsx(_components.span, {\n              className: \"\"\n            }), _jsx(_components.span, {\n              className: \"\"\n            }), _jsx(_components.span, {\n              className: \"\"\n            }), _jsx(_components.span, {\n              className: \"\"\n            }), _jsx(_components.span, {\n              className: \"\"\n            }), _jsx(_components.span, {\n              className: \"\"\n            }), _jsx(_components.span, {\n              className: \"\"\n            }), _jsx(_components.span, {\n              className: \"\"\n            }), _jsx(_components.span, {\n              className: \"\"\n            }), _jsx(_components.span, {\n              className: \"\"\n            }), _jsx(_components.span, {\n              className: \"\"\n            }), _jsx(_components.span, {\n              className: \"\"\n            }), _jsx(_components.span, {\n              className: \"\"\n            }), _jsx(_components.span, {\n              className: \"\"\n            }), _jsx(_components.span, {\n              className: \"\"\n            }), _jsx(_components.span, {\n              className: \"\"\n            }), _jsx(_components.span, {\n              className: \"\"\n            }), _jsx(_components.span, {\n              className: \"\"\n            }), _jsx(_components.span, {\n              className: \"\"\n            }), _jsx(_components.span, {\n              className: \"\"\n            })]\n          }), \"\\n\"]\n        })\n      })\n    }), \"\\n\", _jsxs(_components.p, {\n      children: [\"Since we know that all the messages we receive from the server side are texts,\\nwe can safely convert the entire payload to a \", _jsx(_components.code, {\n        children: \"String\"\n      }), \" using \", _jsx(_components.code, {\n        children: \"TextDecoder\"\n      }), \":\\n\", _jsx(_components.code, {\n        children: \"new TextDecoder().decode(data.slice(1));\"\n      }), \".\"]\n    }), \"\\n\", _jsxs(_components.p, {\n      children: [\"First we will wait for the first \", _jsx(_components.code, {\n        children: \"ServerMessageID.OK\"\n      }), \" from the server, which\\nrepresents that the sent chat ID is valid.\"]\n    }), \"\\n\", _jsxs(_components.p, {\n      children: [\"To be flexible, we use an array of functions that represent listeners to the\\nmessages received from the server. This allow us to be modular in our approach.\\nEach function must return \", _jsx(_components.code, {\n        children: \"true\"\n      }), \" or \", _jsx(_components.code, {\n        children: \"false\"\n      }), \": \", _jsx(_components.code, {\n        children: \"true\"\n      }), \" means that the message was\\nprocessed, and it is not necessary to call the rest of the subscribed functions.\"]\n    }), \"\\n\", _jsxs(_components.p, {\n      children: [\"To make it easy to add and remove subscribers, we extend our \", _jsx(_components.code, {\n        children: \"ws\"\n      }), \" object with\\nthe following:\"]\n    }), \"\\n\", _jsx(_components.div, {\n      className: \"remark-highlight\",\n      children: _jsx(_components.pre, {\n        className: \"language-js  line-numbers\",\n        children: _jsxs(_components.code, {\n          className: \"language-js\",\n          children: [_jsx(_components.span, {\n            className: \"token comment\",\n            children: \"/* version-2/client.js */\"\n          }), \"\\n\", _jsxs(_components.span, {\n            className: \"token doc-comment comment\",\n            children: [\"/**\\n * Add a function to the list of functions to be called when the socket receives\\n * a new message. The function must return a boolean: if `true` is returned then\\n * is considered that the message was handled and will stop the exection of the\\n * rest of the subscribers in the list.\\n * \\n * \", _jsx(_components.span, {\n              className: \"token keyword\",\n              children: \"@param\"\n            }), \" \", _jsxs(_components.span, {\n              className: \"token class-name\",\n              children: [_jsx(_components.span, {\n                className: \"token punctuation\",\n                children: \"{\"\n              }), \"Function\", _jsx(_components.span, {\n                className: \"token punctuation\",\n                children: \"}\"\n              })]\n            }), \" \", _jsx(_components.span, {\n              className: \"token parameter\",\n              children: \"fn\"\n            }), \" the function to be added\\n */\"]\n          }), \"\\nws\", _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \".\"\n          }), _jsx(_components.span, {\n            className: \"token method-variable function-variable method function property-access\",\n            children: \"subscribeToWSMessage\"\n          }), \" \", _jsx(_components.span, {\n            className: \"token operator\",\n            children: \"=\"\n          }), \" \", _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \"(\"\n          }), _jsx(_components.span, {\n            className: \"token parameter\",\n            children: \"fn\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \")\"\n          }), \" \", _jsx(_components.span, {\n            className: \"token arrow operator\",\n            children: \"=>\"\n          }), \" \", _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \"{\"\n          }), \"\\n    subscriptionsToWSMessages\", _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \".\"\n          }), _jsx(_components.span, {\n            className: \"token method function property-access\",\n            children: \"push\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \"(\"\n          }), \"fn\", _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \")\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \";\"\n          }), \"\\n\", _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \"}\"\n          }), \"\\n\\n\", _jsxs(_components.span, {\n            className: \"token doc-comment comment\",\n            children: [\"/**\\n * Remove an added function from the list of subscribers.\\n * \\n * \", _jsx(_components.span, {\n              className: \"token keyword\",\n              children: \"@param\"\n            }), \" \", _jsxs(_components.span, {\n              className: \"token class-name\",\n              children: [_jsx(_components.span, {\n                className: \"token punctuation\",\n                children: \"{\"\n              }), \"Function\", _jsx(_components.span, {\n                className: \"token punctuation\",\n                children: \"}\"\n              })]\n            }), \" \", _jsx(_components.span, {\n              className: \"token parameter\",\n              children: \"fn\"\n            }), \" the function to be removed\\n */\"]\n          }), \"\\nws\", _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \".\"\n          }), _jsx(_components.span, {\n            className: \"token method-variable function-variable method function property-access\",\n            children: \"unsubscribeToWSMessage\"\n          }), \" \", _jsx(_components.span, {\n            className: \"token operator\",\n            children: \"=\"\n          }), \" \", _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \"(\"\n          }), _jsx(_components.span, {\n            className: \"token parameter\",\n            children: \"fn\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \")\"\n          }), \" \", _jsx(_components.span, {\n            className: \"token arrow operator\",\n            children: \"=>\"\n          }), \" \", _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \"{\"\n          }), \"\\n    subscriptionsToWSMessages\", _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \".\"\n          }), _jsx(_components.span, {\n            className: \"token method function property-access\",\n            children: \"splice\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \"(\"\n          }), \"subscriptionsToWSMessages\", _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \".\"\n          }), _jsx(_components.span, {\n            className: \"token method function property-access\",\n            children: \"indexOf\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \"(\"\n          }), \"fn\", _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \")\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \",\"\n          }), \" \", _jsx(_components.span, {\n            className: \"token number\",\n            children: \"1\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \")\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \";\"\n          }), \"\\n\", _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \"}\"\n          }), _jsxs(_components.span, {\n            \"aria-hidden\": \"true\",\n            className: \"line-numbers-rows\",\n            children: [_jsx(_components.span, {\n              className: \"\"\n            }), _jsx(_components.span, {\n              className: \"\"\n            }), _jsx(_components.span, {\n              className: \"\"\n            }), _jsx(_components.span, {\n              className: \"\"\n            }), _jsx(_components.span, {\n              className: \"\"\n            }), _jsx(_components.span, {\n              className: \"\"\n            }), _jsx(_components.span, {\n              className: \"\"\n            }), _jsx(_components.span, {\n              className: \"\"\n            }), _jsx(_components.span, {\n              className: \"\"\n            }), _jsx(_components.span, {\n              className: \"\"\n            }), _jsx(_components.span, {\n              className: \"\"\n            }), _jsx(_components.span, {\n              className: \"\"\n            }), _jsx(_components.span, {\n              className: \"\"\n            }), _jsx(_components.span, {\n              className: \"\"\n            }), _jsx(_components.span, {\n              className: \"\"\n            }), _jsx(_components.span, {\n              className: \"\"\n            }), _jsx(_components.span, {\n              className: \"\"\n            }), _jsx(_components.span, {\n              className: \"\"\n            }), _jsx(_components.span, {\n              className: \"\"\n            }), _jsx(_components.span, {\n              className: \"\"\n            }), _jsx(_components.span, {\n              className: \"\"\n            })]\n          }), \"\\n\"]\n        })\n      })\n    }), \"\\n\", _jsxs(_components.p, {\n      children: [\"Next, we extend again the \", _jsx(_components.code, {\n        children: \"ws\"\n      }), \" object with 3 more methods:\"]\n    }), \"\\n\", _jsxs(_components.ul, {\n      children: [\"\\n\", _jsxs(_components.li, {\n        children: [_jsx(_components.code, {\n          children: \"sendTextMessage\"\n        }), \" for sending the user's text message;\"]\n      }), \"\\n\", _jsxs(_components.li, {\n        children: [_jsx(_components.code, {\n          children: \"sendAudioChunk\"\n        }), \" for sending an audio chunk from the user's voice recording;\"]\n      }), \"\\n\", _jsxs(_components.li, {\n        children: [_jsx(_components.code, {\n          children: \"sendAudioEnd\"\n        }), \" for telling the server that the audio is done.\"]\n      }), \"\\n\"]\n    }), \"\\n\", _jsx(_components.div, {\n      className: \"remark-highlight\",\n      children: _jsx(_components.pre, {\n        className: \"language-js  line-numbers\",\n        children: _jsxs(_components.code, {\n          className: \"language-js\",\n          children: [_jsx(_components.span, {\n            className: \"token comment\",\n            children: \"/* version-2/client.js */\"\n          }), \"\\n\", _jsxs(_components.span, {\n            className: \"token doc-comment comment\",\n            children: [\"/**\\n * Send a text message to the server.\\n * \", _jsx(_components.span, {\n              className: \"token keyword\",\n              children: \"@async\"\n            }), \"\\n * \\n * \", _jsx(_components.span, {\n              className: \"token keyword\",\n              children: \"@param\"\n            }), \" \", _jsxs(_components.span, {\n              className: \"token class-name\",\n              children: [_jsx(_components.span, {\n                className: \"token punctuation\",\n                children: \"{\"\n              }), \"String\", _jsx(_components.span, {\n                className: \"token punctuation\",\n                children: \"}\"\n              })]\n            }), \" \", _jsx(_components.span, {\n              className: \"token parameter\",\n              children: \"message\"\n            }), \" the message to send\\n * \", _jsx(_components.span, {\n              className: \"token keyword\",\n              children: \"@param\"\n            }), \" \", _jsxs(_components.span, {\n              className: \"token class-name\",\n              children: [_jsx(_components.span, {\n                className: \"token punctuation\",\n                children: \"{\"\n              }), \"Function\", _jsx(_components.span, {\n                className: \"token punctuation\",\n                children: \"}\"\n              })]\n            }), \" \", _jsx(_components.span, {\n              className: \"token parameter\",\n              children: \"onNewMessageContent\"\n            }), \" the function to be called with the new answer from bot as it sent from the server\\n */\"]\n          }), \"\\nws\", _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \".\"\n          }), _jsx(_components.span, {\n            className: \"token method-variable function-variable method function property-access\",\n            children: \"sendTextMessage\"\n          }), \" \", _jsx(_components.span, {\n            className: \"token operator\",\n            children: \"=\"\n          }), \" \", _jsx(_components.span, {\n            className: \"token keyword\",\n            children: \"async\"\n          }), \" \", _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \"(\"\n          }), _jsxs(_components.span, {\n            className: \"token parameter\",\n            children: [\"message\", _jsx(_components.span, {\n              className: \"token punctuation\",\n              children: \",\"\n            }), \" onNewMessageContent\"]\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \")\"\n          }), \" \", _jsx(_components.span, {\n            className: \"token arrow operator\",\n            children: \"=>\"\n          }), \" \", _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \"{\"\n          }), \"\\n    ws\", _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \".\"\n          }), _jsx(_components.span, {\n            className: \"token method function property-access\",\n            children: \"createSubscriptionForBotResponse\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \"(\"\n          }), \"onNewMessageContent\", _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \")\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \";\"\n          }), \"\\n\\n    \", _jsx(_components.span, {\n            className: \"token keyword\",\n            children: \"const\"\n          }), \" wsMessage \", _jsx(_components.span, {\n            className: \"token operator\",\n            children: \"=\"\n          }), \" \", _jsx(_components.span, {\n            className: \"token keyword\",\n            children: \"new\"\n          }), \" \", _jsx(_components.span, {\n            className: \"token class-name\",\n            children: \"Uint8Array\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \"(\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \"[\"\n          }), _jsx(_components.span, {\n            className: \"token maybe-class-name\",\n            children: \"ClientMessageID\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \".\"\n          }), _jsx(_components.span, {\n            className: \"token property-access\",\n            children: _jsx(_components.span, {\n              className: \"token maybe-class-name\",\n              children: \"UserTextMessage\"\n            })\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \",\"\n          }), \" \", _jsx(_components.span, {\n            className: \"token spread operator\",\n            children: \"...\"\n          }), _jsx(_components.span, {\n            className: \"token keyword\",\n            children: \"new\"\n          }), \" \", _jsx(_components.span, {\n            className: \"token class-name\",\n            children: \"TextEncoder\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \"(\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \")\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \".\"\n          }), _jsx(_components.span, {\n            className: \"token method function property-access\",\n            children: \"encode\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \"(\"\n          }), \"message\", _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \")\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \"]\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \")\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \";\"\n          }), \"\\n    ws\", _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \".\"\n          }), _jsx(_components.span, {\n            className: \"token method function property-access\",\n            children: \"send\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \"(\"\n          }), \"wsMessage\", _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \")\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \";\"\n          }), \"\\n\", _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \"}\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \";\"\n          }), _jsxs(_components.span, {\n            \"aria-hidden\": \"true\",\n            className: \"line-numbers-rows\",\n            children: [_jsx(_components.span, {\n              className: \"\"\n            }), _jsx(_components.span, {\n              className: \"\"\n            }), _jsx(_components.span, {\n              className: \"\"\n            }), _jsx(_components.span, {\n              className: \"\"\n            }), _jsx(_components.span, {\n              className: \"\"\n            }), _jsx(_components.span, {\n              className: \"\"\n            }), _jsx(_components.span, {\n              className: \"\"\n            }), _jsx(_components.span, {\n              className: \"\"\n            }), _jsx(_components.span, {\n              className: \"\"\n            }), _jsx(_components.span, {\n              className: \"\"\n            }), _jsx(_components.span, {\n              className: \"\"\n            }), _jsx(_components.span, {\n              className: \"\"\n            }), _jsx(_components.span, {\n              className: \"\"\n            }), _jsx(_components.span, {\n              className: \"\"\n            })]\n          }), \"\\n\"]\n        })\n      })\n    }), \"\\n\", _jsxs(_components.p, {\n      children: [\"The \", _jsx(_components.code, {\n        children: \"sendTextMessage\"\n      }), \" method accepts the message that needs to sent to the\\nserver and a function that will be called multiple times with the stream of data\\nreceived from ChatGPT.\"]\n    }), \"\\n\", _jsxs(_components.p, {\n      children: [\"In this method, before sending the message to the server, we call the\\n\", _jsx(_components.code, {\n        children: \"createSubscriptionForBotResponse\"\n      }), \" method, which handles creating and adding a\\nsubscription to listen for new messages to handle the response from the bot.\"]\n    }), \"\\n\", _jsx(_components.div, {\n      className: \"remark-highlight\",\n      children: _jsx(_components.pre, {\n        className: \"language-js  line-numbers\",\n        children: _jsxs(_components.code, {\n          className: \"language-js\",\n          children: [_jsx(_components.span, {\n            className: \"token comment\",\n            children: \"/* version-2/client.js */\"\n          }), \"\\n\", _jsxs(_components.span, {\n            className: \"token doc-comment comment\",\n            children: [\"/**\\n * Create and add a subscription to listen for the response of the bot to our sent message\\n * \\n * \", _jsx(_components.span, {\n              className: \"token keyword\",\n              children: \"@param\"\n            }), \" \", _jsxs(_components.span, {\n              className: \"token class-name\",\n              children: [_jsx(_components.span, {\n                className: \"token punctuation\",\n                children: \"{\"\n              }), \"Function\", _jsx(_components.span, {\n                className: \"token punctuation\",\n                children: \"}\"\n              })]\n            }), \" \", _jsx(_components.span, {\n              className: \"token parameter\",\n              children: \"onNewMessageContent\"\n            }), \" the function to be called with the new answer from bot as it sent from the server\\n */\"]\n          }), \"\\nws\", _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \".\"\n          }), _jsx(_components.span, {\n            className: \"token method-variable function-variable method function property-access\",\n            children: \"createSubscriptionForBotResponse\"\n          }), \" \", _jsx(_components.span, {\n            className: \"token operator\",\n            children: \"=\"\n          }), \" \", _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \"(\"\n          }), _jsx(_components.span, {\n            className: \"token parameter\",\n            children: \"onNewMessageContent\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \")\"\n          }), \" \", _jsx(_components.span, {\n            className: \"token arrow operator\",\n            children: \"=>\"\n          }), \" \", _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \"{\"\n          }), \"\\n    \", _jsx(_components.span, {\n            className: \"token keyword\",\n            children: \"const\"\n          }), \" \", _jsx(_components.span, {\n            className: \"token function-variable function\",\n            children: \"wsMessagesHandler\"\n          }), \" \", _jsx(_components.span, {\n            className: \"token operator\",\n            children: \"=\"\n          }), \" \", _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \"(\"\n          }), _jsxs(_components.span, {\n            className: \"token parameter\",\n            children: [\"messageType\", _jsx(_components.span, {\n              className: \"token punctuation\",\n              children: \",\"\n            }), \" content\"]\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \")\"\n          }), \" \", _jsx(_components.span, {\n            className: \"token arrow operator\",\n            children: \"=>\"\n          }), \" \", _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \"{\"\n          }), \"\\n        \", _jsx(_components.span, {\n            className: \"token keyword control-flow\",\n            children: \"if\"\n          }), \" \", _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \"(\"\n          }), \"messageType \", _jsx(_components.span, {\n            className: \"token operator\",\n            children: \"===\"\n          }), \" \", _jsx(_components.span, {\n            className: \"token maybe-class-name\",\n            children: \"ServerMessageID\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \".\"\n          }), _jsx(_components.span, {\n            className: \"token property-access\",\n            children: _jsx(_components.span, {\n              className: \"token maybe-class-name\",\n              children: \"TextChunk\"\n            })\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \")\"\n          }), \" \", _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \"{\"\n          }), \"\\n            \", _jsx(_components.span, {\n            className: \"token function\",\n            children: \"onNewMessageContent\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \"(\"\n          }), \"content\", _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \")\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \";\"\n          }), \"\\n            \", _jsx(_components.span, {\n            className: \"token keyword control-flow\",\n            children: \"return\"\n          }), \" \", _jsx(_components.span, {\n            className: \"token boolean\",\n            children: \"true\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \";\"\n          }), \"\\n        \", _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \"}\"\n          }), \" \", _jsx(_components.span, {\n            className: \"token keyword control-flow\",\n            children: \"else\"\n          }), \" \", _jsx(_components.span, {\n            className: \"token keyword control-flow\",\n            children: \"if\"\n          }), \" \", _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \"(\"\n          }), \"messageType \", _jsx(_components.span, {\n            className: \"token operator\",\n            children: \"===\"\n          }), \" \", _jsx(_components.span, {\n            className: \"token maybe-class-name\",\n            children: \"ServerMessageID\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \".\"\n          }), _jsx(_components.span, {\n            className: \"token property-access\",\n            children: _jsx(_components.span, {\n              className: \"token maybe-class-name\",\n              children: \"TextEnd\"\n            })\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \")\"\n          }), \" \", _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \"{\"\n          }), \"\\n            ws\", _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \".\"\n          }), _jsx(_components.span, {\n            className: \"token method function property-access\",\n            children: \"unsubscribeToWSMessage\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \"(\"\n          }), \"wsMessagesHandler\", _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \")\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \";\"\n          }), \"\\n            \", _jsx(_components.span, {\n            className: \"token keyword control-flow\",\n            children: \"return\"\n          }), \" \", _jsx(_components.span, {\n            className: \"token boolean\",\n            children: \"true\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \";\"\n          }), \"\\n        \", _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \"}\"\n          }), \"\\n\\n        \", _jsx(_components.span, {\n            className: \"token keyword control-flow\",\n            children: \"return\"\n          }), \" \", _jsx(_components.span, {\n            className: \"token boolean\",\n            children: \"false\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \";\"\n          }), \"\\n    \", _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \"}\"\n          }), \"\\n\\n    ws\", _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \".\"\n          }), _jsx(_components.span, {\n            className: \"token method function property-access\",\n            children: \"subscribeToWSMessage\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \"(\"\n          }), \"wsMessagesHandler\", _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \")\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \";\"\n          }), \"\\n\", _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \"}\"\n          }), _jsxs(_components.span, {\n            \"aria-hidden\": \"true\",\n            className: \"line-numbers-rows\",\n            children: [_jsx(_components.span, {\n              className: \"\"\n            }), _jsx(_components.span, {\n              className: \"\"\n            }), _jsx(_components.span, {\n              className: \"\"\n            }), _jsx(_components.span, {\n              className: \"\"\n            }), _jsx(_components.span, {\n              className: \"\"\n            }), _jsx(_components.span, {\n              className: \"\"\n            }), _jsx(_components.span, {\n              className: \"\"\n            }), _jsx(_components.span, {\n              className: \"\"\n            }), _jsx(_components.span, {\n              className: \"\"\n            }), _jsx(_components.span, {\n              className: \"\"\n            }), _jsx(_components.span, {\n              className: \"\"\n            }), _jsx(_components.span, {\n              className: \"\"\n            }), _jsx(_components.span, {\n              className: \"\"\n            }), _jsx(_components.span, {\n              className: \"\"\n            }), _jsx(_components.span, {\n              className: \"\"\n            }), _jsx(_components.span, {\n              className: \"\"\n            }), _jsx(_components.span, {\n              className: \"\"\n            }), _jsx(_components.span, {\n              className: \"\"\n            }), _jsx(_components.span, {\n              className: \"\"\n            }), _jsx(_components.span, {\n              className: \"\"\n            }), _jsx(_components.span, {\n              className: \"\"\n            })]\n          }), \"\\n\"]\n        })\n      })\n    }), \"\\n\", _jsxs(_components.p, {\n      children: [\"The subscribed function will check if the received message from the server has\\nthe required message type for the bot's response (\", _jsx(_components.code, {\n        children: \"ServerMessageID.TextChunk\"\n      }), \").\\nIf it does, we call the received function with the text chunk, which will add\\nthe chunk to the current bot response in the chat.\"]\n    }), \"\\n\", _jsxs(_components.p, {\n      children: [\"When the bot is done with the response, the server will send us a message with\\ntype \", _jsx(_components.code, {\n        children: \"ServerMessageID.TextEnd\"\n      }), \", indicating that we can stop listening, at which\\npoint we will unsubscribe from listening to new messages.\"]\n    }), \"\\n\", _jsx(_components.div, {\n      className: \"remark-highlight\",\n      children: _jsx(_components.pre, {\n        className: \"language-js  line-numbers\",\n        children: _jsxs(_components.code, {\n          className: \"language-js\",\n          children: [_jsx(_components.span, {\n            className: \"token comment\",\n            children: \"/* version-2/client.js */\"\n          }), \"\\n\", _jsxs(_components.span, {\n            className: \"token doc-comment comment\",\n            children: [\"/**\\n * Send an audio chunk to the server.\\n * \", _jsx(_components.span, {\n              className: \"token keyword\",\n              children: \"@async\"\n            }), \"\\n * \\n * \", _jsx(_components.span, {\n              className: \"token keyword\",\n              children: \"@param\"\n            }), \" \", _jsxs(_components.span, {\n              className: \"token class-name\",\n              children: [_jsx(_components.span, {\n                className: \"token punctuation\",\n                children: \"{\"\n              }), \"Blob\", _jsx(_components.span, {\n                className: \"token punctuation\",\n                children: \"}\"\n              })]\n            }), \" \", _jsx(_components.span, {\n              className: \"token parameter\",\n              children: \"blobChunk\"\n            }), \" the audio blob chunk\\n */\"]\n          }), \"\\nws\", _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \".\"\n          }), _jsx(_components.span, {\n            className: \"token method-variable function-variable method function property-access\",\n            children: \"sendAudioChunk\"\n          }), \" \", _jsx(_components.span, {\n            className: \"token operator\",\n            children: \"=\"\n          }), \" \", _jsx(_components.span, {\n            className: \"token keyword\",\n            children: \"async\"\n          }), \" \", _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \"(\"\n          }), _jsx(_components.span, {\n            className: \"token parameter\",\n            children: \"blobChunk\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \")\"\n          }), \" \", _jsx(_components.span, {\n            className: \"token arrow operator\",\n            children: \"=>\"\n          }), \" \", _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \"{\"\n          }), \"\\n    \", _jsx(_components.span, {\n            className: \"token keyword\",\n            children: \"const\"\n          }), \" wsMessage \", _jsx(_components.span, {\n            className: \"token operator\",\n            children: \"=\"\n          }), \" \", _jsx(_components.span, {\n            className: \"token keyword\",\n            children: \"new\"\n          }), \" \", _jsx(_components.span, {\n            className: \"token class-name\",\n            children: \"Uint8Array\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \"(\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \"[\"\n          }), _jsx(_components.span, {\n            className: \"token maybe-class-name\",\n            children: \"ClientMessageID\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \".\"\n          }), _jsx(_components.span, {\n            className: \"token property-access\",\n            children: _jsx(_components.span, {\n              className: \"token maybe-class-name\",\n              children: \"UserAudioChunk\"\n            })\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \",\"\n          }), \" \", _jsx(_components.span, {\n            className: \"token spread operator\",\n            children: \"...\"\n          }), _jsx(_components.span, {\n            className: \"token keyword\",\n            children: \"new\"\n          }), \" \", _jsx(_components.span, {\n            className: \"token class-name\",\n            children: \"Uint8Array\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \"(\"\n          }), _jsx(_components.span, {\n            className: \"token keyword control-flow\",\n            children: \"await\"\n          }), \" blobChunk\", _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \".\"\n          }), _jsx(_components.span, {\n            className: \"token method function property-access\",\n            children: \"arrayBuffer\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \"(\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \")\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \")\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \"]\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \")\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \";\"\n          }), \"\\n    ws\", _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \".\"\n          }), _jsx(_components.span, {\n            className: \"token method function property-access\",\n            children: \"send\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \"(\"\n          }), \"wsMessage\", _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \")\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \";\"\n          }), \"\\n\", _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \"}\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \";\"\n          }), \"\\n\\n\", _jsxs(_components.span, {\n            className: \"token doc-comment comment\",\n            children: [\"/**\\n * Tell the server that the audio is done.\\n * \\n * \", _jsx(_components.span, {\n              className: \"token keyword\",\n              children: \"@param\"\n            }), \" \", _jsxs(_components.span, {\n              className: \"token class-name\",\n              children: [_jsx(_components.span, {\n                className: \"token punctuation\",\n                children: \"{\"\n              }), \"Function\", _jsx(_components.span, {\n                className: \"token punctuation\",\n                children: \"}\"\n              })]\n            }), \" \", _jsx(_components.span, {\n              className: \"token parameter\",\n              children: \"onNewMessageContent\"\n            }), \" the function to be called with the new answer from bot as it sent from the server\\n */\"]\n          }), \"\\nws\", _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \".\"\n          }), _jsx(_components.span, {\n            className: \"token method-variable function-variable method function property-access\",\n            children: \"sendAudioEnd\"\n          }), \" \", _jsx(_components.span, {\n            className: \"token operator\",\n            children: \"=\"\n          }), \" \", _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \"(\"\n          }), _jsx(_components.span, {\n            className: \"token parameter\",\n            children: \"onNewMessageContent\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \")\"\n          }), \" \", _jsx(_components.span, {\n            className: \"token arrow operator\",\n            children: \"=>\"\n          }), \" \", _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \"{\"\n          }), \"\\n    ws\", _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \".\"\n          }), _jsx(_components.span, {\n            className: \"token method function property-access\",\n            children: \"createSubscriptionForBotResponse\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \"(\"\n          }), \"onNewMessageContent\", _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \")\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \";\"\n          }), \"\\n\\n    ws\", _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \".\"\n          }), _jsx(_components.span, {\n            className: \"token method function property-access\",\n            children: \"send\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \"(\"\n          }), _jsx(_components.span, {\n            className: \"token keyword\",\n            children: \"new\"\n          }), \" \", _jsx(_components.span, {\n            className: \"token class-name\",\n            children: \"Uint8Array\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \"(\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \"[\"\n          }), _jsx(_components.span, {\n            className: \"token maybe-class-name\",\n            children: \"ClientMessageID\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \".\"\n          }), _jsx(_components.span, {\n            className: \"token property-access\",\n            children: _jsx(_components.span, {\n              className: \"token maybe-class-name\",\n              children: \"UserAudioEnd\"\n            })\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \"]\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \")\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \")\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \";\"\n          }), \"\\n\", _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \"}\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \";\"\n          }), _jsxs(_components.span, {\n            \"aria-hidden\": \"true\",\n            className: \"line-numbers-rows\",\n            children: [_jsx(_components.span, {\n              className: \"\"\n            }), _jsx(_components.span, {\n              className: \"\"\n            }), _jsx(_components.span, {\n              className: \"\"\n            }), _jsx(_components.span, {\n              className: \"\"\n            }), _jsx(_components.span, {\n              className: \"\"\n            }), _jsx(_components.span, {\n              className: \"\"\n            }), _jsx(_components.span, {\n              className: \"\"\n            }), _jsx(_components.span, {\n              className: \"\"\n            }), _jsx(_components.span, {\n              className: \"\"\n            }), _jsx(_components.span, {\n              className: \"\"\n            }), _jsx(_components.span, {\n              className: \"\"\n            }), _jsx(_components.span, {\n              className: \"\"\n            }), _jsx(_components.span, {\n              className: \"\"\n            }), _jsx(_components.span, {\n              className: \"\"\n            }), _jsx(_components.span, {\n              className: \"\"\n            }), _jsx(_components.span, {\n              className: \"\"\n            }), _jsx(_components.span, {\n              className: \"\"\n            }), _jsx(_components.span, {\n              className: \"\"\n            }), _jsx(_components.span, {\n              className: \"\"\n            }), _jsx(_components.span, {\n              className: \"\"\n            }), _jsx(_components.span, {\n              className: \"\"\n            }), _jsx(_components.span, {\n              className: \"\"\n            })]\n          }), \"\\n\"]\n        })\n      })\n    }), \"\\n\", _jsxs(_components.p, {\n      children: [\"The next 2 methods, \", _jsx(_components.code, {\n        children: \"sendAudioChunk\"\n      }), \" and \", _jsx(_components.code, {\n        children: \"sendAudioEnd\"\n      }), \", are for sending the\\nrecorded voice of the user to the server. The first one, \", _jsx(_components.code, {\n        children: \"sendAudioChunk\"\n      }), \", will\\nsend the received bytes to the server, while the other one, \", _jsx(_components.code, {\n        children: \"sendAudioEnd\"\n      }), \", will\\nsend a message to the server indicating that the audio is done and, like the\\n\", _jsx(_components.code, {\n        children: \"sendTextMessage\"\n      }), \" method, will call \", _jsx(_components.code, {\n        children: \"createSubscriptionForBotResponse\"\n      }), \" to listen\\nfor the response from the bot.\"]\n    }), \"\\n\", _jsxs(_components.p, {\n      children: [\"Next we will look at how the \", _jsx(_components.code, {\n        children: \"onNewMessageContent\"\n      }), \" parameter from the\\n\", _jsx(_components.code, {\n        children: \"sendTextMessage\"\n      }), \" and \", _jsx(_components.code, {\n        children: \"sendAudioEnd\"\n      }), \" methods is sent.\"]\n    }), \"\\n\", _jsxs(_components.p, {\n      children: [\"We slightly modified the \", _jsx(_components.code, {\n        children: \"addMessage\"\n      }), \" function by splitting it into\\n\", _jsx(_components.code, {\n        children: \"addUserMessage\"\n      }), \" and \", _jsx(_components.code, {\n        children: \"addBotMessage\"\n      }), \". We will just look at \", _jsx(_components.code, {\n        children: \"addUserMessage\"\n      }), \":\"]\n    }), \"\\n\", _jsx(_components.div, {\n      className: \"remark-highlight\",\n      children: _jsx(_components.pre, {\n        className: \"language-js  line-numbers\",\n        children: _jsxs(_components.code, {\n          className: \"language-js\",\n          children: [_jsx(_components.span, {\n            className: \"token comment\",\n            children: \"/* version-2/client.js */\"\n          }), \"\\n\", _jsxs(_components.span, {\n            className: \"token doc-comment comment\",\n            children: [\"/**\\n * Add a new message to the chat.\\n * \", _jsx(_components.span, {\n              className: \"token keyword\",\n              children: \"@async\"\n            }), \"\\n * \\n * \", _jsx(_components.span, {\n              className: \"token keyword\",\n              children: \"@param\"\n            }), \" \", _jsxs(_components.span, {\n              className: \"token class-name\",\n              children: [_jsx(_components.span, {\n                className: \"token punctuation\",\n                children: \"{\"\n              }), \"WebSocket\", _jsx(_components.span, {\n                className: \"token punctuation\",\n                children: \"}\"\n              })]\n            }), \" \", _jsx(_components.span, {\n              className: \"token parameter\",\n              children: \"ws\"\n            }), \" the WebSocket\\n * \", _jsx(_components.span, {\n              className: \"token keyword\",\n              children: \"@param\"\n            }), \" \", _jsxs(_components.span, {\n              className: \"token class-name\",\n              children: [_jsx(_components.span, {\n                className: \"token punctuation\",\n                children: \"{\"\n              }), \"MessageType\", _jsx(_components.span, {\n                className: \"token punctuation\",\n                children: \"}\"\n              })]\n            }), \" \", _jsx(_components.span, {\n              className: \"token parameter\",\n              children: \"type\"\n            }), \" the type of message\\n * \", _jsx(_components.span, {\n              className: \"token keyword\",\n              children: \"@param\"\n            }), \" \", _jsxs(_components.span, {\n              className: \"token class-name\",\n              children: [_jsx(_components.span, {\n                className: \"token punctuation\",\n                children: \"{\"\n              }), \"String\", _jsx(_components.span, {\n                className: \"token operator\",\n                children: \"|\"\n              }), \"Audio\", _jsx(_components.span, {\n                className: \"token punctuation\",\n                children: \"}\"\n              })]\n            }), \" \", _jsx(_components.span, {\n              className: \"token parameter\",\n              children: \"message\"\n            }), \" the data of the message\\n * \", _jsx(_components.span, {\n              className: \"token keyword\",\n              children: \"@returns\"\n            }), \" \", _jsxs(_components.span, {\n              className: \"token class-name\",\n              children: [_jsx(_components.span, {\n                className: \"token punctuation\",\n                children: \"{\"\n              }), \"Promise\", _jsx(_components.span, {\n                className: \"token punctuation\",\n                children: \"}\"\n              })]\n            }), \" the promise resolved when all is done\\n */\"]\n          }), \"\\n\", _jsx(_components.span, {\n            className: \"token keyword\",\n            children: \"async\"\n          }), \" \", _jsx(_components.span, {\n            className: \"token keyword\",\n            children: \"function\"\n          }), \" \", _jsx(_components.span, {\n            className: \"token function\",\n            children: \"addUserMessage\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \"(\"\n          }), _jsxs(_components.span, {\n            className: \"token parameter\",\n            children: [\"ws\", _jsx(_components.span, {\n              className: \"token punctuation\",\n              children: \",\"\n            }), \" type\", _jsx(_components.span, {\n              className: \"token punctuation\",\n              children: \",\"\n            }), \" message\"]\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \")\"\n          }), \" \", _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \"{\"\n          }), \"\\n    \", _jsx(_components.span, {\n            className: \"token function\",\n            children: \"createMessageHTMLElement\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \"(\"\n          }), \"type\", _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \",\"\n          }), \" type \", _jsx(_components.span, {\n            className: \"token operator\",\n            children: \"===\"\n          }), \" \", _jsx(_components.span, {\n            className: \"token maybe-class-name\",\n            children: \"MessageType\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \".\"\n          }), _jsx(_components.span, {\n            className: \"token property-access\",\n            children: _jsx(_components.span, {\n              className: \"token maybe-class-name\",\n              children: \"User\"\n            })\n          }), \" \", _jsx(_components.span, {\n            className: \"token operator\",\n            children: \"?\"\n          }), \" message \", _jsx(_components.span, {\n            className: \"token operator\",\n            children: \":\"\n          }), \" \", _jsx(_components.span, {\n            className: \"token string\",\n            children: \"'Audio message'\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \")\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \";\"\n          }), \"\\n\\n    \", _jsx(_components.span, {\n            className: \"token comment\",\n            children: \"// Keeping own history log\"\n          }), \"\\n    \", _jsx(_components.span, {\n            className: \"token keyword control-flow\",\n            children: \"if\"\n          }), \" \", _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \"(\"\n          }), \"type \", _jsx(_components.span, {\n            className: \"token operator\",\n            children: \"===\"\n          }), \" \", _jsx(_components.span, {\n            className: \"token maybe-class-name\",\n            children: \"MessageType\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \".\"\n          }), _jsx(_components.span, {\n            className: \"token property-access\",\n            children: _jsx(_components.span, {\n              className: \"token maybe-class-name\",\n              children: \"User\"\n            })\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \")\"\n          }), \" \", _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \"{\"\n          }), \"\\n        messageHistory\", _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \".\"\n          }), _jsx(_components.span, {\n            className: \"token method function property-access\",\n            children: \"push\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \"(\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \"{\"\n          }), \" \", _jsx(_components.span, {\n            className: \"token literal-property property\",\n            children: \"role\"\n          }), _jsx(_components.span, {\n            className: \"token operator\",\n            children: \":\"\n          }), \" type \", _jsx(_components.span, {\n            className: \"token operator\",\n            children: \"===\"\n          }), \" \", _jsx(_components.span, {\n            className: \"token maybe-class-name\",\n            children: \"MessageType\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \".\"\n          }), _jsx(_components.span, {\n            className: \"token property-access\",\n            children: _jsx(_components.span, {\n              className: \"token maybe-class-name\",\n              children: \"User\"\n            })\n          }), \" \", _jsx(_components.span, {\n            className: \"token operator\",\n            children: \"?\"\n          }), \" \", _jsx(_components.span, {\n            className: \"token string\",\n            children: \"'user'\"\n          }), \" \", _jsx(_components.span, {\n            className: \"token operator\",\n            children: \":\"\n          }), \" \", _jsx(_components.span, {\n            className: \"token string\",\n            children: \"'assistant'\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \",\"\n          }), \" \", _jsx(_components.span, {\n            className: \"token literal-property property\",\n            children: \"content\"\n          }), _jsx(_components.span, {\n            className: \"token operator\",\n            children: \":\"\n          }), \" message \", _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \"}\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \")\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \";\"\n          }), \"\\n    \", _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \"}\"\n          }), \"\\n        \\n    \", _jsx(_components.span, {\n            className: \"token keyword control-flow\",\n            children: \"if\"\n          }), \" \", _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \"(\"\n          }), \"type \", _jsx(_components.span, {\n            className: \"token operator\",\n            children: \"===\"\n          }), \" \", _jsx(_components.span, {\n            className: \"token maybe-class-name\",\n            children: \"MessageType\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \".\"\n          }), _jsx(_components.span, {\n            className: \"token property-access\",\n            children: _jsx(_components.span, {\n              className: \"token maybe-class-name\",\n              children: \"User\"\n            })\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \")\"\n          }), \" \", _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \"{\"\n          }), \"\\n        \", _jsx(_components.span, {\n            className: \"token keyword control-flow\",\n            children: \"await\"\n          }), \" ws\", _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \".\"\n          }), _jsx(_components.span, {\n            className: \"token method function property-access\",\n            children: \"sendTextMessage\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \"(\"\n          }), \"message\", _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \",\"\n          }), \" \", _jsx(_components.span, {\n            className: \"token function\",\n            children: \"addBotMessageInChunks\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \"(\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \")\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \")\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \";\"\n          }), \"\\n    \", _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \"}\"\n          }), \" \", _jsx(_components.span, {\n            className: \"token keyword control-flow\",\n            children: \"else\"\n          }), \" \", _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \"{\"\n          }), \"\\n        \", _jsx(_components.span, {\n            className: \"token keyword control-flow\",\n            children: \"await\"\n          }), \" ws\", _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \".\"\n          }), _jsx(_components.span, {\n            className: \"token method function property-access\",\n            children: \"sendAudioEnd\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \"(\"\n          }), _jsx(_components.span, {\n            className: \"token function\",\n            children: \"addBotMessageInChunks\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \"(\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \")\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \")\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \";\"\n          }), \"\\n    \", _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \"}\"\n          }), \"\\n\", _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \"}\"\n          }), \"\\n\\n\", _jsxs(_components.span, {\n            className: \"token doc-comment comment\",\n            children: [\"/**\\n * Add bot message in chunks. The functions returns another function that when called with\\n * the argument will add that argument to the bot message.\\n * \\n * \", _jsx(_components.span, {\n              className: \"token keyword\",\n              children: \"@returns\"\n            }), \" \", _jsxs(_components.span, {\n              className: \"token class-name\",\n              children: [_jsx(_components.span, {\n                className: \"token punctuation\",\n                children: \"{\"\n              }), \"Function\", _jsx(_components.span, {\n                className: \"token punctuation\",\n                children: \"}\"\n              })]\n            }), \" the function accept a parameter `content`; when called the `content` is added to the message\\n */\"]\n          }), \"\\n\", _jsx(_components.span, {\n            className: \"token keyword\",\n            children: \"function\"\n          }), \" \", _jsx(_components.span, {\n            className: \"token function\",\n            children: \"addBotMessageInChunks\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \"(\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \")\"\n          }), \" \", _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \"{\"\n          }), \"\\n    \", _jsx(_components.span, {\n            className: \"token keyword\",\n            children: \"const\"\n          }), \" newMsg \", _jsx(_components.span, {\n            className: \"token operator\",\n            children: \"=\"\n          }), \" \", _jsx(_components.span, {\n            className: \"token function\",\n            children: \"createMessageHTMLElement\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \"(\"\n          }), _jsx(_components.span, {\n            className: \"token maybe-class-name\",\n            children: \"MessageType\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \".\"\n          }), _jsx(_components.span, {\n            className: \"token property-access\",\n            children: _jsx(_components.span, {\n              className: \"token maybe-class-name\",\n              children: \"Bot\"\n            })\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \")\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \";\"\n          }), \"\\n\\n    \", _jsx(_components.span, {\n            className: \"token keyword\",\n            children: \"let\"\n          }), \" nextContentIndex \", _jsx(_components.span, {\n            className: \"token operator\",\n            children: \"=\"\n          }), \" \", _jsx(_components.span, {\n            className: \"token number\",\n            children: \"0\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \";\"\n          }), \"\\n    \", _jsx(_components.span, {\n            className: \"token keyword\",\n            children: \"let\"\n          }), \" currentContentIndex \", _jsx(_components.span, {\n            className: \"token operator\",\n            children: \"=\"\n          }), \" \", _jsx(_components.span, {\n            className: \"token number\",\n            children: \"0\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \";\"\n          }), \"\\n    \", _jsx(_components.span, {\n            className: \"token keyword\",\n            children: \"let\"\n          }), \" currentContentPromise\", _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \";\"\n          }), \"\\n\\n    \", _jsx(_components.span, {\n            className: \"token keyword\",\n            children: \"const\"\n          }), \" \", _jsx(_components.span, {\n            className: \"token function-variable function\",\n            children: \"onNewMessageContent\"\n          }), \" \", _jsx(_components.span, {\n            className: \"token operator\",\n            children: \"=\"\n          }), \" \", _jsx(_components.span, {\n            className: \"token keyword\",\n            children: \"async\"\n          }), \" \", _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \"(\"\n          }), _jsx(_components.span, {\n            className: \"token parameter\",\n            children: \"content\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \")\"\n          }), \" \", _jsx(_components.span, {\n            className: \"token arrow operator\",\n            children: \"=>\"\n          }), \" \", _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \"{\"\n          }), \"\\n        \", _jsx(_components.span, {\n            className: \"token keyword\",\n            children: \"const\"\n          }), \" thisContentIndex \", _jsx(_components.span, {\n            className: \"token operator\",\n            children: \"=\"\n          }), \" nextContentIndex\", _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \";\"\n          }), \"\\n        nextContentIndex \", _jsx(_components.span, {\n            className: \"token operator\",\n            children: \"+=\"\n          }), \" \", _jsx(_components.span, {\n            className: \"token number\",\n            children: \"1\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \";\"\n          }), \"\\n\\n        \", _jsx(_components.span, {\n            className: \"token keyword control-flow\",\n            children: \"while\"\n          }), \" \", _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \"(\"\n          }), \"thisContentIndex \", _jsx(_components.span, {\n            className: \"token operator\",\n            children: \"!==\"\n          }), \" currentContentIndex\", _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \")\"\n          }), \" \", _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \"{\"\n          }), \"\\n            \", _jsx(_components.span, {\n            className: \"token keyword control-flow\",\n            children: \"await\"\n          }), \" currentContentPromise\", _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \";\"\n          }), \"\\n        \", _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \"}\"\n          }), \"\\n\\n        currentContentPromise \", _jsx(_components.span, {\n            className: \"token operator\",\n            children: \"=\"\n          }), \" \", _jsx(_components.span, {\n            className: \"token keyword\",\n            children: \"new\"\n          }), \" \", _jsx(_components.span, {\n            className: \"token class-name\",\n            children: \"Promise\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \"(\"\n          }), _jsx(_components.span, {\n            className: \"token keyword\",\n            children: \"async\"\n          }), \" \", _jsx(_components.span, {\n            className: \"token parameter\",\n            children: \"resolve\"\n          }), \" \", _jsx(_components.span, {\n            className: \"token arrow operator\",\n            children: \"=>\"\n          }), \" \", _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \"{\"\n          }), \"\\n            \", _jsx(_components.span, {\n            className: \"token keyword control-flow\",\n            children: \"await\"\n          }), \" \", _jsx(_components.span, {\n            className: \"token function\",\n            children: \"addContentToMessage\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \"(\"\n          }), \"newMsg\", _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \",\"\n          }), \" content\", _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \")\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \";\"\n          }), \"\\n\\n            currentContentIndex \", _jsx(_components.span, {\n            className: \"token operator\",\n            children: \"+=\"\n          }), \" \", _jsx(_components.span, {\n            className: \"token number\",\n            children: \"1\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \";\"\n          }), \"\\n            \", _jsx(_components.span, {\n            className: \"token function\",\n            children: \"resolve\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \"(\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \")\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \";\"\n          }), \"\\n        \", _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \"}\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \")\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \";\"\n          }), \"\\n    \", _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \"}\"\n          }), \"\\n\\n    \", _jsx(_components.span, {\n            className: \"token keyword control-flow\",\n            children: \"return\"\n          }), \" onNewMessageContent\", _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \";\"\n          }), \"\\n\", _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \"}\"\n          }), _jsxs(_components.span, {\n            \"aria-hidden\": \"true\",\n            className: \"line-numbers-rows\",\n            children: [_jsx(_components.span, {\n              className: \"\"\n            }), _jsx(_components.span, {\n              className: \"\"\n            }), _jsx(_components.span, {\n              className: \"\"\n            }), _jsx(_components.span, {\n              className: \"\"\n            }), _jsx(_components.span, {\n              className: \"\"\n            }), _jsx(_components.span, {\n              className: \"\"\n            }), _jsx(_components.span, {\n              className: \"\"\n            }), _jsx(_components.span, {\n              className: \"\"\n            }), _jsx(_components.span, {\n              className: \"\"\n            }), _jsx(_components.span, {\n              className: \"\"\n            }), _jsx(_components.span, {\n              className: \"\"\n            }), _jsx(_components.span, {\n              className: \"\"\n            }), _jsx(_components.span, {\n              className: \"\"\n            }), _jsx(_components.span, {\n              className: \"\"\n            }), _jsx(_components.span, {\n              className: \"\"\n            }), _jsx(_components.span, {\n              className: \"\"\n            }), _jsx(_components.span, {\n              className: \"\"\n            }), _jsx(_components.span, {\n              className: \"\"\n            }), _jsx(_components.span, {\n              className: \"\"\n            }), _jsx(_components.span, {\n              className: \"\"\n            }), _jsx(_components.span, {\n              className: \"\"\n            }), _jsx(_components.span, {\n              className: \"\"\n            }), _jsx(_components.span, {\n              className: \"\"\n            }), _jsx(_components.span, {\n              className: \"\"\n            }), _jsx(_components.span, {\n              className: \"\"\n            }), _jsx(_components.span, {\n              className: \"\"\n            }), _jsx(_components.span, {\n              className: \"\"\n            }), _jsx(_components.span, {\n              className: \"\"\n            }), _jsx(_components.span, {\n              className: \"\"\n            }), _jsx(_components.span, {\n              className: \"\"\n            }), _jsx(_components.span, {\n              className: \"\"\n            }), _jsx(_components.span, {\n              className: \"\"\n            }), _jsx(_components.span, {\n              className: \"\"\n            }), _jsx(_components.span, {\n              className: \"\"\n            }), _jsx(_components.span, {\n              className: \"\"\n            }), _jsx(_components.span, {\n              className: \"\"\n            }), _jsx(_components.span, {\n              className: \"\"\n            }), _jsx(_components.span, {\n              className: \"\"\n            }), _jsx(_components.span, {\n              className: \"\"\n            }), _jsx(_components.span, {\n              className: \"\"\n            }), _jsx(_components.span, {\n              className: \"\"\n            }), _jsx(_components.span, {\n              className: \"\"\n            }), _jsx(_components.span, {\n              className: \"\"\n            }), _jsx(_components.span, {\n              className: \"\"\n            }), _jsx(_components.span, {\n              className: \"\"\n            }), _jsx(_components.span, {\n              className: \"\"\n            }), _jsx(_components.span, {\n              className: \"\"\n            }), _jsx(_components.span, {\n              className: \"\"\n            }), _jsx(_components.span, {\n              className: \"\"\n            }), _jsx(_components.span, {\n              className: \"\"\n            }), _jsx(_components.span, {\n              className: \"\"\n            }), _jsx(_components.span, {\n              className: \"\"\n            }), _jsx(_components.span, {\n              className: \"\"\n            }), _jsx(_components.span, {\n              className: \"\"\n            }), _jsx(_components.span, {\n              className: \"\"\n            }), _jsx(_components.span, {\n              className: \"\"\n            })]\n          }), \"\\n\"]\n        })\n      })\n    }), \"\\n\", _jsxs(_components.p, {\n      children: [\"The \", _jsx(_components.code, {\n        children: \"addBotMessageInChunks\"\n      }), \" function is responsible for creating and returning\\nthe function that will append the given text/content to the current bot message.\"]\n    }), \"\\n\", _jsxs(_components.p, {\n      children: [\"Because we want to have a writting effect to the bot message as it comes in, we\\nneed to have a method to synchronize everything. The server will send the text\\nas it comes, and the \", _jsx(_components.code, {\n        children: \"addContentToMessage\"\n      }), \" function, which is responsible for\\ncreating the writting effect, may not be ready in time to handle the next\\nreceived text.\"]\n    }), \"\\n\", _jsx(_components.p, {\n      children: \"So, we came up with a simple synchronization mechanism: we create 2 counters and\\na variable that will hold a promise. Each time the returned function is\\ncalled we assign to that call the next index (line 39) and then increase the\\ncounter. The function will wait for its turn by waiting for the promise to be\\nresolved, and when it is its turn, it will overwrite the promise variable with a\\nnew promise that will just wait for the writting effect to be done (line 47) and\\nthen increase the counter.\"\n    }), \"\\n\", _jsx(_components.div, {\n      className: \"remark-highlight\",\n      children: _jsx(_components.pre, {\n        className: \"language-js  line-numbers\",\n        children: _jsxs(_components.code, {\n          className: \"language-js\",\n          children: [_jsx(_components.span, {\n            className: \"token comment\",\n            children: \"/* version-2/client.js */\"\n          }), \"\\n\", _jsxs(_components.span, {\n            className: \"token doc-comment comment\",\n            children: [\"/**\\n * Record the user and send the chunks to the server and on end wait for all the chunks to be sent.\\n * \", _jsx(_components.span, {\n              className: \"token keyword\",\n              children: \"@async\"\n            }), \"\\n * \\n * \", _jsx(_components.span, {\n              className: \"token keyword\",\n              children: \"@param\"\n            }), \" \", _jsxs(_components.span, {\n              className: \"token class-name\",\n              children: [_jsx(_components.span, {\n                className: \"token punctuation\",\n                children: \"{\"\n              }), \"WebSocket\", _jsx(_components.span, {\n                className: \"token punctuation\",\n                children: \"}\"\n              })]\n            }), \" \", _jsx(_components.span, {\n              className: \"token parameter\",\n              children: \"ws\"\n            }), \" the WebSocket\\n * \", _jsx(_components.span, {\n              className: \"token keyword\",\n              children: \"@param\"\n            }), \" \", _jsxs(_components.span, {\n              className: \"token class-name\",\n              children: [_jsx(_components.span, {\n                className: \"token punctuation\",\n                children: \"{\"\n              }), \"HTMLElement\", _jsx(_components.span, {\n                className: \"token punctuation\",\n                children: \"}\"\n              })]\n            }), \" \", _jsx(_components.span, {\n              className: \"token parameter\",\n              children: \"stopRecordButtonElement\"\n            }), \" the stop button element\\n * \", _jsx(_components.span, {\n              className: \"token keyword\",\n              children: \"@returns\"\n            }), \" \", _jsxs(_components.span, {\n              className: \"token class-name\",\n              children: [_jsx(_components.span, {\n                className: \"token punctuation\",\n                children: \"{\"\n              }), \"Promise\", _jsx(_components.span, {\n                className: \"token punctuation\",\n                children: \"}\"\n              })]\n            }), \"\\n */\"]\n          }), \"\\n\", _jsx(_components.span, {\n            className: \"token keyword\",\n            children: \"async\"\n          }), \" \", _jsx(_components.span, {\n            className: \"token keyword\",\n            children: \"function\"\n          }), \" \", _jsx(_components.span, {\n            className: \"token function\",\n            children: \"recordUserAudio\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \"(\"\n          }), _jsxs(_components.span, {\n            className: \"token parameter\",\n            children: [\"ws\", _jsx(_components.span, {\n              className: \"token punctuation\",\n              children: \",\"\n            }), \" stopRecordButtonElement\"]\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \")\"\n          }), \" \", _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \"{\"\n          }), \"\\n    \", _jsx(_components.span, {\n            className: \"token keyword\",\n            children: \"let\"\n          }), \" stream\", _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \";\"\n          }), \"\\n    \", _jsx(_components.span, {\n            className: \"token keyword control-flow\",\n            children: \"try\"\n          }), \" \", _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \"{\"\n          }), \"\\n        stream \", _jsx(_components.span, {\n            className: \"token operator\",\n            children: \"=\"\n          }), \" \", _jsx(_components.span, {\n            className: \"token keyword control-flow\",\n            children: \"await\"\n          }), \" \", _jsx(_components.span, {\n            className: \"token dom variable\",\n            children: \"navigator\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \".\"\n          }), _jsx(_components.span, {\n            className: \"token property-access\",\n            children: \"mediaDevices\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \".\"\n          }), _jsx(_components.span, {\n            className: \"token method function property-access\",\n            children: \"getUserMedia\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \"(\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \"{\"\n          }), \" \", _jsx(_components.span, {\n            className: \"token literal-property property\",\n            children: \"audio\"\n          }), _jsx(_components.span, {\n            className: \"token operator\",\n            children: \":\"\n          }), \" \", _jsx(_components.span, {\n            className: \"token boolean\",\n            children: \"true\"\n          }), \" \", _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \"}\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \")\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \";\"\n          }), \"\\n    \", _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \"}\"\n          }), \" \", _jsx(_components.span, {\n            className: \"token keyword control-flow\",\n            children: \"catch\"\n          }), \" \", _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \"(\"\n          }), \"error\", _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \")\"\n          }), \" \", _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \"{\"\n          }), \"\\n        \", _jsx(_components.span, {\n            className: \"token console class-name\",\n            children: \"console\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \".\"\n          }), _jsx(_components.span, {\n            className: \"token method function property-access\",\n            children: \"error\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \"(\"\n          }), _jsxs(_components.span, {\n            className: \"token template-string\",\n            children: [_jsx(_components.span, {\n              className: \"token template-punctuation string\",\n              children: \"`\"\n            }), _jsx(_components.span, {\n              className: \"token string\",\n              children: \"The following getUserMedia error occurred: \"\n            }), _jsxs(_components.span, {\n              className: \"token interpolation\",\n              children: [_jsx(_components.span, {\n                className: \"token interpolation-punctuation punctuation\",\n                children: \"${\"\n              }), \"error\", _jsx(_components.span, {\n                className: \"token interpolation-punctuation punctuation\",\n                children: \"}\"\n              })]\n            }), _jsx(_components.span, {\n              className: \"token template-punctuation string\",\n              children: \"`\"\n            })]\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \")\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \";\"\n          }), \"\\n        \", _jsx(_components.span, {\n            className: \"token keyword control-flow\",\n            children: \"return\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \";\"\n          }), \"\\n    \", _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \"}\"\n          }), \"\\n\\n    \", _jsx(_components.span, {\n            className: \"token keyword\",\n            children: \"const\"\n          }), \" mediaRecorder \", _jsx(_components.span, {\n            className: \"token operator\",\n            children: \"=\"\n          }), \" \", _jsx(_components.span, {\n            className: \"token keyword\",\n            children: \"new\"\n          }), \" \", _jsx(_components.span, {\n            className: \"token class-name\",\n            children: \"MediaRecorder\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \"(\"\n          }), \"stream\", _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \",\"\n          }), \" \", _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \"{\"\n          }), \" \", _jsx(_components.span, {\n            className: \"token literal-property property\",\n            children: \"mimeType\"\n          }), _jsx(_components.span, {\n            className: \"token operator\",\n            children: \":\"\n          }), \" \", _jsx(_components.span, {\n            className: \"token maybe-class-name\",\n            children: \"Settings\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \".\"\n          }), _jsx(_components.span, {\n            className: \"token property-access\",\n            children: _jsx(_components.span, {\n              className: \"token maybe-class-name\",\n              children: \"ClientAudioMimeType\"\n            })\n          }), \" \", _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \"}\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \")\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \";\"\n          }), \"\\n\\n    \", _jsx(_components.span, {\n            className: \"token keyword control-flow\",\n            children: \"return\"\n          }), \" \", _jsx(_components.span, {\n            className: \"token keyword\",\n            children: \"new\"\n          }), \" \", _jsx(_components.span, {\n            className: \"token class-name\",\n            children: \"Promise\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \"(\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \"(\"\n          }), _jsxs(_components.span, {\n            className: \"token parameter\",\n            children: [\"resolve\", _jsx(_components.span, {\n              className: \"token punctuation\",\n              children: \",\"\n            }), \" _reject\"]\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \")\"\n          }), \" \", _jsx(_components.span, {\n            className: \"token arrow operator\",\n            children: \"=>\"\n          }), \" \", _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \"{\"\n          }), \"\\n        \", _jsx(_components.span, {\n            className: \"token keyword\",\n            children: \"const\"\n          }), \" \", _jsx(_components.span, {\n            className: \"token function-variable function\",\n            children: \"onStopClick\"\n          }), \" \", _jsx(_components.span, {\n            className: \"token operator\",\n            children: \"=\"\n          }), \" \", _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \"(\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \")\"\n          }), \" \", _jsx(_components.span, {\n            className: \"token arrow operator\",\n            children: \"=>\"\n          }), \" \", _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \"{\"\n          }), \"\\n            mediaRecorder\", _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \".\"\n          }), _jsx(_components.span, {\n            className: \"token method function property-access\",\n            children: \"stop\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \"(\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \")\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \";\"\n          }), \"\\n            stopRecordButtonElement\", _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \".\"\n          }), _jsx(_components.span, {\n            className: \"token property-access\",\n            children: \"classList\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \".\"\n          }), _jsx(_components.span, {\n            className: \"token method function property-access\",\n            children: \"remove\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \"(\"\n          }), _jsx(_components.span, {\n            className: \"token string\",\n            children: \"'show'\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \")\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \";\"\n          }), \"\\n        \", _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \"}\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \";\"\n          }), \"\\n\\n        \", _jsx(_components.span, {\n            className: \"token comment\",\n            children: \"// Create an array to store the promises of the sent audio chunks so we can make sure that\"\n          }), \"\\n        \", _jsx(_components.span, {\n            className: \"token comment\",\n            children: \"// when the user hit the stop button all the audio chunks are sent\"\n          }), \"\\n        \", _jsx(_components.span, {\n            className: \"token keyword\",\n            children: \"const\"\n          }), \" sentAudioChunksPromises \", _jsx(_components.span, {\n            className: \"token operator\",\n            children: \"=\"\n          }), \" \", _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \"[\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \"]\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \";\"\n          }), \"\\n\\n        mediaRecorder\", _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \".\"\n          }), _jsx(_components.span, {\n            className: \"token method function property-access\",\n            children: \"addEventListener\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \"(\"\n          }), _jsx(_components.span, {\n            className: \"token string\",\n            children: \"'dataavailable'\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \",\"\n          }), \" \", _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \"(\"\n          }), _jsx(_components.span, {\n            className: \"token parameter\",\n            children: \"event\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \")\"\n          }), \" \", _jsx(_components.span, {\n            className: \"token arrow operator\",\n            children: \"=>\"\n          }), \" \", _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \"{\"\n          }), \"\\n            sentAudioChunksPromises\", _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \".\"\n          }), _jsx(_components.span, {\n            className: \"token method function property-access\",\n            children: \"push\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \"(\"\n          }), \"ws\", _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \".\"\n          }), _jsx(_components.span, {\n            className: \"token method function property-access\",\n            children: \"sendAudioChunk\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \"(\"\n          }), \"event\", _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \".\"\n          }), _jsx(_components.span, {\n            className: \"token property-access\",\n            children: \"data\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \")\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \")\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \";\"\n          }), \"\\n        \", _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \"}\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \")\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \";\"\n          }), \"\\n\\n        mediaRecorder\", _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \".\"\n          }), _jsx(_components.span, {\n            className: \"token method function property-access\",\n            children: \"addEventListener\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \"(\"\n          }), _jsx(_components.span, {\n            className: \"token string\",\n            children: \"'stop'\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \",\"\n          }), \" \", _jsx(_components.span, {\n            className: \"token keyword\",\n            children: \"async\"\n          }), \" \", _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \"(\"\n          }), _jsx(_components.span, {\n            className: \"token parameter\",\n            children: \"_event\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \")\"\n          }), \" \", _jsx(_components.span, {\n            className: \"token arrow operator\",\n            children: \"=>\"\n          }), \" \", _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \"{\"\n          }), \"\\n            \", _jsx(_components.span, {\n            className: \"token keyword control-flow\",\n            children: \"await\"\n          }), \" \", _jsx(_components.span, {\n            className: \"token known-class-name class-name\",\n            children: \"Promise\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \".\"\n          }), _jsx(_components.span, {\n            className: \"token method function property-access\",\n            children: \"all\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \"(\"\n          }), \"sentAudioChunksPromises\", _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \")\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \";\"\n          }), \"\\n\\n            \", _jsx(_components.span, {\n            className: \"token comment\",\n            children: \"// Stop the audio listening\"\n          }), \"\\n            stream\", _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \".\"\n          }), _jsx(_components.span, {\n            className: \"token method function property-access\",\n            children: \"getAudioTracks\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \"(\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \")\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \".\"\n          }), _jsx(_components.span, {\n            className: \"token method function property-access\",\n            children: \"forEach\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \"(\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \"(\"\n          }), _jsx(_components.span, {\n            className: \"token parameter\",\n            children: \"track\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \")\"\n          }), \" \", _jsx(_components.span, {\n            className: \"token arrow operator\",\n            children: \"=>\"\n          }), \" \", _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \"{\"\n          }), \"\\n                track\", _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \".\"\n          }), _jsx(_components.span, {\n            className: \"token method function property-access\",\n            children: \"stop\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \"(\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \")\"\n          }), \"\\n                stream\", _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \".\"\n          }), _jsx(_components.span, {\n            className: \"token method function property-access\",\n            children: \"removeTrack\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \"(\"\n          }), \"track\", _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \")\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \";\"\n          }), \"\\n            \", _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \"}\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \")\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \";\"\n          }), \"\\n\\n            \", _jsx(_components.span, {\n            className: \"token function\",\n            children: \"resolve\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \"(\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \")\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \";\"\n          }), \"\\n        \", _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \"}\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \")\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \";\"\n          }), \"\\n\\n        stopRecordButtonElement\", _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \".\"\n          }), _jsx(_components.span, {\n            className: \"token property-access\",\n            children: \"classList\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \".\"\n          }), _jsx(_components.span, {\n            className: \"token method function property-access\",\n            children: \"add\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \"(\"\n          }), _jsx(_components.span, {\n            className: \"token string\",\n            children: \"'show'\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \")\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \";\"\n          }), \"\\n\\n        \", _jsx(_components.span, {\n            className: \"token comment\",\n            children: \"// The parameter of `start` is called `timeslice` and define how often, in milliseconds,\"\n          }), \"\\n        \", _jsx(_components.span, {\n            className: \"token comment\",\n            children: \"// to fire the `dataavailable` event with the audio chunk\"\n          }), \"\\n        mediaRecorder\", _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \".\"\n          }), _jsx(_components.span, {\n            className: \"token method function property-access\",\n            children: \"start\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \"(\"\n          }), _jsx(_components.span, {\n            className: \"token number\",\n            children: \"1000\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \")\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \";\"\n          }), \"\\n\\n        stopRecordButtonElement\", _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \".\"\n          }), _jsx(_components.span, {\n            className: \"token method function property-access\",\n            children: \"addEventListener\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \"(\"\n          }), _jsx(_components.span, {\n            className: \"token string\",\n            children: \"'click'\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \",\"\n          }), \" onStopClick\", _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \")\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \";\"\n          }), \"\\n    \", _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \"}\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \")\"\n          }), \"\\n\", _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \"}\"\n          }), _jsxs(_components.span, {\n            \"aria-hidden\": \"true\",\n            className: \"line-numbers-rows\",\n            children: [_jsx(_components.span, {\n              className: \"\"\n            }), _jsx(_components.span, {\n              className: \"\"\n            }), _jsx(_components.span, {\n              className: \"\"\n            }), _jsx(_components.span, {\n              className: \"\"\n            }), _jsx(_components.span, {\n              className: \"\"\n            }), _jsx(_components.span, {\n              className: \"\"\n            }), _jsx(_components.span, {\n              className: \"\"\n            }), _jsx(_components.span, {\n              className: \"\"\n            }), _jsx(_components.span, {\n              className: \"\"\n            }), _jsx(_components.span, {\n              className: \"\"\n            }), _jsx(_components.span, {\n              className: \"\"\n            }), _jsx(_components.span, {\n              className: \"\"\n            }), _jsx(_components.span, {\n              className: \"\"\n            }), _jsx(_components.span, {\n              className: \"\"\n            }), _jsx(_components.span, {\n              className: \"\"\n            }), _jsx(_components.span, {\n              className: \"\"\n            }), _jsx(_components.span, {\n              className: \"\"\n            }), _jsx(_components.span, {\n              className: \"\"\n            }), _jsx(_components.span, {\n              className: \"\"\n            }), _jsx(_components.span, {\n              className: \"\"\n            }), _jsx(_components.span, {\n              className: \"\"\n            }), _jsx(_components.span, {\n              className: \"\"\n            }), _jsx(_components.span, {\n              className: \"\"\n            }), _jsx(_components.span, {\n              className: \"\"\n            }), _jsx(_components.span, {\n              className: \"\"\n            }), _jsx(_components.span, {\n              className: \"\"\n            }), _jsx(_components.span, {\n              className: \"\"\n            }), _jsx(_components.span, {\n              className: \"\"\n            }), _jsx(_components.span, {\n              className: \"\"\n            }), _jsx(_components.span, {\n              className: \"\"\n            }), _jsx(_components.span, {\n              className: \"\"\n            }), _jsx(_components.span, {\n              className: \"\"\n            }), _jsx(_components.span, {\n              className: \"\"\n            }), _jsx(_components.span, {\n              className: \"\"\n            }), _jsx(_components.span, {\n              className: \"\"\n            }), _jsx(_components.span, {\n              className: \"\"\n            }), _jsx(_components.span, {\n              className: \"\"\n            }), _jsx(_components.span, {\n              className: \"\"\n            }), _jsx(_components.span, {\n              className: \"\"\n            }), _jsx(_components.span, {\n              className: \"\"\n            }), _jsx(_components.span, {\n              className: \"\"\n            }), _jsx(_components.span, {\n              className: \"\"\n            }), _jsx(_components.span, {\n              className: \"\"\n            }), _jsx(_components.span, {\n              className: \"\"\n            }), _jsx(_components.span, {\n              className: \"\"\n            }), _jsx(_components.span, {\n              className: \"\"\n            }), _jsx(_components.span, {\n              className: \"\"\n            }), _jsx(_components.span, {\n              className: \"\"\n            }), _jsx(_components.span, {\n              className: \"\"\n            }), _jsx(_components.span, {\n              className: \"\"\n            }), _jsx(_components.span, {\n              className: \"\"\n            }), _jsx(_components.span, {\n              className: \"\"\n            }), _jsx(_components.span, {\n              className: \"\"\n            }), _jsx(_components.span, {\n              className: \"\"\n            }), _jsx(_components.span, {\n              className: \"\"\n            })]\n          }), \"\\n\"]\n        })\n      })\n    }), \"\\n\", _jsxs(_components.p, {\n      children: [\"The function \", _jsx(_components.code, {\n        children: \"recordUserAudio\"\n      }), \" was also changed sightly:\"]\n    }), \"\\n\", _jsxs(_components.ul, {\n      children: [\"\\n\", _jsxs(_components.li, {\n        children: [\"Calling \", _jsx(_components.code, {\n          children: \"mediaRecorder.start()\"\n        }), \" with the argument \", _jsx(_components.code, {\n          children: \"1000\"\n        }), \" will slice the user's\\naudio into chunks of \", _jsx(_components.strong, {\n          children: \"1 seconds\"\n        }), \", which will be received in the handler for\\nthe \", _jsx(_components.code, {\n          children: \"dataavailable\"\n        }), \" event;\"]\n      }), \"\\n\", _jsxs(_components.li, {\n        children: [\"The handler for the \", _jsx(_components.code, {\n          children: \"dataavailable\"\n        }), \" event will add the promise returned by the\\ncalling of \", _jsx(_components.code, {\n          children: \"ws.sendAudioChunk\"\n        }), \" into an array so we can wait for all of them to\\nfinish in the handler for the \", _jsx(_components.code, {\n          children: \"stop\"\n        }), \" event of our \", _jsx(_components.code, {\n          children: \"MediaRecorder\"\n        }), \" instance.\"]\n      }), \"\\n\"]\n    }), \"\\n\", _jsx(_components.p, {\n      children: \"This is pretty much it for the client-side.\"\n    }), \"\\n\", _jsx(_components.p, {\n      children: \"Now let's switch to the server side to see what was added:\"\n    }), \"\\n\", _jsx(_components.div, {\n      className: \"remark-highlight\",\n      children: _jsx(_components.pre, {\n        className: \"language-js  line-numbers\",\n        children: _jsxs(_components.code, {\n          className: \"language-js\",\n          children: [_jsx(_components.span, {\n            className: \"token comment\",\n            children: \"/* version-2/server.js */\"\n          }), \"\\n\", _jsx(_components.span, {\n            className: \"token keyword\",\n            children: \"const\"\n          }), \" webSocketServer \", _jsx(_components.span, {\n            className: \"token operator\",\n            children: \"=\"\n          }), \" \", _jsx(_components.span, {\n            className: \"token keyword\",\n            children: \"new\"\n          }), \" \", _jsx(_components.span, {\n            className: \"token class-name\",\n            children: \"WebSocketServer\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \"(\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \"{\"\n          }), \" \", _jsx(_components.span, {\n            className: \"token literal-property property\",\n            children: \"port\"\n          }), _jsx(_components.span, {\n            className: \"token operator\",\n            children: \":\"\n          }), \" \", _jsx(_components.span, {\n            className: \"token maybe-class-name\",\n            children: \"Settings\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \".\"\n          }), _jsx(_components.span, {\n            className: \"token property-access\",\n            children: _jsx(_components.span, {\n              className: \"token maybe-class-name\",\n              children: \"WSPort\"\n            })\n          }), \" \", _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \"}\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \")\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \";\"\n          }), \"\\n\\nwebSocketServer\", _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \".\"\n          }), _jsx(_components.span, {\n            className: \"token method function property-access\",\n            children: \"on\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \"(\"\n          }), _jsx(_components.span, {\n            className: \"token string\",\n            children: \"'connection'\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \",\"\n          }), \" \", _jsx(_components.span, {\n            className: \"token keyword\",\n            children: \"function\"\n          }), \" \", _jsx(_components.span, {\n            className: \"token function\",\n            children: \"connection\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \"(\"\n          }), _jsx(_components.span, {\n            className: \"token parameter\",\n            children: \"clientWS\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \")\"\n          }), \" \", _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \"{\"\n          }), \"\\n    \", _jsx(_components.span, {\n            className: \"token comment\",\n            children: \"// Array to keep all the audio chunks until the user is done talking\"\n          }), \"\\n    clientWS\", _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \".\"\n          }), _jsx(_components.span, {\n            className: \"token property-access\",\n            children: \"audioChunks\"\n          }), \" \", _jsx(_components.span, {\n            className: \"token operator\",\n            children: \"=\"\n          }), \" \", _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \"[\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \"]\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \";\"\n          }), \"\\n\\n    clientWS\", _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \".\"\n          }), _jsx(_components.span, {\n            className: \"token method function property-access\",\n            children: \"on\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \"(\"\n          }), _jsx(_components.span, {\n            className: \"token string\",\n            children: \"'error'\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \",\"\n          }), \" \", _jsx(_components.span, {\n            className: \"token console class-name\",\n            children: \"console\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \".\"\n          }), _jsx(_components.span, {\n            className: \"token property-access\",\n            children: \"error\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \")\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \";\"\n          }), \"\\n    \\n    clientWS\", _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \".\"\n          }), _jsx(_components.span, {\n            className: \"token method function property-access\",\n            children: \"on\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \"(\"\n          }), _jsx(_components.span, {\n            className: \"token string\",\n            children: \"'message'\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \",\"\n          }), \" \", _jsx(_components.span, {\n            className: \"token keyword\",\n            children: \"async\"\n          }), \" \", _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \"(\"\n          }), _jsxs(_components.span, {\n            className: \"token parameter\",\n            children: [\"data\", _jsx(_components.span, {\n              className: \"token punctuation\",\n              children: \",\"\n            }), \" isBinary\"]\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \")\"\n          }), \" \", _jsx(_components.span, {\n            className: \"token arrow operator\",\n            children: \"=>\"\n          }), \" \", _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \"{\"\n          }), \"\\n        \", _jsx(_components.span, {\n            className: \"token comment\",\n            children: \"// ...\"\n          }), \"\\n    \", _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \"}\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \")\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \";\"\n          }), \"\\n\", _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \"}\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \")\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \";\"\n          }), _jsxs(_components.span, {\n            \"aria-hidden\": \"true\",\n            className: \"line-numbers-rows\",\n            children: [_jsx(_components.span, {\n              className: \"\"\n            }), _jsx(_components.span, {\n              className: \"\"\n            }), _jsx(_components.span, {\n              className: \"\"\n            }), _jsx(_components.span, {\n              className: \"\"\n            }), _jsx(_components.span, {\n              className: \"\"\n            }), _jsx(_components.span, {\n              className: \"\"\n            }), _jsx(_components.span, {\n              className: \"\"\n            }), _jsx(_components.span, {\n              className: \"\"\n            }), _jsx(_components.span, {\n              className: \"\"\n            }), _jsx(_components.span, {\n              className: \"\"\n            }), _jsx(_components.span, {\n              className: \"\"\n            }), _jsx(_components.span, {\n              className: \"\"\n            }), _jsx(_components.span, {\n              className: \"\"\n            })]\n          }), \"\\n\"]\n        })\n      })\n    }), \"\\n\", _jsxs(_components.p, {\n      children: [\"We are creating the WebSocket server (using the \", _jsx(_components.code, {\n        children: \"ws\"\n      }), \" package) with our defined\\nport. Once we have a connection, we add an empty array called \", _jsx(_components.code, {\n        children: \"audioChunks\"\n      }), \"to\\nthe client socket, which will hold the audio buffer chunks.\"]\n    }), \"\\n\", _jsx(_components.p, {\n      children: \"When the user send a message, we do the following:\"\n    }), \"\\n\", _jsx(_components.div, {\n      className: \"remark-highlight\",\n      children: _jsx(_components.pre, {\n        className: \"language-js  line-numbers\",\n        children: _jsxs(_components.code, {\n          className: \"language-js\",\n          children: [_jsx(_components.span, {\n            className: \"token comment\",\n            children: \"/* version-2/server.js */\"\n          }), \"\\n\", _jsx(_components.span, {\n            className: \"token comment\",\n            children: \"// ...\"\n          }), \"\\n\\n\", _jsx(_components.span, {\n            className: \"token comment\",\n            children: \"// If the message is non-binary then reject it.\"\n          }), \"\\n\", _jsx(_components.span, {\n            className: \"token comment\",\n            children: \"// If the user did not already set the chatID then we close the socket.\"\n          }), \"\\n\", _jsx(_components.span, {\n            className: \"token keyword control-flow\",\n            children: \"if\"\n          }), \" \", _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \"(\"\n          }), _jsx(_components.span, {\n            className: \"token operator\",\n            children: \"!\"\n          }), \"isBinary\", _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \")\"\n          }), \" \", _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \"{\"\n          }), \"\\n    \", _jsx(_components.span, {\n            className: \"token keyword\",\n            children: \"const\"\n          }), \" errorMsg \", _jsx(_components.span, {\n            className: \"token operator\",\n            children: \"=\"\n          }), \" \", _jsx(_components.span, {\n            className: \"token string\",\n            children: \"'Only binary messages are supported.'\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \";\"\n          }), \"\\n    clientWS\", _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \".\"\n          }), _jsx(_components.span, {\n            className: \"token method function property-access\",\n            children: \"send\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \"(\"\n          }), _jsx(_components.span, {\n            className: \"token maybe-class-name\",\n            children: \"Buffer\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \".\"\n          }), _jsx(_components.span, {\n            className: \"token keyword module\",\n            children: \"from\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \"(\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \"[\"\n          }), _jsx(_components.span, {\n            className: \"token maybe-class-name\",\n            children: \"ServerMessageID\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \".\"\n          }), _jsx(_components.span, {\n            className: \"token known-class-name class-name\",\n            children: \"Error\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \",\"\n          }), \" errorMsg\", _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \"]\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \")\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \")\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \";\"\n          }), \"\\n    \", _jsx(_components.span, {\n            className: \"token console class-name\",\n            children: \"console\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \".\"\n          }), _jsx(_components.span, {\n            className: \"token method function property-access\",\n            children: \"error\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \"(\"\n          }), _jsxs(_components.span, {\n            className: \"token template-string\",\n            children: [_jsx(_components.span, {\n              className: \"token template-punctuation string\",\n              children: \"`\"\n            }), _jsx(_components.span, {\n              className: \"token string\",\n              children: \"(ChatID: \"\n            }), _jsxs(_components.span, {\n              className: \"token interpolation\",\n              children: [_jsx(_components.span, {\n                className: \"token interpolation-punctuation punctuation\",\n                children: \"${\"\n              }), \"clientWS\", _jsx(_components.span, {\n                className: \"token punctuation\",\n                children: \".\"\n              }), _jsx(_components.span, {\n                className: \"token property-access\",\n                children: \"chatID\"\n              }), _jsx(_components.span, {\n                className: \"token interpolation-punctuation punctuation\",\n                children: \"}\"\n              })]\n            }), _jsx(_components.span, {\n              className: \"token string\",\n              children: \") Non-binary message received.\"\n            }), _jsx(_components.span, {\n              className: \"token template-punctuation string\",\n              children: \"`\"\n            })]\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \")\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \";\"\n          }), \"\\n\\n    \", _jsx(_components.span, {\n            className: \"token keyword control-flow\",\n            children: \"if\"\n          }), \" \", _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \"(\"\n          }), _jsx(_components.span, {\n            className: \"token operator\",\n            children: \"!\"\n          }), \"clientWS\", _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \".\"\n          }), _jsx(_components.span, {\n            className: \"token property-access\",\n            children: \"chatID\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \")\"\n          }), \" \", _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \"{\"\n          }), \"\\n        clientWS\", _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \".\"\n          }), _jsx(_components.span, {\n            className: \"token method function property-access\",\n            children: \"close\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \"(\"\n          }), _jsx(_components.span, {\n            className: \"token number\",\n            children: \"1003\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \",\"\n          }), \" errorMsg\", _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \")\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \";\"\n          }), \"\\n    \", _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \"}\"\n          }), \"\\n\\n    \", _jsx(_components.span, {\n            className: \"token keyword control-flow\",\n            children: \"return\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \";\"\n          }), \"\\n\", _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \"}\"\n          }), \"\\n\\n\", _jsx(_components.span, {\n            className: \"token keyword\",\n            children: \"const\"\n          }), \" messageType \", _jsx(_components.span, {\n            className: \"token operator\",\n            children: \"=\"\n          }), \" data\", _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \"[\"\n          }), _jsx(_components.span, {\n            className: \"token number\",\n            children: \"0\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \"]\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \";\"\n          }), \"\\n\", _jsx(_components.span, {\n            className: \"token keyword\",\n            children: \"const\"\n          }), \" payload \", _jsx(_components.span, {\n            className: \"token operator\",\n            children: \"=\"\n          }), \" data\", _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \".\"\n          }), _jsx(_components.span, {\n            className: \"token method function property-access\",\n            children: \"slice\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \"(\"\n          }), _jsx(_components.span, {\n            className: \"token number\",\n            children: \"1\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \")\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \";\"\n          }), \"\\n\\n\", _jsx(_components.span, {\n            className: \"token keyword control-flow\",\n            children: \"if\"\n          }), \" \", _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \"(\"\n          }), _jsx(_components.span, {\n            className: \"token operator\",\n            children: \"!\"\n          }), \"clientWS\", _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \".\"\n          }), _jsx(_components.span, {\n            className: \"token property-access\",\n            children: \"chatID\"\n          }), \" \", _jsx(_components.span, {\n            className: \"token operator\",\n            children: \"&&\"\n          }), \" messageType \", _jsx(_components.span, {\n            className: \"token operator\",\n            children: \"!==\"\n          }), \" \", _jsx(_components.span, {\n            className: \"token maybe-class-name\",\n            children: \"ClientMessageID\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \".\"\n          }), _jsx(_components.span, {\n            className: \"token property-access\",\n            children: _jsx(_components.span, {\n              className: \"token maybe-class-name\",\n              children: \"SetClientID\"\n            })\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \")\"\n          }), \" \", _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \"{\"\n          }), \"\\n    clientWS\", _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \".\"\n          }), _jsx(_components.span, {\n            className: \"token method function property-access\",\n            children: \"send\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \"(\"\n          }), _jsx(_components.span, {\n            className: \"token maybe-class-name\",\n            children: \"Buffer\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \".\"\n          }), _jsx(_components.span, {\n            className: \"token keyword module\",\n            children: \"from\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \"(\"\n          }), _jsx(_components.span, {\n            className: \"token string\",\n            children: \"'Error! Please send first your ID'\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \")\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \")\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \";\"\n          }), \"\\n\", _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \"}\"\n          }), \" \", _jsx(_components.span, {\n            className: \"token keyword control-flow\",\n            children: \"else\"\n          }), \" \", _jsx(_components.span, {\n            className: \"token keyword control-flow\",\n            children: \"if\"\n          }), \" \", _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \"(\"\n          }), \"messageType \", _jsx(_components.span, {\n            className: \"token operator\",\n            children: \"===\"\n          }), \" \", _jsx(_components.span, {\n            className: \"token maybe-class-name\",\n            children: \"ClientMessageID\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \".\"\n          }), _jsx(_components.span, {\n            className: \"token property-access\",\n            children: _jsx(_components.span, {\n              className: \"token maybe-class-name\",\n              children: \"SetClientID\"\n            })\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \")\"\n          }), \" \", _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \"{\"\n          }), \"\\n    \", _jsx(_components.span, {\n            className: \"token keyword\",\n            children: \"const\"\n          }), \" id \", _jsx(_components.span, {\n            className: \"token operator\",\n            children: \"=\"\n          }), \" payload\", _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \".\"\n          }), _jsx(_components.span, {\n            className: \"token method function property-access\",\n            children: \"toString\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \"(\"\n          }), _jsx(_components.span, {\n            className: \"token string\",\n            children: \"'utf8'\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \")\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \";\"\n          }), \"\\n\\n    \", _jsx(_components.span, {\n            className: \"token keyword control-flow\",\n            children: \"if\"\n          }), \" \", _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \"(\"\n          }), _jsx(_components.span, {\n            className: \"token keyword\",\n            children: \"typeof\"\n          }), \" id \", _jsx(_components.span, {\n            className: \"token operator\",\n            children: \"===\"\n          }), \" \", _jsx(_components.span, {\n            className: \"token string\",\n            children: \"'string'\"\n          }), \" \", _jsx(_components.span, {\n            className: \"token operator\",\n            children: \"&&\"\n          }), \" id\", _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \".\"\n          }), _jsx(_components.span, {\n            className: \"token method function property-access\",\n            children: \"trim\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \"(\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \")\"\n          }), \" \", _jsx(_components.span, {\n            className: \"token operator\",\n            children: \"!==\"\n          }), \" \", _jsx(_components.span, {\n            className: \"token string\",\n            children: \"''\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \")\"\n          }), \" \", _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \"{\"\n          }), \"\\n        clientWS\", _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \".\"\n          }), _jsx(_components.span, {\n            className: \"token property-access\",\n            children: \"chatID\"\n          }), \" \", _jsx(_components.span, {\n            className: \"token operator\",\n            children: \"=\"\n          }), \" id\", _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \";\"\n          }), \"\\n        clientWS\", _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \".\"\n          }), _jsx(_components.span, {\n            className: \"token method function property-access\",\n            children: \"send\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \"(\"\n          }), _jsx(_components.span, {\n            className: \"token maybe-class-name\",\n            children: \"Buffer\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \".\"\n          }), _jsx(_components.span, {\n            className: \"token keyword module\",\n            children: \"from\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \"(\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \"[\"\n          }), _jsx(_components.span, {\n            className: \"token maybe-class-name\",\n            children: \"ServerMessageID\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \".\"\n          }), _jsx(_components.span, {\n            className: \"token constant\",\n            children: \"OK\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \"]\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \")\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \")\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \";\"\n          }), \"\\n    \", _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \"}\"\n          }), \" \", _jsx(_components.span, {\n            className: \"token keyword control-flow\",\n            children: \"else\"\n          }), \" \", _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \"{\"\n          }), \"\\n        clientWS\", _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \".\"\n          }), _jsx(_components.span, {\n            className: \"token method function property-access\",\n            children: \"send\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \"(\"\n          }), _jsx(_components.span, {\n            className: \"token maybe-class-name\",\n            children: \"Buffer\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \".\"\n          }), _jsx(_components.span, {\n            className: \"token keyword module\",\n            children: \"from\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \"(\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \"[\"\n          }), _jsx(_components.span, {\n            className: \"token maybe-class-name\",\n            children: \"ServerMessageID\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \".\"\n          }), _jsx(_components.span, {\n            className: \"token known-class-name class-name\",\n            children: \"Error\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \",\"\n          }), \" \", _jsx(_components.span, {\n            className: \"token spread operator\",\n            children: \"...\"\n          }), _jsx(_components.span, {\n            className: \"token maybe-class-name\",\n            children: \"Buffer\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \".\"\n          }), _jsx(_components.span, {\n            className: \"token keyword module\",\n            children: \"from\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \"(\"\n          }), _jsx(_components.span, {\n            className: \"token string\",\n            children: \"'Error! Invalid ID. Please send a valid string ID.'\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \")\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \"]\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \")\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \")\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \";\"\n          }), \"\\n    \", _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \"}\"\n          }), \"\\n\", _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \"}\"\n          }), \"\\n\\n\", _jsx(_components.span, {\n            className: \"token comment\",\n            children: \"// ...\"\n          }), _jsxs(_components.span, {\n            \"aria-hidden\": \"true\",\n            className: \"line-numbers-rows\",\n            children: [_jsx(_components.span, {\n              className: \"\"\n            }), _jsx(_components.span, {\n              className: \"\"\n            }), _jsx(_components.span, {\n              className: \"\"\n            }), _jsx(_components.span, {\n              className: \"\"\n            }), _jsx(_components.span, {\n              className: \"\"\n            }), _jsx(_components.span, {\n              className: \"\"\n            }), _jsx(_components.span, {\n              className: \"\"\n            }), _jsx(_components.span, {\n              className: \"\"\n            }), _jsx(_components.span, {\n              className: \"\"\n            }), _jsx(_components.span, {\n              className: \"\"\n            }), _jsx(_components.span, {\n              className: \"\"\n            }), _jsx(_components.span, {\n              className: \"\"\n            }), _jsx(_components.span, {\n              className: \"\"\n            }), _jsx(_components.span, {\n              className: \"\"\n            }), _jsx(_components.span, {\n              className: \"\"\n            }), _jsx(_components.span, {\n              className: \"\"\n            }), _jsx(_components.span, {\n              className: \"\"\n            }), _jsx(_components.span, {\n              className: \"\"\n            }), _jsx(_components.span, {\n              className: \"\"\n            }), _jsx(_components.span, {\n              className: \"\"\n            }), _jsx(_components.span, {\n              className: \"\"\n            }), _jsx(_components.span, {\n              className: \"\"\n            }), _jsx(_components.span, {\n              className: \"\"\n            }), _jsx(_components.span, {\n              className: \"\"\n            }), _jsx(_components.span, {\n              className: \"\"\n            }), _jsx(_components.span, {\n              className: \"\"\n            }), _jsx(_components.span, {\n              className: \"\"\n            }), _jsx(_components.span, {\n              className: \"\"\n            }), _jsx(_components.span, {\n              className: \"\"\n            }), _jsx(_components.span, {\n              className: \"\"\n            }), _jsx(_components.span, {\n              className: \"\"\n            }), _jsx(_components.span, {\n              className: \"\"\n            }), _jsx(_components.span, {\n              className: \"\"\n            }), _jsx(_components.span, {\n              className: \"\"\n            })]\n          }), \"\\n\"]\n        })\n      })\n    }), \"\\n\", _jsxs(_components.p, {\n      children: [\"First, we check if the received message is in binary. After that, we\\nseparate the message type (\", _jsx(_components.code, {\n        children: \"messageType\"\n      }), \") from the rest of the data (\", _jsx(_components.code, {\n        children: \"payload\"\n      }), \").\\nIf the client hasn't sent the chat ID yet and the message type is not for\\nthis, then return an error. Otherwise, we store the chat ID if is correct inside\\nthe client socket.\"]\n    }), \"\\n\", _jsx(_components.div, {\n      className: \"remark-highlight\",\n      children: _jsx(_components.pre, {\n        className: \"language-js  line-numbers\",\n        children: _jsxs(_components.code, {\n          className: \"language-js\",\n          children: [_jsx(_components.span, {\n            className: \"token comment\",\n            children: \"/* version-2/server.js */\"\n          }), \"\\n\", _jsx(_components.span, {\n            className: \"token comment\",\n            children: \"// ...\"\n          }), \"\\n\", _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \"}\"\n          }), \" \", _jsx(_components.span, {\n            className: \"token keyword control-flow\",\n            children: \"else\"\n          }), \" \", _jsx(_components.span, {\n            className: \"token keyword control-flow\",\n            children: \"if\"\n          }), \" \", _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \"(\"\n          }), \"messageType \", _jsx(_components.span, {\n            className: \"token operator\",\n            children: \"===\"\n          }), \" \", _jsx(_components.span, {\n            className: \"token maybe-class-name\",\n            children: \"ClientMessageID\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \".\"\n          }), _jsx(_components.span, {\n            className: \"token property-access\",\n            children: _jsx(_components.span, {\n              className: \"token maybe-class-name\",\n              children: \"UserTextMessage\"\n            })\n          }), \" \", _jsx(_components.span, {\n            className: \"token operator\",\n            children: \"||\"\n          }), \" messageType \", _jsx(_components.span, {\n            className: \"token operator\",\n            children: \"===\"\n          }), \" \", _jsx(_components.span, {\n            className: \"token maybe-class-name\",\n            children: \"ClientMessageID\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \".\"\n          }), _jsx(_components.span, {\n            className: \"token property-access\",\n            children: _jsx(_components.span, {\n              className: \"token maybe-class-name\",\n              children: \"UserAudioEnd\"\n            })\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \")\"\n          }), \" \", _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \"{\"\n          }), \"\\n    \", _jsx(_components.span, {\n            className: \"token keyword\",\n            children: \"const\"\n          }), \" messages \", _jsx(_components.span, {\n            className: \"token operator\",\n            children: \"=\"\n          }), \" \", _jsx(_components.span, {\n            className: \"token function\",\n            children: \"getChatMessages\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \"(\"\n          }), \"chatHistory\", _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \",\"\n          }), \" clientWS\", _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \".\"\n          }), _jsx(_components.span, {\n            className: \"token property-access\",\n            children: \"chatID\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \")\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \";\"\n          }), \"\\n\\n    \", _jsx(_components.span, {\n            className: \"token keyword\",\n            children: \"let\"\n          }), \" messageContent\", _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \";\"\n          }), \"\\n    \", _jsx(_components.span, {\n            className: \"token keyword control-flow\",\n            children: \"if\"\n          }), \" \", _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \"(\"\n          }), \"messageType \", _jsx(_components.span, {\n            className: \"token operator\",\n            children: \"===\"\n          }), \" \", _jsx(_components.span, {\n            className: \"token maybe-class-name\",\n            children: \"ClientMessageID\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \".\"\n          }), _jsx(_components.span, {\n            className: \"token property-access\",\n            children: _jsx(_components.span, {\n              className: \"token maybe-class-name\",\n              children: \"UserTextMessage\"\n            })\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \")\"\n          }), \" \", _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \"{\"\n          }), \"\\n        messageContent \", _jsx(_components.span, {\n            className: \"token operator\",\n            children: \"=\"\n          }), \" payload\", _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \".\"\n          }), _jsx(_components.span, {\n            className: \"token method function property-access\",\n            children: \"toString\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \"(\"\n          }), _jsx(_components.span, {\n            className: \"token string\",\n            children: \"'utf8'\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \")\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \";\"\n          }), \"\\n    \", _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \"}\"\n          }), \" \", _jsx(_components.span, {\n            className: \"token keyword control-flow\",\n            children: \"else\"\n          }), \" \", _jsx(_components.span, {\n            className: \"token keyword control-flow\",\n            children: \"if\"\n          }), \" \", _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \"(\"\n          }), \"messageType \", _jsx(_components.span, {\n            className: \"token operator\",\n            children: \"===\"\n          }), \" \", _jsx(_components.span, {\n            className: \"token maybe-class-name\",\n            children: \"ClientMessageID\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \".\"\n          }), _jsx(_components.span, {\n            className: \"token property-access\",\n            children: _jsx(_components.span, {\n              className: \"token maybe-class-name\",\n              children: \"UserAudioEnd\"\n            })\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \")\"\n          }), \" \", _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \"{\"\n          }), \"\\n        \", _jsx(_components.span, {\n            className: \"token comment\",\n            children: \"// When the client send the `ClientMessageID.UserAudioEnd` message type it means it clicked the STOP button\"\n          }), \"\\n        \\n        \", _jsx(_components.span, {\n            className: \"token comment\",\n            children: \"// Concat all the buffers into a single one\"\n          }), \"\\n        \", _jsx(_components.span, {\n            className: \"token keyword\",\n            children: \"const\"\n          }), \" buffer \", _jsx(_components.span, {\n            className: \"token operator\",\n            children: \"=\"\n          }), \" \", _jsx(_components.span, {\n            className: \"token maybe-class-name\",\n            children: \"Buffer\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \".\"\n          }), _jsx(_components.span, {\n            className: \"token method function property-access\",\n            children: \"concat\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \"(\"\n          }), \"clientWS\", _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \".\"\n          }), _jsx(_components.span, {\n            className: \"token property-access\",\n            children: \"audioChunks\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \")\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \";\"\n          }), \"\\n\\n        \", _jsx(_components.span, {\n            className: \"token comment\",\n            children: \"// Reset the chunks array\"\n          }), \"\\n        clientWS\", _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \".\"\n          }), _jsx(_components.span, {\n            className: \"token property-access\",\n            children: \"audioChunks\"\n          }), \" \", _jsx(_components.span, {\n            className: \"token operator\",\n            children: \"=\"\n          }), \" \", _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \"[\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \"]\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \";\"\n          }), \"\\n\\n        \", _jsx(_components.span, {\n            className: \"token comment\",\n            children: \"// Send audio to OpenAI to perform the speech-to-text\"\n          }), \"\\n        messageContent \", _jsx(_components.span, {\n            className: \"token operator\",\n            children: \"=\"\n          }), \" \", _jsx(_components.span, {\n            className: \"token keyword control-flow\",\n            children: \"await\"\n          }), \" \", _jsx(_components.span, {\n            className: \"token function\",\n            children: \"stt\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \"(\"\n          }), \"openai\", _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \",\"\n          }), \" buffer\", _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \")\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \";\"\n          }), \"\\n    \", _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \"}\"\n          }), \"\\n\\n    messages\", _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \".\"\n          }), _jsx(_components.span, {\n            className: \"token method function property-access\",\n            children: \"push\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \"(\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \"{\"\n          }), \" \", _jsx(_components.span, {\n            className: \"token literal-property property\",\n            children: \"role\"\n          }), _jsx(_components.span, {\n            className: \"token operator\",\n            children: \":\"\n          }), \" \", _jsx(_components.span, {\n            className: \"token string\",\n            children: \"\\\"user\\\"\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \",\"\n          }), \" \", _jsx(_components.span, {\n            className: \"token literal-property property\",\n            children: \"content\"\n          }), _jsx(_components.span, {\n            className: \"token operator\",\n            children: \":\"\n          }), \" messageContent \", _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \"}\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \")\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \";\"\n          }), \"\\n\\n    \", _jsx(_components.span, {\n            className: \"token keyword control-flow\",\n            children: \"try\"\n          }), \" \", _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \"{\"\n          }), \"\\n        \", _jsx(_components.span, {\n            className: \"token keyword control-flow\",\n            children: \"await\"\n          }), \" \", _jsx(_components.span, {\n            className: \"token function\",\n            children: \"getAnswer\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \"(\"\n          }), \"openai\", _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \",\"\n          }), \" messages\", _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \",\"\n          }), \" clientWS\", _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \")\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \";\"\n          }), \"\\n    \", _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \"}\"\n          }), \" \", _jsx(_components.span, {\n            className: \"token keyword control-flow\",\n            children: \"catch\"\n          }), \" \", _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \"(\"\n          }), \"error\", _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \")\"\n          }), \" \", _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \"{\"\n          }), \"\\n        \", _jsx(_components.span, {\n            className: \"token console class-name\",\n            children: \"console\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \".\"\n          }), _jsx(_components.span, {\n            className: \"token method function property-access\",\n            children: \"error\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \"(\"\n          }), _jsxs(_components.span, {\n            className: \"token template-string\",\n            children: [_jsx(_components.span, {\n              className: \"token template-punctuation string\",\n              children: \"`\"\n            }), _jsx(_components.span, {\n              className: \"token string\",\n              children: \"(ChatID: \"\n            }), _jsxs(_components.span, {\n              className: \"token interpolation\",\n              children: [_jsx(_components.span, {\n                className: \"token interpolation-punctuation punctuation\",\n                children: \"${\"\n              }), \"clientWS\", _jsx(_components.span, {\n                className: \"token punctuation\",\n                children: \".\"\n              }), _jsx(_components.span, {\n                className: \"token property-access\",\n                children: \"chatID\"\n              }), _jsx(_components.span, {\n                className: \"token interpolation-punctuation punctuation\",\n                children: \"}\"\n              })]\n            }), _jsx(_components.span, {\n              className: \"token string\",\n              children: \") Error when trying to get an answer from ChatGPT:\"\n            }), _jsx(_components.span, {\n              className: \"token template-punctuation string\",\n              children: \"`\"\n            })]\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \")\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \";\"\n          }), \"\\n        \", _jsx(_components.span, {\n            className: \"token console class-name\",\n            children: \"console\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \".\"\n          }), _jsx(_components.span, {\n            className: \"token method function property-access\",\n            children: \"error\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \"(\"\n          }), \"error\", _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \")\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \";\"\n          }), \"\\n        clientWS\", _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \".\"\n          }), _jsx(_components.span, {\n            className: \"token method function property-access\",\n            children: \"send\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \"(\"\n          }), _jsx(_components.span, {\n            className: \"token maybe-class-name\",\n            children: \"Buffer\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \".\"\n          }), _jsx(_components.span, {\n            className: \"token keyword module\",\n            children: \"from\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \"(\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \"[\"\n          }), _jsx(_components.span, {\n            className: \"token maybe-class-name\",\n            children: \"ServerMessageID\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \".\"\n          }), _jsx(_components.span, {\n            className: \"token known-class-name class-name\",\n            children: \"Error\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \",\"\n          }), \" \", _jsx(_components.span, {\n            className: \"token spread operator\",\n            children: \"...\"\n          }), _jsx(_components.span, {\n            className: \"token maybe-class-name\",\n            children: \"Buffer\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \".\"\n          }), _jsx(_components.span, {\n            className: \"token keyword module\",\n            children: \"from\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \"(\"\n          }), _jsx(_components.span, {\n            className: \"token string\",\n            children: \"'Error!'\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \")\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \"]\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \")\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \")\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \";\"\n          }), \"\\n        \", _jsx(_components.span, {\n            className: \"token keyword control-flow\",\n            children: \"return\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \";\"\n          }), \"\\n    \", _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \"}\"\n          }), \"\\n\", _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \"}\"\n          }), \"\\n\", _jsx(_components.span, {\n            className: \"token comment\",\n            children: \"// ...\"\n          }), _jsxs(_components.span, {\n            \"aria-hidden\": \"true\",\n            className: \"line-numbers-rows\",\n            children: [_jsx(_components.span, {\n              className: \"\"\n            }), _jsx(_components.span, {\n              className: \"\"\n            }), _jsx(_components.span, {\n              className: \"\"\n            }), _jsx(_components.span, {\n              className: \"\"\n            }), _jsx(_components.span, {\n              className: \"\"\n            }), _jsx(_components.span, {\n              className: \"\"\n            }), _jsx(_components.span, {\n              className: \"\"\n            }), _jsx(_components.span, {\n              className: \"\"\n            }), _jsx(_components.span, {\n              className: \"\"\n            }), _jsx(_components.span, {\n              className: \"\"\n            }), _jsx(_components.span, {\n              className: \"\"\n            }), _jsx(_components.span, {\n              className: \"\"\n            }), _jsx(_components.span, {\n              className: \"\"\n            }), _jsx(_components.span, {\n              className: \"\"\n            }), _jsx(_components.span, {\n              className: \"\"\n            }), _jsx(_components.span, {\n              className: \"\"\n            }), _jsx(_components.span, {\n              className: \"\"\n            }), _jsx(_components.span, {\n              className: \"\"\n            }), _jsx(_components.span, {\n              className: \"\"\n            }), _jsx(_components.span, {\n              className: \"\"\n            }), _jsx(_components.span, {\n              className: \"\"\n            }), _jsx(_components.span, {\n              className: \"\"\n            }), _jsx(_components.span, {\n              className: \"\"\n            }), _jsx(_components.span, {\n              className: \"\"\n            }), _jsx(_components.span, {\n              className: \"\"\n            }), _jsx(_components.span, {\n              className: \"\"\n            }), _jsx(_components.span, {\n              className: \"\"\n            }), _jsx(_components.span, {\n              className: \"\"\n            }), _jsx(_components.span, {\n              className: \"\"\n            }), _jsx(_components.span, {\n              className: \"\"\n            }), _jsx(_components.span, {\n              className: \"\"\n            }), _jsx(_components.span, {\n              className: \"\"\n            }), _jsx(_components.span, {\n              className: \"\"\n            })]\n          }), \"\\n\"]\n        })\n      })\n    }), \"\\n\", _jsxs(_components.p, {\n      children: [\"Once the client send a message of type \", _jsx(_components.code, {\n        children: \"ClientMessageID.UserTextMessage\"\n      }), \" or\\n\", _jsx(_components.code, {\n        children: \"ClientMessageID.UserAudioEnd\"\n      }), \", we retrieve, as before, the chat's messages. If\\nthe message is of type \", _jsx(_components.code, {\n        children: \"ClientMessageID.UserTextMessage\"\n      }), \", we will convert the\\nreceived data (\", _jsx(_components.code, {\n        children: \"payload\"\n      }), \") to a \", _jsx(_components.code, {\n        children: \"String\"\n      }), \". If the message is of type\\n\", _jsx(_components.code, {\n        children: \"ClientMessageID.UserAudioEnd\"\n      }), \", we will combine all the audio buffer chunks into\\na single chunk, reset the array of chunks and perform the speech-to-text action\\non the audio, which will return the text.\"]\n    }), \"\\n\", _jsx(_components.p, {\n      children: \"Next step is to create the new message in the format accepted by ChatGPT and\\nquery ChatGPT for a response.\"\n    }), \"\\n\", _jsx(_components.div, {\n      className: \"remark-highlight\",\n      children: _jsx(_components.pre, {\n        className: \"language-js  line-numbers\",\n        children: _jsxs(_components.code, {\n          className: \"language-js\",\n          children: [_jsx(_components.span, {\n            className: \"token comment\",\n            children: \"/* version-2/server.js */\"\n          }), \"\\n\", _jsx(_components.span, {\n            className: \"token comment\",\n            children: \"// ...\"\n          }), \"\\n\", _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \"}\"\n          }), \" \", _jsx(_components.span, {\n            className: \"token keyword control-flow\",\n            children: \"else\"\n          }), \" \", _jsx(_components.span, {\n            className: \"token keyword control-flow\",\n            children: \"if\"\n          }), \" \", _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \"(\"\n          }), \"messageType \", _jsx(_components.span, {\n            className: \"token operator\",\n            children: \"===\"\n          }), \" \", _jsx(_components.span, {\n            className: \"token maybe-class-name\",\n            children: \"ClientMessageID\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \".\"\n          }), _jsx(_components.span, {\n            className: \"token property-access\",\n            children: _jsx(_components.span, {\n              className: \"token maybe-class-name\",\n              children: \"UserAudioChunk\"\n            })\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \")\"\n          }), \" \", _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \"{\"\n          }), \"\\n    clientWS\", _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \".\"\n          }), _jsx(_components.span, {\n            className: \"token property-access\",\n            children: \"audioChunks\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \".\"\n          }), _jsx(_components.span, {\n            className: \"token method function property-access\",\n            children: \"push\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \"(\"\n          }), \"payload\", _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \")\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \";\"\n          }), \"\\n\", _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \"}\"\n          }), \"\\n\", _jsx(_components.span, {\n            className: \"token comment\",\n            children: \"// ...\"\n          }), _jsxs(_components.span, {\n            \"aria-hidden\": \"true\",\n            className: \"line-numbers-rows\",\n            children: [_jsx(_components.span, {\n              className: \"\"\n            }), _jsx(_components.span, {\n              className: \"\"\n            }), _jsx(_components.span, {\n              className: \"\"\n            }), _jsx(_components.span, {\n              className: \"\"\n            }), _jsx(_components.span, {\n              className: \"\"\n            }), _jsx(_components.span, {\n              className: \"\"\n            })]\n          }), \"\\n\"]\n        })\n      })\n    }), \"\\n\", _jsx(_components.p, {\n      children: \"The last message type we handle is for the audio chunks, which just adds the\\nreceived data to the audio chunks array of the client socket.\"\n    }), \"\\n\", _jsxs(_components.p, {\n      children: [\"Now lets look over how the \", _jsx(_components.code, {\n        children: \"getAnswer\"\n      }), \" function was changed in order to support\\nstreams:\"]\n    }), \"\\n\", _jsx(_components.div, {\n      className: \"remark-highlight\",\n      children: _jsx(_components.pre, {\n        className: \"language-js  line-numbers\",\n        children: _jsxs(_components.code, {\n          className: \"language-js\",\n          children: [_jsx(_components.span, {\n            className: \"token comment\",\n            children: \"/* version-2/server.js */\"\n          }), \"\\n\", _jsxs(_components.span, {\n            className: \"token doc-comment comment\",\n            children: [\"/**\\n * Get the next message in the conversation\\n * \", _jsx(_components.span, {\n              className: \"token keyword\",\n              children: \"@async\"\n            }), \"\\n * \\n * \", _jsx(_components.span, {\n              className: \"token keyword\",\n              children: \"@param\"\n            }), \" \", _jsxs(_components.span, {\n              className: \"token class-name\",\n              children: [_jsx(_components.span, {\n                className: \"token punctuation\",\n                children: \"{\"\n              }), \"OpenAI\", _jsx(_components.span, {\n                className: \"token punctuation\",\n                children: \"}\"\n              })]\n            }), \" \", _jsx(_components.span, {\n              className: \"token parameter\",\n              children: \"openai\"\n            }), \" the OpenAI instance\\n * \", _jsx(_components.span, {\n              className: \"token keyword\",\n              children: \"@param\"\n            }), \" \", _jsxs(_components.span, {\n              className: \"token class-name\",\n              children: [_jsx(_components.span, {\n                className: \"token punctuation\",\n                children: \"{\"\n              }), \"String\", _jsx(_components.span, {\n                className: \"token punctuation\",\n                children: \"[\"\n              }), _jsx(_components.span, {\n                className: \"token punctuation\",\n                children: \"]\"\n              }), _jsx(_components.span, {\n                className: \"token punctuation\",\n                children: \"}\"\n              })]\n            }), \" \", _jsx(_components.span, {\n              className: \"token parameter\",\n              children: \"messages\"\n            }), \" the messages in the OpenAI format\\n * \", _jsx(_components.span, {\n              className: \"token keyword\",\n              children: \"@returns\"\n            }), \" \", _jsxs(_components.span, {\n              className: \"token class-name\",\n              children: [_jsx(_components.span, {\n                className: \"token punctuation\",\n                children: \"{\"\n              }), \"String\", _jsx(_components.span, {\n                className: \"token punctuation\",\n                children: \"}\"\n              })]\n            }), \" the response from ChatGPT\\n */\"]\n          }), \"\\n\", _jsx(_components.span, {\n            className: \"token keyword\",\n            children: \"async\"\n          }), \" \", _jsx(_components.span, {\n            className: \"token keyword\",\n            children: \"function\"\n          }), \" \", _jsx(_components.span, {\n            className: \"token function\",\n            children: \"getAnswer\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \"(\"\n          }), _jsxs(_components.span, {\n            className: \"token parameter\",\n            children: [\"openai\", _jsx(_components.span, {\n              className: \"token punctuation\",\n              children: \",\"\n            }), \" messages\", _jsx(_components.span, {\n              className: \"token punctuation\",\n              children: \",\"\n            }), \" clientWS\"]\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \")\"\n          }), \" \", _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \"{\"\n          }), \"\\n    \", _jsxs(_components.span, {\n            className: \"token comment\",\n            children: [\"// Documentation \", _jsx(_components.a, {\n              href: \"https://platform.openai.com/docs/api-reference/chat/create\",\n              className: \"token url-link\",\n              children: \"https://platform.openai.com/docs/api-reference/chat/create\"\n            })]\n          }), \"\\n    \", _jsx(_components.span, {\n            className: \"token keyword\",\n            children: \"const\"\n          }), \" stream \", _jsx(_components.span, {\n            className: \"token operator\",\n            children: \"=\"\n          }), \" \", _jsx(_components.span, {\n            className: \"token keyword control-flow\",\n            children: \"await\"\n          }), \" openai\", _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \".\"\n          }), _jsx(_components.span, {\n            className: \"token property-access\",\n            children: \"chat\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \".\"\n          }), _jsx(_components.span, {\n            className: \"token property-access\",\n            children: \"completions\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \".\"\n          }), _jsx(_components.span, {\n            className: \"token method function property-access\",\n            children: \"create\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \"(\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \"{\"\n          }), \"\\n        \", _jsx(_components.span, {\n            className: \"token literal-property property\",\n            children: \"model\"\n          }), _jsx(_components.span, {\n            className: \"token operator\",\n            children: \":\"\n          }), \" \", _jsx(_components.span, {\n            className: \"token maybe-class-name\",\n            children: \"Settings\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \".\"\n          }), _jsx(_components.span, {\n            className: \"token property-access\",\n            children: _jsx(_components.span, {\n              className: \"token maybe-class-name\",\n              children: \"ChatGPTModel\"\n            })\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \",\"\n          }), \"\\n        messages\", _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \",\"\n          }), \"\\n        \", _jsx(_components.span, {\n            className: \"token literal-property property\",\n            children: \"stream\"\n          }), _jsx(_components.span, {\n            className: \"token operator\",\n            children: \":\"\n          }), \" \", _jsx(_components.span, {\n            className: \"token boolean\",\n            children: \"true\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \",\"\n          }), \"\\n    \", _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \"}\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \")\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \";\"\n          }), \"\\n\\n    \", _jsx(_components.span, {\n            className: \"token keyword control-flow\",\n            children: \"for\"\n          }), \" \", _jsx(_components.span, {\n            className: \"token keyword control-flow\",\n            children: \"await\"\n          }), \" \", _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \"(\"\n          }), _jsx(_components.span, {\n            className: \"token keyword\",\n            children: \"const\"\n          }), \" chunk \", _jsx(_components.span, {\n            className: \"token keyword\",\n            children: \"of\"\n          }), \" stream\", _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \")\"\n          }), \" \", _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \"{\"\n          }), \"\\n        \", _jsx(_components.span, {\n            className: \"token keyword\",\n            children: \"const\"\n          }), \" content \", _jsx(_components.span, {\n            className: \"token operator\",\n            children: \"=\"\n          }), \" chunk\", _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \".\"\n          }), _jsx(_components.span, {\n            className: \"token property-access\",\n            children: \"choices\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \"[\"\n          }), _jsx(_components.span, {\n            className: \"token number\",\n            children: \"0\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \"]\"\n          }), _jsx(_components.span, {\n            className: \"token operator\",\n            children: \"?.\"\n          }), \"delta\", _jsx(_components.span, {\n            className: \"token operator\",\n            children: \"?.\"\n          }), \"content\", _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \";\"\n          }), \"\\n        \", _jsx(_components.span, {\n            className: \"token keyword control-flow\",\n            children: \"if\"\n          }), \" \", _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \"(\"\n          }), _jsx(_components.span, {\n            className: \"token operator\",\n            children: \"!\"\n          }), \"content\", _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \")\"\n          }), \" \", _jsx(_components.span, {\n            className: \"token keyword control-flow\",\n            children: \"continue\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \";\"\n          }), \"\\n\\n        clientWS\", _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \".\"\n          }), _jsx(_components.span, {\n            className: \"token method function property-access\",\n            children: \"send\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \"(\"\n          }), _jsx(_components.span, {\n            className: \"token maybe-class-name\",\n            children: \"Buffer\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \".\"\n          }), _jsx(_components.span, {\n            className: \"token keyword module\",\n            children: \"from\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \"(\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \"[\"\n          }), _jsx(_components.span, {\n            className: \"token maybe-class-name\",\n            children: \"ServerMessageID\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \".\"\n          }), _jsx(_components.span, {\n            className: \"token property-access\",\n            children: _jsx(_components.span, {\n              className: \"token maybe-class-name\",\n              children: \"TextChunk\"\n            })\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \",\"\n          }), \" \", _jsx(_components.span, {\n            className: \"token spread operator\",\n            children: \"...\"\n          }), _jsx(_components.span, {\n            className: \"token maybe-class-name\",\n            children: \"Buffer\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \".\"\n          }), _jsx(_components.span, {\n            className: \"token keyword module\",\n            children: \"from\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \"(\"\n          }), \"content \", _jsx(_components.span, {\n            className: \"token operator\",\n            children: \"||\"\n          }), \" \", _jsx(_components.span, {\n            className: \"token string\",\n            children: \"\\\"\\\"\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \")\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \"]\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \")\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \")\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \";\"\n          }), \"\\n    \", _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \"}\"\n          }), \"\\n\\n    clientWS\", _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \".\"\n          }), _jsx(_components.span, {\n            className: \"token method function property-access\",\n            children: \"send\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \"(\"\n          }), _jsx(_components.span, {\n            className: \"token maybe-class-name\",\n            children: \"Buffer\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \".\"\n          }), _jsx(_components.span, {\n            className: \"token keyword module\",\n            children: \"from\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \"(\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \"[\"\n          }), _jsx(_components.span, {\n            className: \"token maybe-class-name\",\n            children: \"ServerMessageID\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \".\"\n          }), _jsx(_components.span, {\n            className: \"token property-access\",\n            children: _jsx(_components.span, {\n              className: \"token maybe-class-name\",\n              children: \"TextEnd\"\n            })\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \"]\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \")\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \")\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \";\"\n          }), \"\\n\", _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \"}\"\n          }), _jsxs(_components.span, {\n            \"aria-hidden\": \"true\",\n            className: \"line-numbers-rows\",\n            children: [_jsx(_components.span, {\n              className: \"\"\n            }), _jsx(_components.span, {\n              className: \"\"\n            }), _jsx(_components.span, {\n              className: \"\"\n            }), _jsx(_components.span, {\n              className: \"\"\n            }), _jsx(_components.span, {\n              className: \"\"\n            }), _jsx(_components.span, {\n              className: \"\"\n            }), _jsx(_components.span, {\n              className: \"\"\n            }), _jsx(_components.span, {\n              className: \"\"\n            }), _jsx(_components.span, {\n              className: \"\"\n            }), _jsx(_components.span, {\n              className: \"\"\n            }), _jsx(_components.span, {\n              className: \"\"\n            }), _jsx(_components.span, {\n              className: \"\"\n            }), _jsx(_components.span, {\n              className: \"\"\n            }), _jsx(_components.span, {\n              className: \"\"\n            }), _jsx(_components.span, {\n              className: \"\"\n            }), _jsx(_components.span, {\n              className: \"\"\n            }), _jsx(_components.span, {\n              className: \"\"\n            }), _jsx(_components.span, {\n              className: \"\"\n            }), _jsx(_components.span, {\n              className: \"\"\n            }), _jsx(_components.span, {\n              className: \"\"\n            }), _jsx(_components.span, {\n              className: \"\"\n            }), _jsx(_components.span, {\n              className: \"\"\n            }), _jsx(_components.span, {\n              className: \"\"\n            }), _jsx(_components.span, {\n              className: \"\"\n            }), _jsx(_components.span, {\n              className: \"\"\n            }), _jsx(_components.span, {\n              className: \"\"\n            })]\n          }), \"\\n\"]\n        })\n      })\n    }), \"\\n\", _jsxs(_components.p, {\n      children: [\"By simply adding \", _jsx(_components.code, {\n        children: \"stream: true\"\n      }), \" to the object sent as argument to ChatGPT, it\\nwill return a stream object that we can loop through. For each non-empty chunk\\nof data, we will send it back to the client. After the stream is\\ndone, we need to notify the client that the response is complete.\"]\n    }), \"\\n\", _jsx(\"h3\", {\n      id: \"tips-for-adding-the-tts-functionality-back\",\n      children: \"Tips for adding the TTS functionality back\"\n    }), \"\\n\", _jsx(_components.p, {\n      children: \"Ok, ok, but what if we have a TTS service that supports streaming or accepts\\nmany requests that are processed fast?\"\n    }), \"\\n\", _jsx(_components.p, {\n      children: \"No problem: we just need to adjust some things on the server side and client\\nside.\"\n    }), \"\\n\", _jsxs(_components.p, {\n      children: [\"On the server side, once we receive a chunk of the answer from the AI (in the\\n\", _jsx(_components.code, {\n        children: \"getAnswer\"\n      }), \" function), we need to call our TTS service and send the audio data\\nreceived as response to the client side.\"]\n    }), \"\\n\", _jsx(_components.p, {\n      children: \"On the client side, more changes are needed:\"\n    }), \"\\n\", _jsxs(_components.ul, {\n      children: [\"\\n\", _jsx(_components.li, {\n        children: \"We cannot, no more, always transform the received data to text because now\\nwe can receive audio data;\"\n      }), \"\\n\", _jsx(_components.li, {\n        children: \"Because we might receive the next audio data before the previous audio is done\\nplaying, we need to introduce a synchronization method to keep track of which\\naudio needs to be played next.\"\n      }), \"\\n\"]\n    }), \"\\n\", _jsx(_components.h2, {\n      children: \"Final words\"\n    }), \"\\n\", _jsx(_components.p, {\n      children: \"There are aspects that were ommited in this post/implemention, such as error\\nhandling for different parts of the code.\"\n    }), \"\\n\", _jsxs(_components.p, {\n      children: [\"If you would like to see an implementation of the server in Go or Rust please\\nwrite to me at \", _jsx(_components.a, {\n        href: \"mailto:alex@alexprisacariu.dev\",\n        children: \"alex@alexprisacariu.dev\"\n      }), \".\"]\n    }), \"\\n\", _jsx(_components.p, {\n      children: \"Diagrams generated using Draw.io and the grammar check was done by ChatGPT.\"\n    }), \"\\n\", _jsx(_components.p, {\n      children: \"Resources:\"\n    }), \"\\n\", _jsxs(_components.ul, {\n      children: [\"\\n\", _jsxs(_components.li, {\n        children: [_jsx(_components.a, {\n          href: \"https://platform.openai.com/docs/api-reference\",\n          children: \"OpenAI Documentation\"\n        }), \";\"]\n      }), \"\\n\", _jsxs(_components.li, {\n        children: [_jsx(_components.a, {\n          href: \"https://developer.mozilla.org/en-US/\",\n          children: \"MDN Web Docs\"\n        }), \".\"]\n      }), \"\\n\"]\n    })]\n  });\n}\nfunction MDXContent(props = {}) {\n  const {wrapper: MDXLayout} = Object.assign({}, _provideComponents(), props.components);\n  return MDXLayout ? _jsx(MDXLayout, Object.assign({}, props, {\n    children: _jsx(_createMdxContent, props)\n  })) : _createMdxContent(props);\n}\nreturn {\n  default: MDXContent\n};\n","frontmatter":{},"scope":{}},"skip":null},"__N_SSG":true}